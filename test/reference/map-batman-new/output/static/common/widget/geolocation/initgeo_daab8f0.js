define("common:widget/geolocation/initgeo.js",function(e,t,o){"use strict";var i=e("common:widget/geolocation/location.js"),a=e("common:widget/cookie/cookie.js"),p=(e("common:static/js/localstorage.js"),e("common:widget/stat/stat.js")),n=e("common:widget/url/url.js");o.exports={init:function(){this._resetCurrentCity(),this._initGeo(),this._changeCity()},_resetCurrentCity:function(){var e=window._DEFAULT_CITY,t=window.localStorage;try{e.index?(t.setItem("_DEFAULT_CITY",JSON.stringify(window._DEFAULT_CITY)),a.set("DEFAULT_CITY","1",{expires:3e5,path:"/"})):t.getItem("_DEFAULT_CITY")?window._DEFAULT_CITY=JSON.parse(t.getItem("_DEFAULT_CITY"))||{}:(window._DEFAULT_CITY={addrbyip:'{"error":1,"content":""}',default_city:"全国",index:'{"content":{"baike":0,"city_type":0,"cname":"全国","code":1,"count_info":null,"geo":"1|11590057.96,4489812.75;11590057.96,4489812.75|11590057.96,4489812.75;","if_current":1,"level":0,"sup":0,"sup_bus":0,"sup_business_area":0,"sup_lukuang":0,"sup_subway":0,"uid":"b04c4accaab2fb7f410245f2"},"mo":{"data":{"mo_text":"下载百度手机地图","mo_color":"#ff0000","mo_layer_text":"离线使用，省90%流量！","popup_img1":"http://map.baidu.com/fwmap/upload/r/image/2013-07-15/86bd8022f311d822940c36647c0aa131_143_221.jpg","popup_img2":"http://map.baidu.com/fwmap/upload/r/image/2013-07-15/94383d365350ba776eaee9d9daaf2387_143_221.jpg","popup_img3":"http://map.baidu.com/fwmap/upload/r/image/2013-07-15/c6c9811cff704539cc97e1fa385df81d_143_221.jpg","popup_title1":"搜索周边美食、酒店、在线预定","popup_title2":"合理路线规划，免费语音导航","popup_title3":"最新团购优惠折扣信息","popup_version_iphone":"http://map.baidu.com/fwmap/upload/r/image/2013-07-15/18a9fef8f8276dedb1d8129a36ceb181_25_26.png","popup_version_andriod":"http://map.baidu.com/fwmap/upload/r/image/2013-07-15/e87051a70c258e51bb947a95789ca815_25_26.png","banner_home":"http://map.baidu.com/fwmap/upload/r/image/2013-07-15/8cf335e0d9f4c9e0f8656c1e369c7f67_316_100.jpg","banner_poi":"http://map.baidu.com/fwmap/upload/r/image/2013-07-16/6f90db9e61476f2cd8975c3fac3c70a8_316_100.jpg","banner_bus":"http://map.baidu.com/fwmap/upload/r/image/2013-07-16/b39713e7c4cbf5a27c72308d1846248f_316_100.jpg","banner_driving":"http://map.baidu.com/fwmap/upload/r/image/2013-07-16/8a512aa177b13df62758f7326f4a5682_316_100.jpg"}},"result":{"jump_back":0,"qid":"","time":0,"type":1},"current_city":{"code":1,"sup":0,"sup_bus":0,"sup_business_area":0,"sup_lukuang":0,"sup_subway":0,"type":0,"up_province_name":"中国"}}',loopindex:-1},a.set("DEFAULT_CITY","0",{expires:-1e3,path:"/"}))}catch(o){}if(!window._CURRENT_CITY){var i=JSON.parse(_DEFAULT_CITY.index)||{},p=i.content||{};window._CURRENT_CITY={code:p.code||1,geo:p.geo||"",name:p.cname||"",sup:p.sup||0,sup_bus:p.sup_bus||0,sup_business_area:p.sup_business_area||0,sup_lukuang:p.sup_lukuang||0,sup_subway:p.sup_subway||0,type:p.city_type||0,up_province_name:p.up_province_name||"",reset_cur:1}}},_initGeo:function(){try{this._hasStorageLoc()||this._initIpGeo()}catch(t){this._initIpGeo()}e("common:widget/geolocation/geolocation.js",function(e){e.init()})},getLocFromStorage:function(e){var t=window.localStorage;if(t)try{var o=t.getItem(e);return JSON.parse(o)}catch(i){return}},_hasStorageLoc:function(){var e=this,t=e.getLocFromStorage("webapp-loc"),o=e.getLocFromStorage("webapp-myloc"),a=(new Date).getTime();return o&&o.isExactPoi===!0&&parseInt(o.t)+3e5>a&&(i._mylocation=o,$.extend(i._mylocation,{type:"storage"}),window._INIT_MYLOC_SUC=!0),t&&"ip"!==t.type&&parseInt(t.t)+3e5>a?(i._location=t,$.extend(i._location,{type:"storage"}),window._NO_COVER_LOC=!0,window._INIT_LOC_SUC=!0,!0):!1},_initIpGeo:function(){var e,t,o,a,n;e=JSON.parse(_DEFAULT_CITY.index)||{},t=e&&e.content,o=t&&t.geo,n=t.level,a=o.split(";")[1].split("|")[0].split(","),1==t.code&&(t.name="全国"),1!=t.code&&p.addStat(COM_STAT_CODE.STAT_IP_GEO_IN_CITY);var _={addr:{city:t.cname,cityCode:t.code},point:{x:a[0],y:a[1]},level:n,type:"ip",isExactPoi:!1,isGeoEnd:!1,isSaveLocInStorage:!1};i.setAddress(_,!0)},_changeCity:function(){var e=window._CURRENT_CITY,t=n.get();if(t.pageState||{},t.action||{},t.module||{},e&&1!=e.reset_cur&&(e.code!=i.getCityCode()&&e.code!=i.getUpCityCode()||1==e.is_update_city)){var o=e.geo&&e.geo.split(";")[0].split("|")[1].split(",");if(void 0===o)return;1==e.code&&(e.name="全国");var a=null;3===e.type&&(a=e.up_cityid);var p=0!=e.level?e.level:4,_={addr:{city:e.name,cityCode:e.code,cityType:e.type,upCityCode:a},point:{x:o[0],y:o[1]},level:p,isSaveLocInCookie:!0};window._NO_COVER_LOC=!1,i.setAddress(_),window._NO_COVER_LOC=!0}},changeCity:function(){var e=window._CURRENT_CITY,t=n.get();if(t.pageState||{},t.action||{},t.module||{},e&&1!=e.reset_cur&&(e.code!=i.getCityCode()&&e.code!=i.getUpCityCode()||1==e.is_update_city)){var o=e.geo&&e.geo.split(";")[0].split("|")[1].split(",");if(void 0===o)return;1==e.code&&(e.name="全国");var a=null;3===e.type&&(a=e.up_cityid);var p=0!=e.level?e.level:4,_={addr:{city:e.name,cityCode:e.code,cityType:e.type,upCityCode:a},point:{x:o[0],y:o[1]},level:p};i.setAddress(_,!1)}}}});