define("common:widget/streetview/streetview.js",function(e,t,i){var s,n,o=e("common:static/js/util.js"),a=e("common:widget/popup/popup.js"),r=e("common:widget/url/url.js"),d=e("common:widget/pagemgr/pagemgr.js"),h=e("common:widget/cookie/cookie.js"),c=e("common:static/js/localstorage.js");i.exports={Str:{DAY:"day",NIGHT:"night",BANNER_ID:"app-banner-for-stv",STREETVIEW_CONTAINER_ID:"streetview-container",MAP_CONTAINER_ID:"eagleeye-container",MAP_ID:"eagleeye-map",NORESULT:"未找到街景数据"},os:o.isAndroid()?"android":o.isIPhone()?"iphone":o.isIPad()?"ipad":"unknown",init:function(e){e=e||{},s=e.BMap,n=e.CustomMarker,this.show(),this._updated=!1,this.initStreetView(),this.initMap(),this.updateStreetView(),this.bind(),this.onSizeChange()},initStreetView:function(){var e;this.streetView=e=new s.StreetView(this.Str.STREETVIEW_CONTAINER_ID),e.addEventListener("position_changed",$.proxy(this.onPositionChanged,this)),e.addEventListener("links_changed",$.proxy(this.onPositionChanged,this)),e.addEventListener("dataload",$.proxy(this.onStreetDataLoaded,this)),e.addEventListener("tilesloaded",$.proxy(this.onTilesLoaded,this))},onStreetDataLoaded:function(){},initMap:function(){var e={maxZoom:14,minZoom:14,drawMargin:0,enableFulltimeSpotClick:!1,vectorMapLevel:99,drawer:BMAP_CANVAS_DRAWER};this.eyeMap=new s.Map(this.Str.MAP_ID,e),this.eyeMap.disableHighResolution(),this.eyeMap.disableDoubleClickZoom(),this.eyeMap.disablePinchToZoom(),this.eyeMap.addTileLayer(new s.StreetViewCoverageLayer),this.eyeMap.addEventListener("click",$.proxy(this.onEyeMapClick,this))},onEyeMapClick:function(){$("#"+this.Str.MAP_CONTAINER_ID).toggleClass("exp");var e=this.streetView.getPosition();this.eyeMap.checkResize(),this.eyeMap.centerAndZoom(e,15)},checkEyeMapDirection:function(){var e=window.innerWidth,t=window.innerHeight;return t>e?!0:!1},toMax:function(){var e=$("#back_nav");$("#uniscroll-wrapper"),e.height(),$("#"+this.Str.MAP_CONTAINER_ID).css({visibility:"hidden",left:-1e3}),$("#street-holder").find(".addr").show(),listener.trigger("common","sizechange")},recovery:function(){r.get(),$("#"+this.Str.MAP_CONTAINER_ID).css({visibility:"visible",left:5}),this.eyeMap.checkResize(),this.eyeMap.centerAndZoom(this.streetView.getPosition(),this.eyeMap.getZoom()),$("#street-holder").find(".addr").hide(),listener.trigger("common","sizechange")},bind:function(){var e=this;this.streetView.addEventListener("click",$.proxy(this.onStreetViewClick,this)),this.streetView.addEventListener("noresult",$.proxy(this.onNoResult,this)),$("#eagleeye-container, #street-holder .mode").on("touchstart touchend",function(e){e.stopPropagation()}),$("#street-holder").find(".mode").on("click",$.proxy(this.onToggleMode,this)),listener.on("common","sizechange",this._onSizeChange),d.registerDestory($.proxy(e.destory,this))},_onSizeChange:function(){return $.proxy(this.onSizeChange,this)},onSizeChange:function(){if(r.get(),!this.hasAlertDisabled()&&!this.checkEyeMapDirection()&&!o.isIPad()){if(this.alertDsabeld)return;a.open({text:"街景在横屏下体验较差，建议在竖屏下使用。",autoCloseTime:3e3}),this.alertDsabeld=!0,c.addData("alertDisabled","true",{error:function(){var e={domain:"map.baidu.com",path:"/",expires:31536e6};h.set("alertDisabled","true",e)}}),$(".common-widget-popup").on("touchstart",function(){$(".common-widget-popup").remove()})}setTimeout(function(){window.scrollTo(0,0)},100)},hasAlertDisabled:function(){var e;return c.selectData("alertDisabled",{success:function(t){e=t,e||(e=h.get("alertDisabled"),"true"==""+e&&c.addData("alertDisabled","true",{success:function(){h.remove("alertDisabled")}}))},error:function(){e=h.get("alertDisabled")}}),"true"==""+e},onNoResult:function(){r.get(),a.open({text:this.Str.NORESULT,autoCloseTime:1500}),this.onPositionChanged()},onStreetViewClick:function(){this.maxStatus=!this.maxStatus,this.maxStatus?this.toMax():this.recovery(),this.setDayAndNigthMode()},onToggleMode:function(){var e=this.streetView.getMode(),t=this.streetView.getRelevants();if(t[0]&&t[0].mode){var i="day"===t[0].mode?"night":"day";i&&$("#street-holder").find(".mode").show().removeClass("night day").addClass("day"===e?"night":"day"),this.streetView.setId(t[0].id)}},update:function(){this.show(),this.updateStreetView()},hide:function(){$("#street-holder").css("visibility","hidden"),$("#"+this.Str.MAP_CONTAINER_ID).css("visibility","hidden"),o.isIOS()&&this.streetView&&this.streetView._linksContainer&&(this.streetView._linksContainer.style.display="none"),$("#"+this.Str.BANNER_ID).hide(),$("#iscroll-container").removeClass("hide")},show:function(){$("#"+this.Str.BANNER_ID).show(),$("#street-holder").css("visibility","visible"),o.isIOS()&&this.streetView&&this.streetView._linksContainer&&(this.streetView._linksContainer.style.display=""),this.maxStatus||$("#"+this.Str.MAP_CONTAINER_ID).css("visibility","visible"),o.isIPad()&&$("#iscroll-container").addClass("hide")},setEye:function(e){if(this._mkr)this._mkr.setPoint(e);else{var t=new s.Icon("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAoCAYAAADpE0oSAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6RUY1NDYwQjhGNTIxMTFFMkIzREZGQURENzdCRDY5ODMiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RUY1NDYwQjlGNTIxMTFFMkIzREZGQURENzdCRDY5ODMiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpFRjU0NjBCNkY1MjExMUUyQjNERkZBREQ3N0JENjk4MyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpFRjU0NjBCN0Y1MjExMUUyQjNERkZBREQ3N0JENjk4MyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PgIQMF8AAAeYSURBVHjapJh7bFt3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",new s.Size(40,40),{anchor:new s.Size(20,40),imageOffset:new s.Size(-5,0)});this._mkr=new n(t,e,{className:"eye_mrk",click:function(){}}),this._mkr.setDraggingEnabled(!0),this.eyeMap.addOverlay(this._mkr),this._mkr.addEventListener("dragend",$.proxy(this.markerDragEnd,this))}},markerDragEnd:function(){var e=this.eyeMap.getCenter();this.streetView.setPosition(e)},onPositionChanged:function(){var e=this.streetView,t=e.getPosition(),i=e.getDescription();this.eyeMap&&(this.setEye(t),this.eyeMap.centerAndZoom(t,15)),this.setDayAndNigthMode(),i=i||"未命名路段";var s=i.match(/[^\x00-\xff]/gi),n=s?s.length:i.length;n>14&&(i=i.substring(0,13)+"..."),$("#street-holder").find(".addr").text(i)},onTilesLoaded:function(){},unbind:function(){listener.off("common","sizechange",this._onSizeChange)},destory:function(){this.unbind()},setDayAndNigthMode:function(){var e=this.streetView.getRelevants(),t=e&&e[0],i=$("#street-holder").find(".mode");if(t&&t.mode&&!this.maxStatus){var s=t.mode===this.Str.DAY?"day":"night";i.removeClass("night day"),s?i.show().addClass(s):i.hide()}else i.hide()},updateStreetView:function(){var e=r.get(),t=null,i=null,n={},o=e.query||{};this._updated=!0,this.streetView.clear(),o.ss_id?(t=o.ss_id,o.ss_panoType&&"undefined"!=o.ss_panoType&&"inter"===o.ss_panoType?this.streetView.setInnerId(t):this.streetView.setId(t)):o.nb_x&&o.nb_y&&(i=new s.Point(o.nb_x,o.nb_y),this.streetView.setPosition(i)),n=this.streetView.getPov(),o.ss_heading&&"undefined"!==o.ss_heading&&(n.heading=parseFloat(o.ss_heading)),o.ss_pitch&&"undefined"!==o.ss_pitch&&(n.pitch=parseFloat(o.ss_pitch)),this.streetView.setPov(n)},sendStats:function(){}}});