define("place:widget/codesindex/codesindex.js",function(t,i,e){function o(){var t=h.getCityCode()||1,i={};return h.hasExactPoi()&&(i.point_x=h.getPointX(),i.point_y=h.getPointY(),i.city_id=t),i}function n(){var t=$("#buyCodeCount span");t.click(function(){$(this).addClass("selected").siblings("span").removeClass("selected"),g=parseInt($(this).text())})}function a(t){var i=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),e=window.location.href.substr(1).match(i);return null!==e?decodeURIComponent(e[2]):null}function c(t){$.ajax({url:t.url||"",type:t.type||"GET",dataType:t.dataType||"text",crossDomain:t.crossDomain||!1,data:t.data||"",contentType:"POST"==t.type?"application/x-www-form-urlencoded; charset=utf-8":null,async:!0,success:function(i){t.callback(i)},error:function(){}})}function s(t){function i(t){var i=$("#citylist"),o="";0==t.errorNo&&$.each(t.list,function(t,i){o+='<option class="city_opt" value="'+i.city_id+'">'+i.city+"</option>"}),i.html(o),d(e,"",1)}if(t.city_id)var e="&"+$.param(t);else var e="";var o=y+"/mobile/webapp/place/codes/force=simple&qt=webappcitys"+e+"&act_id="+a("act_id"),n={url:o,type:"GET",dataType:"json",crossDomain:!0,data:null,callback:i};c(n)}function l(){var t=document.getElementById("citylist");t.onchange=function(){var t=this.options[this.selectedIndex].value;d("",t,0)}}function r(t){for(var i=document.getElementById("citylist"),e=0;e<i.length;e++)i.options[e].value==t&&(i.options[e].selected=!0)}function d(t,i,e){function o(t){if(0==t.errorNo){r(t.city_id);var i=$("#cinemas"),e="",o=1;$.each(t.list,function(t,i){$.each(i.list,function(t,i){e+='<li class="cinemaslist" id="'+i.uid+'"><p class="shop"><span class="order">'+o+".</span>"+i.name+"</p>",e+='<p class="addr">'+i.address+"</p></li>",o++})}),i.html(e),u(t)}}if(0==e)var n="&city_id="+i;else var n=t;var s=y+"/detail?qt=mcdkey&from=webapp&act=cinemas"+n+"&act_id="+a("act_id"),l=($("#cityname"),{url:s,type:"GET",dataType:"json",crossDomain:!1,data:null,callback:o});c(l)}function u(t){$(".cinemaslist").click(function(){var i=this.id;location.href=y+"/mobile/webapp/place/detail/force=simple&qt=inf&uid="+i+"&c="+t.city_id+"&wd=电影院",_.addStat(STAT_CODE.PLACE_BUYCODES_CINDEMAS_PV,{state:t.city_id})})}function p(){var t=$("#rule"),i=$("#rule_list"),e=$("#movieinfo"),o=$("#movieinfolist");t.click(function(){i.toggle(),$(this).toggleClass("mod_tit")}),e.click(function(){o.toggle(),$(this).toggleClass("mod_tit")})}function m(t){function i(t){200002==t.errorNo?(o.html("手机号有误！"),o.removeClass("vhide"),f(o)):300002==t.errorNo?(n.html("您的限额已经用完！"),n.removeClass("vhide"),f(n)):300003==t.errorNo?(n.html("您只能购买"+t.res_num+"张票了哦！"),n.removeClass("vhide"),f(n)):0==t.errorNo&&(window.location.href=t.topayURL)}var e=t,o=$("#phoneMsg"),n=$("#numMsg");$("#submitBtn").click(function(){var t=$("#phone").val(),n=y+"/detail?qt=mcdkey&from=webapp&act=corder&act_id="+e.act_id+"&sign="+e.sign+"&phone="+t+"&num="+g,a={url:n,type:"GET",dataType:"json",crossDomain:!0,data:null,callback:i};if(g){if(!t)return o.html("手机号有误！"),o.removeClass("vhide"),f(o),void 0;_.addStat(STAT_CODE.PLACE_BUYCODES_PV,{state:"buyCodes"}),c(a)}})}function f(t){var i=window.setTimeout(function(){t.addClass("vhide"),window.clearTimeout(i)},5e3)}function v(t){n();var i=o();s(i),l(),p(),m(t)}var y="http://"+window.location.host,h=t("common:widget/geolocation/location.js"),_=t("common:widget/stat/stat.js"),g=1;e.exports={initialize:v}});