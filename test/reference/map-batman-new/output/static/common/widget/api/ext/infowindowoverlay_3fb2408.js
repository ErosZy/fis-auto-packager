define("common:widget/api/ext/infowindowoverlay.js",function(i,t,n){function e(){this.type=0,this.point=null,this.json={},this.points={},this.cityCode=null,this.index=-1,this.offsetX=0,this.offsetY=0,this.visible=!1}var s=i("common:widget/pagemgr/pagemgr.js");e.prototype=new BMap.Overlay,$.extend(e.prototype,{initialize:function(i,t){this._map=i;var n=this.container=this._createContainer(t);this.create(t),i.getPanes().floatPane.appendChild(n),$(n).parent().css({"z-index":800}),this._bindEvent()},_createContainer:function(){return $("<ul />",{"class":"iw-ct"}).get(0)},create:function(){return $(this.container).append($("<li />",{"class":"iw-l",css:{display:""},"data-iw-id":"iw-l"})).append($("<li />",{"class":"iw-c","data-iw-id":"iw-c"})).append($("<li />",{"class":"iw-r",css:{display:""},"data-iw-id":"iw-r"}))},_bindEvent:function(){var i=this,t=$(this.container).find("li"),n=s.isSinglePageApp()?"click":"tap";t.on(n,function(t){i.visible&&listener.trigger("infowindow."+i.type,"click",{id:$(t.target).data("iw-id")||$(t.target).parents("[data-iw-id]").data("iw-id"),data:i.getData(i.type,i.index),instance:i})}),t.on("touchstart",function(t){t.touches&&t.touches.length>1?t.cancelBubble=!0:i.handled=!0})},setData:function(i,t){return this.type=i,t.json&&(this.json[i]=t.json),t.points&&(this.points[i]=t.points),t.cityCode&&(this.cityCode=t.cityCode),this},getData:function(i,t){var n=this.json[i];if(n)return t>-1&&void 0!==n[t]?n[t]:n},hide:function(){$(this.container).hide(),this.visible=!1},show:function(){$(this.container).css({visibility:"hidden"}).show(),this.html().draw(),$(this.container).css({visibility:""}),this.visible=!0;var i=this;this.timer||(this.timer=setTimeout(function(){i.setPosition(),clearTimeout(i.timer),i.timer=null},100))},html:function(i){var t=$(this.container),n=t.find(".iw-c");return n.html(i||this.content),this.width=t.width(),this.height=t.height(),this},draw:function(){var i=$(this.container),t=8,n=this.width/2+(this.offsetX||0),e=this.height+t+(this.offsetY||0);if(this.point){var s=this._map.pointToOverlayPixel(this.point),o=s.x-n,a=s.y-e;i.css({left:o+"px",top:a+"px"})}},setPosition:function(){if(this.point){var i=this._map,t=this.point,n=i.pointToPixel(t),e=new BMap.Pixel(0,0),s=i.getSize(),o=this.width/2+16,a=this.height/2+78;n.x<o?e.x=o-n.x:s.width-n.x-8<o&&(e.x=s.width-n.x-8-o),n.y<a?e.y=a-n.y:s.height-n.y<60&&(e.y=s.height-n.y-60),i.panBy(e.x,e.y),setTimeout(function(){i.centerAndZoom(i.getCenter(),i.getZoom())},450)}}}),e._className_="InfoWindowOverlay",n.exports=e});