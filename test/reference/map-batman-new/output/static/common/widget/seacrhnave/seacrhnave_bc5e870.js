define("common:widget/seacrhnave/seacrhnave.js",function(t,e,o){t("common:static/js/gmu/src/widget/suggestion/suggestion.js"),t("common:static/js/gmu/src/widget/suggestion/renderlist.js"),t("common:static/js/gmu/src/widget/suggestion/quickdelete.js"),t("common:static/js/gmu/src/widget/suggestion/sendrequest.js");var s=(t("common:static/js/util.js"),t("common:widget/geolocation/location.js")),r=t("common:widget/popup/popup.js"),n=t("common:widget/url/url.js"),i=t("common:widget/stat/stat.js"),a=t("common:widget/seacrhnave/searchboxmodel.js"),d="我的位置",l=!1;o.exports={init:function(){this.render(),this.bind();var t=this._getPagetype();t.isSelf||(this[t.elSelf].val(t.word),this.model.set([t.el],{word:t.word,point:t.point})),this.revertLast()},render:function(){var t=this,e=n.get(),o=e.pageState||{};t.seStart=$("#se_txt_start"),t.seEnd=$("#se_txt_end"),t.maskid=$("#se_wrap"),t.reverseBtn=$("#se_dir_reverse"),t.model=a,t.urlstart=t._proceedUrl(o.start),t.urlend=t._proceedUrl(o.end),t.pagetype=t._getPagetype(),t.selement=$("#se_txt_start, #se_txt_end"),t.submitbtn=$(".se-btn-tr"),t.sedirform=$(".se-dir-form")},revertLast:function(){var t=this;if(""===$.trim(t.seEnd.val())){var e=this.model.get("start")||{},o=this.model.get("end")||{};e.word&&t.seStart.val(e.word),o.word&&t.seEnd.val(o.word)}},_proceedUrl:function(t){var e=!1;if(void 0!=t){e={word:"",point:""};var o=t.trim().split("&");o[0]&&(e.word=decodeURIComponent(o[0].split("=")[1])),o[1]&&(e.point=decodeURIComponent(o[1].split("=")[1]))}return e},bind:function(){var t=this;$(window).on("pageshow",function(){l&&setTimeout(function(){t._setLocation()},0)}),t._poiSugStart=new gmu.Suggestion("#se_txt_start",{form:t.sedirform,source:"http://map.baidu.com/su",cbKey:"callback",listCount:6,posAdapt:!1,historyShare:!0,autoClose:!0,appendContanier:"#wrapper",quickdelete:!0}),t._poiSugStart.$wrapper.offset({left:0,top:194}),$("#se_txt_start").on("focus",function(){t._poiSugEnd&&t._poiSugEnd.hide()}),t._poiSugEnd=new gmu.Suggestion("#se_txt_end",{form:t.sedirform,source:"http://map.baidu.com/su",cbKey:"callback",listCount:6,posAdapt:!1,historyShare:!0,autoClose:!0,appendContanier:"#wrapper",quickdelete:!0}),t._poiSugEnd.$wrapper.offset({left:0,top:194}),$("#se_txt_end").on("focus",function(){t._poiSugStart&&t._poiSugStart.hide()}),t.reverseBtn.on("touchstart",$.proxy(t._reverse,this)),t.reverseBtn.on("touchend",$.proxy(t._reverseEnd,this));var e=function(){l=!!s.getMyLocation().point,t._setLocation()};s.getMyLocation()?e():listener.on("common.geolocation","mylocsuc",function(){e()},this),t.selement.on("focus",$.proxy(t._focus,this)),t.selement.on("blur",$.proxy(t._blur,this)),t.selement.on("mousedown",$.proxy(t._touchstart,this)),t.submitbtn.on("click",$.proxy(t._poiSubmit,this)),t.submitbtn.on("touchend",$.proxy(t._poiSubmitEnd,this)),t.selement.on("mousedown",$.proxy(t._touchstart,this)),t.sedirform.on("submit",$.proxy(this._poiSubmit,this)),listener.on("common.page","switchstart",function(){$(".ui-suggestion").length&&$(".ui-suggestion").hide()})},_getPagetype:function(){var t=this,e={elSelf:"",el:"seStart",key:"start",isSelf:!1,word:"",point:""};return t.urlend?(e.elSelf="seEnd",e.word=t.urlend.word,e.point=t.urlend.point):t.urlstart?(e.key="end",e.el="seEnd",e.elSelf="seStart",e.word=t.urlstart.word,e.point=t.urlend.point):e.isSelf=!0,e},_checkInput:function(t){return t?/\S+/.test(t.val())?t.val()==d&&this.model.get("geo").word!=d?(t.val(""),r.open({text:"定位失败！"}),!1):!0:(t.focus(),!1):!1},_getGeoData:function(){{var t={word:"",point:"",citycode:""};s.getLocation()}return l&&(t={word:d,point:s.getMyPointX()+","+s.getMyPointY(),citycode:s.getMyCityCode()}),t},_reverse:function(){var t=this,e={start:$("#se_txt_start").val(),end:$("#se_txt_end").val()};t.reverseBtn.addClass("active"),t.seStart.val(e.end),t.seEnd.val(e.start),t.model.set("end",t.model.get("start")),t.model.set("start",t.model.get("end")),t._update()},_reverseEnd:function(){this.reverseBtn.removeClass("active")},_update:function(){var t=this,e=t.seStart,o=t.seEnd,s=t.model.get("geo");e.val()==d&&s.word==d&&l?(e.addClass("geo"),o.removeClass("geo")):e.removeClass("geo"),o.val()==d&&s.word==d&&l?(o.addClass("geo"),e.removeClass("geo")):o.removeClass("geo")},_setLocation:function(){var t=this,e=(t.seStart,t.seEnd,t.pagetype),o=t._getGeoData();l&&""===$.trim(t[e.el].val())&&t[e.el].val(d),e.key&&t.model.set(e.key,o);var s=t.model.get("geo");(!s.point||o&&""!==o.point)&&t.model.set("geo",o),t._update()},_focus:function(t){var e=$(t.target),o=$(".se-inner");$(".ui-suggestion").css("width","100%"),e.hasClass("se_txt_start")&&(o[0].style.border="1px solid #D55959",o[1].style.border="1px solid #d9d9d9"),e.hasClass("se_txt_end")&&(o[0].style.border="1px solid #d9d9d9",o[1].style.border="1px solid #D55959"),e.val()==d&&(e.val(""),e.trigger("focus")),e.removeClass("geo")},_blur:function(t){var e=this,o=$(t.target),s=o.attr("key"),n=e.model.get("geo"),i=n.word!=d&&a==d&&l,a=o.val().trim();if(i&&(o.val(""),r.open({text:"定位失败！"})),n.point&&""==a&&l){e.model.get(s).word==n.word&&(o.val(d),o.addClass("geo"));var u="start"==s?"seStart":"seEnd";$.trim(e.seStart.val())!=d&&$.trim(e.seEnd.val())!=d&&(e.model.set(s,e._getGeoData()),e.model.set(u,{word:""}))}},_fixDirData:function(){var t=$(".se-dir-form input[type=text]"),e=this._getPagetype();ptIsSelf=e.isSelf,me=this,$.each(t,function(){var t=$(this).attr("key"),o=$("#se_txt_"+t),s=me.model.get(t),r=s.word!=o.val();(!s.word||r)&&(o.val()===d&&l?me.model.set(t,me._getGeoData()):ptIsSelf||o.val()!=e.word?me.model.set(t,{word:o.val()}):me.model.set(t,{word:e.word,point:e.point}))})},_touchstart:function(t){var e=$(t.target);e.focus(),t.stopPropagation()},_getDirParam:function(t,e,o,r){var n,i=s.getCityCode()||1,a=this._getTabIndex("search",t),d=e.citycode||i,l=o.citycode||i,u=d||i;if(e.point&&o.point||!e.point&&!o.point)n={qt:["s","bt","nav","walk"][a]||"bt",sn:this._joinParam(e),en:this._joinParam(o),sc:d,ec:l,c:u,pn:"0",rn:"5"};else{var c,p,m,g;e.point?(c=e,g=o,p="sn",m="1"):(c=o,g=e,p="en",m="0");var _=["s","bse","nse","wse"][a]||"bse",v=c.point;n={qt:_,ptx:v.split(",")[0],pty:v.split(",")[1],wd:g.word||"",name:c.word||"",c:i,sc:e.citycode||i,ec:o.citycode||i,isSingle:"true"},n[_+"tp"]=m,n[p]=this._joinParam(c)}return r&&r.from&&(n.searchFlag=r.from||""),["nav","nse","walk","wse"].indexOf(n.qt)>=0&&(n.version="3"),["bse","bt"].indexOf(n.qt)>=0&&(n.version="5",n.exptype="dep"),n},_poiSubmit:function(t){t&&t.stopPropagation&&t.stopPropagation(),t&&t.preventDefault&&t.preventDefault();var e,o=t;o.currentTarget&&(e=$(t.currentTarget).attr("data-value"));var s=$(o.currentTarget);s.addClass("active");var r=this,a=r.seStart,l=r.seEnd;if(!r._checkInput(a)||!r._checkInput(l))return!1;switch(this._fixDirData(),e){case"1":i.addCookieStat(COM_STAT_CODE.STAT_BUS_SEARCH);break;case"2":i.addCookieStat(COM_STAT_CODE.STAT_NAV_SEARCH);break;case"3":i.addCookieStat(COM_STAT_CODE.STAT_WALK_SEARCH)}e||(e="1");var u=r._getDirParam(e,this.model.get("start"),this.model.get("end"),t);a.val()!=d&&this._poiSugStart&&this._poiSugStart.history(a.val()),l.val()!=d&&this._poiSugEnd&&this._poiSugEnd.history(l.val()),n.update({module:"search",action:"search",query:u})},_poiSubmitEnd:function(t){var e=t,o=$(e.target);o.removeClass("active")},_getTabIndex:function(t,e){if(!isNaN(e)){var o=this._num2str(t,e),s=this._str2num(t,o);return s}return"string"==typeof e?this._str2num(t,e):void 0},_getTabStr:function(t,e){if(!isNaN(e))return this._num2str(t,e);if(_.isString(e)){var o=this._str2num(t,e),s=this._num2str(t,o);return s}},_num2str:function(t,e){return"tab"==t?["place","line"][e]||"place":["place","transit","drive","walk"][e]||"place"},_str2num:function(t,e){return"tab"==t?{plcae:0,line:1}[e]||0:{place:0,transit:1,drive:2,walk:3}[e]||0},_joinParam:function(t){if(!t)return"";var e=t.point?"1":"2",o=t.uid||"",s=t.point||"",r=t.word||"";return[e,o,s,r,""].join("$$")}}});