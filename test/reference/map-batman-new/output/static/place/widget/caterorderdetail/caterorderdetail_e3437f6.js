define("place:widget/caterorderdetail/caterorderdetail.js",function(require,exports,module){require("place:static/lib/template.js");var url=require("common:widget/url/url.js"),util=require("common:static/js/util.js"),popup=require("common:widget/popup/popup.js"),DEFAULT_ERROR_MSG="网络连接失败",DATA_TYPE="json",HOST="",ORDER_LIST_URL="/mobile/webapp/place/cater/force=superman&qt=orderlist{{kehuduan}}?mobile=",ORDER_SEARCH_URL="/mobile/webapp/place/cater/force=superman&qt=searchorder{{kehuduan}}",CANCEL_AJAX_URL=HOST+"/detail?qt=cater_ordercancel",DETAIL_AJAX_URL=HOST+"/detail?qt=cater_orderdetail",STATUS_MSG={1:"等待确认",2:"下单成功",3:"订单已取消",4:"预订失败"},getStatusDesc=function(e){var t=Math.floor(e/100);return STATUS_MSG[t]||""},getRoomLabel=function(e,t){var a="大厅";return"1"===e&&(t=parseInt(t,10)||0,a="包间"+(t?"（"+t+"人间）":"")),a},defError=function(e){e=e||{},popup.open(e.errorMsg||DEFAULT_ERROR_MSG)},CaterOrderDetail=function(){var urlData=util.urlToJSON(window.location.search.replace("?",""));this.template=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push(""),"undefined"!=typeof order_id?(_template_fun_array.push('    <div class="orderinfo">        <p>订单状态：<span data-node="statusDesc">',"undefined"==typeof status_desc?"":baidu.template._encodeHTML(status_desc),"</span></p>        <p>订单号：","undefined"==typeof order_id?"":baidu.template._encodeHTML(order_id),'</p>    </div>    <div class="item shopinfo">        <h4>',"undefined"==typeof shop_name?"":baidu.template._encodeHTML(shop_name),"</h4>        <p>            ","undefined"==typeof room?"":baidu.template._encodeHTML(room),"        "),"undefined"!=typeof min_cost&&min_cost&&_template_fun_array.push("            最低消费：","undefined"==typeof min_cost?"":baidu.template._encodeHTML(min_cost),"元        "),_template_fun_array.push("        </p>        <p>入店时间：","undefined"==typeof order_time?"":baidu.template._encodeHTML(order_time),"</p>        <p>最晚到店时间：","undefined"==typeof keep_time?"":baidu.template._encodeHTML(keep_time),"</p>        <p>地址：","undefined"==typeof address?"":baidu.template._encodeHTML(address),'</p>    </div>    <div class="item">        <p class="userinfo">            <span class="username">联系人信息：                '),"undefined"!=typeof gender&&"0"==gender?_template_fun_array.push("                    ","undefined"==typeof user_name?"":baidu.template._encodeHTML(user_name),"先生                "):_template_fun_array.push("                    ","undefined"==typeof user_name?"":baidu.template._encodeHTML(user_name),"女士                "),_template_fun_array.push('            </span>            <span class="tel">电话：',"undefined"==typeof mobile?"":baidu.template._encodeHTML(mobile),"</span>        </p>        "),Math.floor(status/100)>2&&_template_fun_array.push('            <div class="help">                <p class="label">其他帮助</p>                <div class="info">                    <p class="help-tel">                        <span>百度客服电话：</span>                        <a href="tel:(400-0998-998)">                            <b class="tel-icon-b"></b>                            400-0998-998                        </a>                    </p>                </div>            </div>        '),_template_fun_array.push("    </div>    "),"1"==can_cancel&&_template_fun_array.push('        <div class="cancel">            <div class="btn" data-action="cancelOrder">取消订单</div>        </div>    '),_template_fun_array.push("")):_template_fun_array.push('    <div class="error">订单错误</div>'),_template_fun_array.push(""),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],this.mobile=urlData.mobile,this.orderId=urlData.orderid,this.$el=$("#place-widget-caterorderdetail"),this.init()};CaterOrderDetail.prototype={init:function(){this.bindEvent(),this.getOrderDetail()},formatRS:function(e){e=e||{};var t=1e3*parseInt(e.order_time||0,10),a=parseInt(e.keep_time||0,10);return e.status_desc=getStatusDesc(e.status),e.room=getRoomLabel(e.need_room,e.room_size),e.order_time=new Date(t).format("yyyy-MM-dd hh:mm"),e.keep_time=new Date(t+60*a*1e3).format("hh:mm"),e},render:function(e){var t=e.data||[];this.$el.html(this.template(this.formatRS(t[0]))),this.$statusDesc=this.$el.find('[data-node="statusDesc"]')},getOrderDetail:function(){$.ajax({url:DETAIL_AJAX_URL,type:"GET",dataType:DATA_TYPE,context:this,data:{orderId:this.orderId,mobile:this.mobile},cache:!1,success:function(e){e&&0===e.errorNo||(8e3===e.errorNo?url.navigate(ORDER_SEARCH_URL):url.navigate(ORDER_LIST_URL+this.mobile)),this.render(e)},error:defError})},onCancelOrderClick:function(e){var t=$(e.currentTarget);$.ajax({url:CANCEL_AJAX_URL,type:"POST",dataType:DATA_TYPE,data:{orderId:this.orderId,mobile:this.mobile},context:this,success:function(e){return 0!==e.errorNo?defError(e):(t.remove(),this.$statusDesc.html(STATUS_MSG["3"]),void 0)},error:defError})},bindEvent:function(){this.onCancelOrderClickHandle=$.proxy(this.onCancelOrderClick,this),this.$el.delegate("[data-action=cancelOrder]","click",this.onCancelOrderClickHandle)},unbindEvent:function(){this.$el.undelegate("[data-action=cancelOrder]","click",this.onCancelOrderClickHandle)},destroy:function(){this.unbindEvent()}},exports.init=function(e){return e=e||{},ORDER_LIST_URL=ORDER_LIST_URL.replace("{{kehuduan}}",e.kehuduan?"&kehuduan=1":""),ORDER_SEARCH_URL=ORDER_SEARCH_URL.replace("{{kehuduan}}",e.kehuduan?"&kehuduan=1":""),new CaterOrderDetail}});