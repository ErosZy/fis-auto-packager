define("common:widget/api/ext/geocontrol.js",function(t,e,o){function n(){i.isIPad()?(this.defaultAnchor=BMAP_ANCHOR_TOP_RIGHT,this.defaultOffset=new BMap.Size(16,80)):(this.defaultAnchor=BMAP_ANCHOR_BOTTOM_LEFT,this.defaultOffset=new BMap.Size(8,14))}var i=t("common:static/js/util.js"),a=t("common:widget/url/url.js"),s=t("common:widget/map/map.js"),c=t("common:widget/geolocation/location.js"),r=t("common:widget/popup/popup.js"),d=t("common:widget/stat/stat.js"),l=function(){this.defaultAnchor=BMAP_ANCHOR_BOTTOM_LEFT,this.defaultOffset=new BMap.Size(48,14)};l.prototype=new BMap.Control,$.extend(l.prototype,{initialize:function(t){this._map=t;var e=this._container=document.createElement("div");return e.className="map-geo-info",$(e).html("<b></b><em></em>"),t.getContainer().appendChild(e),this.bind(),e},bind:function(){$(this._container).on("click",function(){d.addCookieStat(COM_STAT_CODE.MAP_GEO_ADDR_CLICK),a.update({module:"index",action:"mylocation",pageState:{vt:""}},{trigger:!0})})},text:function(t){$(this._container).find("b").text(t||"")},hide:function(){s.scaleControl&&s.scaleControl.show(),BMap.Control.prototype.hide.call(this)}}),n.prototype=new BMap.Control,n.prototype.initialize=function(t){this._map=t;var e=this._container=document.createElement("div");return e.className="map-geo",this._geoBtn=document.createElement("div"),this._geoBtn.innerHTML='<div class="geo-btn" id="geoState"><b class="index-loc-pic"></b></div>',e.appendChild(this._geoBtn),t.getContainer().appendChild(e),this.bind(),this._geo=!1,this.resetGeoBtn(),i.isIPad()||(this._infoBar=new l,t.addControl(this._infoBar),this._infoBar.hide()),e},n.prototype.bind=function(){var t=(this._map,this);t._geoBtn=$(t._geoBtn.children[0]),t._geoBtn.on("click",function(){d.addStat(COM_STAT_CODE.MAP_GEO_ICON_CLICK),t._geo=!0,c.startGeo()}),listener.on("common.geolocation","success",function(){t.resetGeoBtn();var e=a.get();1!=t._geo||i.isIPad()||"index"!=e.module||"index"!=e.action||(t._infoBar.text(c.getAddress()),t._infoBar.show(),s.scaleControl&&s.scaleControl.hide())}),listener.on("common.geolocation","fail",function(){1==t._geo&&(0==t._geo,r.open({text:"无法获取您的精确定位，请开启浏览器定位功能，刷新页面并选择允许定位。"})),t.resetGeoBtn()})},n.prototype.resetGeoBtn=function(){var t=this;c.hasExactPoi()?t._geoBtn.removeClass("geo-fail"):t._geoBtn.addClass("geo-fail")},n.prototype.hideInfoBar=function(){this._infoBar&&this._infoBar.hide()},n._className_="GeoControl",o.exports=n});