define("drive:widget/helper/maphelper.js",function(t,e,s){var i,o,r=t("common:static/js/util.js"),n=t("common:widget/url/url.js"),a=t("common:static/js/mapconst.js"),h=t("common:widget/appresize/appresize.js"),p=t("common:widget/stat/stat.js");$(window).on("pageshow",function(){h.update()}),s.exports={keyMarkers:[],keyPoiInfos:[],directionMarkers:[],viewOpts:{margins:a.ROUTE_MARGINS,enableAnimation:!1},_currentStep:-1,_showAll:!0,init:function(t,e,s){i=e,o=t,this.map=i.getMap(),this.renderMap(s)},renderMap:function(t){var e=n.get(),s=e.query||{},o=e.pageState||{},a=-1,h=i._clearControl,p={};r.jsonToUrl(s)+"|"+r.jsonToUrl(p),i.displayId,"undefined"!=typeof o.step&&(a=1*o.step),$.extend(p,o),delete p.vt,delete p.step,i.clearOverlays(),this.map=i.getMap(),this.removeCurrentOverlay(),this._prepareData(t),i.addDriveRoute(this.routePoints),this.addDestPoi(),this.setView(r.getBPoints(this.routeBounds)),i.getLineStepControl().show(),this.addPopInfoWin(),h&&h.resetCleanBtn(),this.selectStep(a),i.driveData=t,i._trafficControl&&(i._trafficControl.driveData=t)},addDestPoi:function(){this.startMarker=i.addDestPoi(this.destPoints[0],a.DEST_START),this.endMarker=i.addDestPoi(this.destPoints[1],a.DEST_END),$(this.startMarker._div).on("touchend",this.getClickHandler(0)),$(this.endMarker._div).on("touchend",this.getClickHandler(this.stepPoints.length-2))},selectStep:function(t){if(i.getLineStepControl().ableBtn("pre"),i.getLineStepControl().ableBtn("next"),0>=t?i.getLineStepControl().disableBtn("pre"):t>=this.stepPoints.length-2&&i.getLineStepControl().disableBtn("next"),-1==t)return this._showAll=!0,this._currentStep=0,!1;if(0>t||t>=this.stepPoints.length-1)return!1;if(t==this._currentStep){if(0==this._showAll)return this.map.setCenter(r.getPointByStr(this.stepPoints[t].p)),void 0;this._showAll=!1}var e=i._map.zoomLevel;return this._currentStep=t,i.iwController.get(a.IW_NAV).switchTo(t),this.highRoute(t),this.addDirectionMarker(t),this.showKeyPoi(t),i._map.zoomLevel<=3&&this.map.setZoom(e),!0},pre:function(){return this.selectStep(this._currentStep-1)},next:function(){return this.selectStep(this._currentStep+1)},_prepareData:function(t){this.stepPath=[],this.routePoints=[],this.stepPath=[],this.routeBounds=[],this.destPoints=[],this.stepPoints=[],this.popInfos=[];for(var e=t.content.routes[0],s=0;s<e.legs.length;s++)for(var i=e.legs[s],o=0;o<i.steps.length;o++){var n=i.steps[o],a=r.parse2Geo(n.path);this.stepPath.push(a.points),this.routeBounds.push(a.bound),this.routePoints=this.routePoints.concat(this.pointsStringToArray(a.points)),this.stepPoints.push({p:r.parse2Geo(n.start_location).points,a:i.steps[o].direction}),this.popInfos.push({content:i.steps[o].instructions}),s==e.legs.length-1&&o==i.steps.length-1&&this.stepPoints.push({p:r.parse2Geo(n.end_location).points,a:12}),n.pois.length>0&&n.pois[0]&&(this.keyPoiInfos[o]={points:r.parse2Geo(n.pois[0].location).points,title:n.pois[0].name})}this.destPoints.push(t.result.start.pt),this.destPoints.push(t.result.end[t.result.end.length-1].pt)},pointsStringToArray:function(t){var e=t.split(";"),s=[];return $.each(e,function(t,e){var i=e.split(",");s.push(new o.Point(i[0],i[1]))}),s},addPopInfoWin:function(){var t=this.stepPoints;this.popInfos,t.length;var e=i.iwController.get(a.IW_NAV);e.setData(a.IW_NAV,{json:this.popInfos,points:this.stepPoints}).switchTo(0),i.getLineStepControl().setIWCon(this),listener.on("infowindow."+a.IW_NAV,"click",function(t,e){var s=e.id;switch(s){case"iw-c":p.addCookieStat(COM_STAT_CODE.MAP_IW_NAV_LIST),n.update({pageState:{vt:"list"}},{})}})},getClickHandler:function(t){var e=this;return function(){p.addStat(COM_STAT_CODE.MAP_NAV_DIR_MARKER_CLICK),e.selectStep(t)}},swiPop:function(t,e){i.iwController.get(a.IW_NAV).switchTo(e)},highRoute:function(t){var e=this;if(e.unselectRoute(),e.routeBounds[t]){var s=[e.routeBounds[t]],i=r.getBPoints(s);e.setView(i),e.selectRoute(t)}},addDirectionMarker:function(t){for(var e=0;e<this.directionMarkers.length;e++)this.map.removeOverlay(this.directionMarkers[e]);this.directionMarkers=[];var s=i.addDirectionMarker(this.stepPoints[t].p,this.stepPoints[t].a);this.directionMarkers.push(s);var o=i.addDirectionMarker(this.stepPoints[t+1].p,this.stepPoints[t+1].a);this.directionMarkers.push(o),$(s._div).on("touchend",this.getClickHandler(t)),$(o._div).on("touchend",this.getClickHandler(t+1))},selectRoute:function(t){var e=this,s=[];s.push(e.stepPoints[t].p),s.push(e.stepPath[t]),e.redRoute=i.addDriveRoute(s.join(";")),i.selectRoute(e.redRoute)},showKeyPoi:function(t){for(var e=0;e<this.keyMarkers.length;e++)this.map.removeOverlay(this.keyMarkers[e]);this.keyMarkers=[];var s=this.keyPoiInfos[t];s&&this.keyMarkers.push(i.addKeyPoiMarker(s.points,s.title,0))},setView:function(t){i.setViewport(t,this.viewOpts)},removePoi:function(){for(var t=0;t<this.keyMarkers.length;t++)this.map.removeOverlay(this.keyMarkers[t]);this.keyMarkers=[];for(var t=0;t<this.directionMarkers.length;t++)this.map.removeOverlay(this.directionMarkers[t]);this.directionMarkers=[],this.map.removeOverlay(this.startMarker),this.map.removeOverlay(this.endMarker)},removeRoute:function(){this.redRoute&&(this.map.removeOverlay(this.redRoute),this.redRoute=null),i.removeDriveRoute()},unselectRoute:function(){this.redRoute&&(i.removeRoute(this.redRoute),this.redRoute=null)},removeCurrentOverlay:function(){i&&(this.removePoi(),this.removeRoute(),i.getLineStepControl().hide(),i.iwController.get(a.IW_NAV).hide(),i.displayId="")}}});
;define("drive:widget/navi/navibox.js",function(n,t,i){n("common:widget/popup/popup.js"),n("common:static/js/util.js");var o={navurl:"",navOkBox:null,config:{width:276,height:126},main:$("#navOkBox"),showTb:function(n,t){if(n){var i=this,t=t||{};i.navurl=n,$("#navOkBox")[0]&&$("#navOkBox").remove();var o=[];o.push('<div id="navOkBox" class="navokbox">'),o.push('<div class="t"></div>'),o.push('<div  class="c">'),o.push('<div class="t1">'+t.description+"</div><div>"),o.push("<a href="+$.trim(n)+'><button class="bt qd cancel-navokbox" >'+t.leftBtn+"</button></a>"),o.push("<a href="+$.trim(t.naviUrl)+'><button class="bt qd cancel-navokbox" >'+t.rightBtn+"</button></a>"),o.push("</div></div></div>"),$("#wrapper").append(o.join("")),i.setPos(),i.bindEvent(t)}},bindEvent:function(n){var t=this;$("button.cancel-navokbox").on("click",function(i){i.preventDefault();var o,e=i.target,a=$.trim($(e).html()),s=$(e).parent().attr("href");"直接网页导航"==a&&"确定"==n.leftBtn?o=1:"直接网页导航"==a&&"确定下载"==n.leftBtn?o=2:"确定"==a?o=3:"确定下载"==a&&(o=4),t.c(t),setTimeout(function(){location.href=s},200)}),listener.on("common","sizechange",function(){setTimeout(function(){t.setPos()},100)})},setPos:function(){var n=(window.innerWidth-this.config.width)/2,t=(window.innerHeight-this.config.height)/2+window.scrollY;$("#navOkBox").css({left:n,top:t,position:"absolute"})},c:function(){$("#navOkBox")[0]&&$("#navOkBox").remove()}};i.exports=o});
;define("drive:widget/navi/navi.js",function(t,n,i){var o=t("drive:widget/navi/navibox.js"),a=t("common:static/js/util.js"),e={bindNav:function(){$("#nav_go_nav").on("click",$.proxy(this.goTonav,this))},bindEvent:function(){$(".gotonav").on("click",$.proxy(this.goTonav,this)),$("a").on("click",$.proxy(this._hideNavBox,this))},_hideNavBox:function(t){var n=t.target,i=$(n).closest("a"),o=i.attr("href");t.preventDefault(),o&&""!=o&&($("#navOkBox").hide(),window.location.href=o)},goTonav:function(){var t=this,n={},i="http://daohang.map.baidu.com/mobile/#navi/naving/"+a.jsonToQuery(window._APP_NAVI_QUERY)+"/vt=map&state=entry";if(a.isAndroid()){var e,r=!1;a.getNativeInfo("com.baidu.BaiduMap",function(a){if(0==a.error&&r===!1){r=!0;var e=t.getLLpoint(window._APP_NAVI_QUERY.start),v=t.getLLpoint(window._APP_NAVI_QUERY.endp),s="bdapp://map/direction?origin="+e+"&destination="+v+"&mode=navigation";return n.description="检测到您已安装百度地图，是否打开百度地图导航？",n.leftBtn="确定",n.rightBtn="直接网页导航",n.naviUrl=i,o.showTb(s,n),void 0}},function(){}),setTimeout(function(){0==r&&(r=!0,e="http://mo.baidu.com/map/code/?from=1321",t._showNavBox(e,i))},1e3)}else a.isIPhone()||a.isIPod()?location.href=i:a.isIPad()?location.href=i:(e="http://mo.baidu.com/d/map/1321/bmap_andr_1321.apk",t._showNavBox(e,i))},_showNavBox:function(t,n){var i={};i.description="下载百度地图，免费导航，精准专业！",i.leftBtn="确定下载",i.rightBtn=" 直接网页导航",i.naviUrl=n,o.showTb(t,i)},getLLpoint:function(t){var n=t.split(","),i={lng:n[0],lat:n[1]},o=this.convertMC2LL(i),o=o.lat+","+o.lng;return o},convertMC2LL:function(t){function n(t,n){if(t&&n){var i=n[0]+n[1]*Math.abs(t.lng),o=Math.abs(t.lat)/n[9],a=n[2]+n[3]*o+n[4]*o*o+n[5]*o*o*o+n[6]*o*o*o*o+n[7]*o*o*o*o*o+n[8]*o*o*o*o*o*o;return i*=t.lng<0?-1:1,a*=t.lat<0?-1:1,{lng:i,lat:a}}}var i,o;i={lng:Math.abs(t.lng),lat:Math.abs(t.lat)};for(var a=0;a<[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0].length;a++)if(i.lat>=[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0][a]){o=[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]][a];break}var e=n(t,o),t={lng:e.lng.toFixed(6),lat:e.lat.toFixed(6)};return t}};i.exports=e});