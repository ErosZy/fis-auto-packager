var BigPipe=function(){function parseJSON(json){return window.JSON?JSON.parse(json):eval("("+json+")")}function ajax(e,r,t){var n=new(window.XMLHttpRequest||ActiveXObject)("Microsoft.XMLHTTP");n.onreadystatechange=function(){4==n.readyState&&r(n.responseText)},n.open(t?"POST":"GET",e+"&t="+~~(1e6*Math.random()),!0),t&&n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.send(t)}function getCommentById(e){var r=document.getElementById(e);if(!r)return"";var t=r.firstChild.nodeValue;return t=t.substring(1,t.length-1).replace(/\\([\s\S]|$)/g,"$1"),r.parentNode.removeChild(r),t}function renderPagelet(e,r,t){if(!(e.id in t)){t[e.id]=!0,e.parent_id&&renderPagelet(r[e.parent_id],r,t);var n=document.getElementById(e.id);n||(n=document.createElement("div"),n.id=e.id,container?container.appendChild(n):document.body.appendChild(n)),n.innerHTML=e.html||getCommentById(e.html_id)}}function render(e){var r,t=pagelets.length,n={},a={},e=e||{};for(r=0;t>r;r++){var o=pagelets[r];n[o.id]=o}for(r=0;t>r;r++)renderPagelet(pagelets[r],n,a);e.trigger===!0&&trigger("pagerendercomplete",{url:pageUrl,resource:resource})}function process(e,r){function t(){var t=getNeedLoad(e.js);if(e.style){var n=document.createElement("style");n.innerHTML=e.style,document.getElementsByTagName("head")[0].appendChild(n)}r(),t?LazyLoad.js(t,function(){recordLoaded(t),e.script&&window.eval(e.script),trigger("onpageloaded")}):(e.script&&window.eval(e.script),trigger("onpageloaded"))}e.async&&require.resourceMap(e.async);var n=getNeedLoad(e.css);n?LazyLoad.css(n.reverse(),function(){recordLoaded(n),t()}):t()}function getNeedLoad(e){var r=[];if("string"==typeof e)r=[e];else if("[object Array]"===Object.prototype.toString.call(e))for(var t=0;t<e.length;t++)loadedResource[e[t]]!==LOADED&&r.push(e[t]);return 0===r.length&&(r=null),r}function recordLoaded(e){var r=e;"string"==typeof r&&(r=[r]);for(var t=0;t<r.length;t++)loadedResource[e[t]]=LOADED}function register(e){process(e,function(){render({trigger:!0}),"function"==typeof onReady&&onReady()})}function fetch(e,r,t,n){var a,o=location.href,t=t||{},i={};containerId=r;var c=function(t,a){if(o===location.href&&r==containerId){pageUrl=e;var i=parseJSON(t);resource=i,trigger("pagearrived",a),onPagelets(i,r,n)}};isCacheAvailable(e)&&t.cache!==!1?(a=getCachedResource(e),i.initiator=initiatorType.FROM_CACHE,c(a,i),statRecord(e)):ajax(e,function(r){i.initiator=initiatorType.QUICKLING,addResourceToCache(e,r),c(r,i)})}function refresh(e,r,t,n){fetch(e,r,t,n)}function asyncLoad(e,r){e instanceof Array||(e=[e]);var t,n=[],a=location.href;for(t=e.length-1;t>=0;t--){var o=e[t].id;if(!o)throw Error("[BigPipe] missing pagelet id");n.push("pagelets[]="+o)}r=r?"&"+r:"";var i=location.href.split("#")[0]+"&"+n.join("&")+"&force_mode=1&fis_widget=true"+r;ajax(i,function(e){if(a===location.href){var r=parseJSON(e);resource=r,pageUrl=i,pagelets=r.pagelets,process(r.resource_map,function(){render()})}})}function statRecord(e){if("string"==typeof e){var r=-1===e.indexOf("?")?"/?":"&";e=e+r+"pagecache=1",ajax(e,function(){})}}function addResourceToCache(e,r){resourceCache[e]={data:r,time:Date.now()}}function getCachedResource(e){return resourceCache[e]?resourceCache[e].data:void 0}function isCacheAvailable(e){return!!resourceCache[e]&&Date.now()-resourceCache[e].time<=cacheMaxTime}function onPageletArrived(e){pagelets.push(e)}function onPagelets(e,r,t){e.title&&(document.title=e.title),container=document.getElementById(r),container.innerHTML="",pagelets=e.pagelets,process(e.resource_map,function(){t&&t(),render({trigger:!0})})}function onPageReady(e){onReady=e,trigger("pageready",pagelets)}function onPageChange(e){fetch(location.pathname+(location.search?location.search+"&":"?")+"pagelets="+e)}function trigger(e){var r=events[e];if(r)for(var t=SLICE.call(arguments,1),n=0,a=r.length;a>n;n++){var o=r[n];if(o.f.apply(o.o,t)===!1)break}}function on(e,r,t){var n=events[e]||(events[e]=[]);n.push({f:r,o:t})}var pagelets=[],loadedResource={},container,containerId,pageUrl=location.pathname+(location.search?"?"+location.search:""),resource,resourceCache={},onReady,initiatorType={LANDING:0,QUICKLING:1,FROM_CACHE:2},LOADED=1,cacheMaxTime=3e5,SLICE=[].slice,events={};return{asyncLoad:asyncLoad,register:register,refresh:refresh,onPageReady:onPageReady,onPageChange:onPageChange,onPageletArrived:onPageletArrived,onPagelets:onPagelets,on:on,trigger:trigger}}();