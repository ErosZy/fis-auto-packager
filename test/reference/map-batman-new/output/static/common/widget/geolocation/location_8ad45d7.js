define("common:widget/geolocation/location.js",function(t,i,o){"use strict";var n=t("common:widget/cookie/cookie.js"),e=t("common:widget/geolocation/geolocation.js");o.exports={_location:null,_mylocation:null,_getAddr:function(){return this._location&&this._location.addr||{}},_getPoint:function(){return this._location&&this._location.point||{}},_getMyAddr:function(){return this._mylocation&&this._mylocation.addr||{}},_getMyPoint:function(){return this._mylocation&&this._mylocation.point||{}},getMyPointX:function(){var t=this._getMyPoint();return t.x?t.x:""},getMyPointY:function(){var t=this._getMyPoint();return t.y?t.y:""},getMyCityCode:function(){var t=this._getMyAddr();return t.cityCode?t.cityCode:null},getMyLocation:function(){return this._mylocation},getMyCenterPoi:function(){var t=this;return{x:t.getMyPointX(),y:t.getMyPointY()}},isGeoEnd:function(){return this._location.isGeoEnd},waitForLoc:function(t){function i(){r._isInitSuc===!1&&(r._isInitSuc=!0,e())}function o(){r._isInitSuc===!1&&(r._isInitSuc=!0,c())}var n,e,c,r=this,s=!1;r._isInitSuc=!1,"object"==typeof t&&(n=t.seconds||8,e=t.successCallback||function(){},c=t.errorCallback||function(){},s===!1&&(listener.on("common.geolocation","success",function(){i()}),listener.on("common.geolocation","fail",function(){o()}),s=!0),r.isGeoEnd()&&(r.hasExactPoi()?i():o()),setTimeout(function(){o()},1e3*n))},startGeo:function(){this._isInitSuc=!1,e.startGeo()},getUpCityCode:function(){var t=this,i=t._getAddr();return i.upCityCode},getAddress:function(){var t,i=this;return t=i._getAddr(),null!=t.address?t.address:i.getCity()+i.getDistrict()+i.getStreet()},getCity:function(){var t=this._getAddr();return t.city?t.city:""},getCityCode:function(){var t=this._getAddr();return t.cityCode?t.cityCode:""},getDistrict:function(){var t=this._getAddr();return t.district?t.district:""},getStreet:function(){var t=this._getAddr();return t.street?t.street:""},getPointX:function(){var t=this._getPoint();return t.x?t.x:""},getPointY:function(){var t=this._getPoint();return t.y?t.y:""},getCenterPoi:function(){var t=this;return{x:t.getPointX(),y:t.getPointY()}},hasExactPoi:function(){return!!this._location.isExactPoi},getLocation:function(){return this._location},getLevel:function(){var t,i=this,o=i.getCityCode();return t=this._location.level,1==o?4:(i.hasExactPoi()&&n.get("ab")&&(this._location.level=t>16?t:16),this._location.level?this._location.level:this._location.isExactPoi?15:12)},getType:function(){return this._location.type},getCityType:function(){var t,i=this;return t=i._getAddr(),t.cityType},hasGeoSuc:function(){return null!==this._location.isGeoSuc?this._location.isGeoSuc:null},getAccuracy:function(){var t=this._getAddr();return t.accuracy},isUserDeny:function(){return!!app.isUserDeny},isLocFailed:function(){return!!this._location.isGeoSuc},isUserInput:function(){return this._location.isUserInput},_isUserInput:function(t){var i=t||{};return i.isUserInput?!0:null==i.type?!0:!1},_saveLocInStorage:function(){var t=this,i=window.localStorage;if(i){if(t._location){var o=t._location.isInitGeo;delete t._location.isInitGeo;try{i.setItem("webapp-loc",JSON.stringify(t._location))}catch(n){}t._location.isInitGeo=o}if(t._mylocation){var o=t._mylocation.isInitGeo;delete t._mylocation.isInitGeo;try{i.setItem("webapp-myloc",JSON.stringify(t._mylocation))}catch(n){}t._mylocation.isInitGeo=o}}},setAddress:function(t,i){var o,n=this,e=t||{},c=e.addr||{},r=e.point||{},i=i||!1;"中国"==c.city&&(c.city="全国");var s={addr:{city:c.city?c.city:"",cityCode:c.cityCode?c.cityCode:1,district:c.district?c.district:"",street:c.street?c.street:"",accuracy:c.accuracy?c.accuracy:null,address:c.address?c.address:null,cityType:c.cityType?c.cityType:null,upCityCode:c.upCityCode?c.upCityCode:null},point:{x:r.x?r.x:null,y:r.y?r.y:null},type:e.type?e.type:null,t:e.t?e.t:(new Date).getTime(),isGeoSuc:e.isGeoSuc?!!e.isGeoSuc:null,isExactPoi:e.isExactPoi?e.isExactPoi:!1,level:e.level?e.level:!1,isSaveLocInCookie:e.isSaveLocInCookie||!1,isSaveInStorage:e.isSaveInStorage===!1?!1:!0,minutes:e.minutes?e.minutes:null,isInitGeo:i,isUserInput:this._isUserInput(e),isGeoEnd:"ip"!==e.type?!0:!1};o=s.type,0==i?n._location=s:window._NO_COVER_LOC!==!0&&(n._location=s),s.isExactPoi&&(n._mylocation=s,listener.trigger("common.geolocation","mylocsuc",s)),s.isSaveInStorage&&n._saveLocInStorage(),"ip"!==o&&listener.trigger("common.geolocation","success",n._location)}}});