define("common:widget/datescrollpick/datescrollpicker.js",function(t,i,s){function l(t,i){this.el=$(t),this.option=i||{},this._dateBox=null,this.init()}var e=t("common:static/js/iscroll.js"),o=function(t){return 0===t%4&&0!==t%100||0===t%400},r=function(t,i){var s=[31,28,31,30,31,30,31,31,30,31,30,31];return o(t)&&(s[1]=29),s[i-1]};l.getMday=r,$.extend(l.prototype,{lineHeight:48,_createDateBox:function(){this._bg=$('<div class="date-box-bg"></div>'),this._dateBox=$('<div class="date-box"/>'),this._dateBox.html('<div ><div class="hd">设置出发时间</div><div class="bd"></div><div class="ft"></div></div>'),this._bd=this._dateBox.find(".bd"),this._bd.html('<div class="ymd"></div><div class="h"></div><div class="m"></div><div name="hmsp">:</div><div class="l1"></div><div class="l2"></div><div class="l3"></div><div class="l4"></div><div class="l5"></div><div class="l6"></div>'),this._ymd=this._bd.find(".ymd"),this._h=this._bd.find(".h"),this._m=this._bd.find(".m"),this._fd=this._dateBox.find(".ft"),this._fd.html("<span>完成</span>"),this._bg.appendTo(document.body),this._bg.hide()},_insertDateContent:function(){this.buildYmd()},buildYmd:function(){for(var t=new Date,i=t.getFullYear(),s=t.getMonth()+1,l=t.getDate(),e=t.getHours(),o=t.getMinutes(),h=[],n=r(t.getFullYear(),s),a=l;n>=a;a++)h.push({y:i,m:s,d:a});var d=s+1,c=t.getFullYear();12==s&&(d=1,c+=1);for(var u=r(c,d),f=1;u>=f;f++)h.push({y:c,m:d,d:f});var v="<ul><li>&nbsp;</li>";h.forEach(function(t){var i=t.m+"月"+t.d+"日",s=new Date;s.setFullYear(t.y),s.setMonth(t.m-1),s.setDate(t.d);var l=s.format("yyyy-MM-dd");v=v+'<li id="date-'+l+'" data-date="'+l+'">'+i+"</li>"}),v+="<li>&nbsp;</li></ul>",this._ymd.html(v);for(var m="<ul><li>&nbsp;</li>",_=0;24>_;_++){var g=_==e?'class="cur"':"";_=_>=10?_:"0"+_,m=m+'<li id="hours-'+_+'" '+g+' data-h="'+_+'">'+_+"</li>"}m+="<li>&nbsp;</li></ul>",this._h.html(m);for(var b="<ul><li>&nbsp;</li>",p=0;60>p;p+=10){var g="";o>=p&&p+10>o&&(g='class="cur"');var y=0==p?"00":p;b=b+'<li id="minute-'+y+'" '+g+' data-m="'+y+'">'+y+"</li>"}b+="<li>&nbsp;</li></ul>",this._m.html(b),this._curHrEl=this._h.find(".cur"),this._curMtEl=this._m.find(".cur")},_complete:function(){this.option.onselect&&this.option.onselect.apply(this,[this.getSelectedDate()]),this.hide()},init:function(){this._createDateBox(),this._insertDateContent(),this.render(),$.isFunction(e)?this.initDateIscroll():app.loader.load(["common_iscroll"],$.proxy(this.initDateIscroll,this)),this.bind()},initDateIscroll:function(){var t=this._ymd[0],i=this._h[0],s=this._m[0],l=this;l.scrollerYmd=new e(t,{hScroll:!1,hScrollbar:!1,vScrollbar:!1,onScrollEnd:function(){l.scrollToElByY(this,t,this.y)}}),l.scrollerHr=new e(i,{hScroll:!1,hScrollbar:!1,vScrollbar:!1,onScrollEnd:function(){l.scrollToElByY(this,i,this.y)}}),l.scrollerMt=new e(s,{hScroll:!1,hScrollbar:!1,vScrollbar:!1,onScrollEnd:function(){l.scrollToElByY(this,s,this.y)}}),l.scrollToCurDate()},getSelectedDate:function(){var t=Math.abs(this.scrollerYmd.y),i=Math.abs(this.scrollerHr.y),s=Math.abs(this.scrollerMt.y),l=Math.round(t/this.lineHeight),e=Math.round(i/this.lineHeight),o=Math.round(s/this.lineHeight),r=this._ymd.find("li"),h=$(r.get(l+1)),n=this._h.find("li"),a=$(n.get(e+1)),d=this._m.find("li"),c=$(d.get(o+1)),u={datetime:h.attr("data-date")+" "+a.attr("data-h")+":"+c.attr("data-m")};return u},scrollToElByY:function(t,i,s){s=Math.abs(s);var l=Math.round(s/this.lineHeight);if(l!=this.last||t!=this.lastUseScroller){this.last=l,this.lastUseScroller=t;var e=$(i).find("li").get(l);t.scrollToElement(e,100)}},bind:function(){var t=function(t){t.preventDefault()};this._fd.on("click",$.proxy(this._complete,this)),this._dateBox.on("touchmove",t),this._bg.on("touchmove",t),this._bg.on("click",$.proxy(this.hide,this)),listener.on("common","sizechange",$.proxy(this._onglobalSizeChange,this))},_onglobalSizeChange:function(){this.setPos(),this.refresh(),this.scrollToCurDate()},setPos:function(){var t=(window.innerHeight-248)/2+window.scrollY;this._bg.css({height:window.innerHeight+window.scrollY}),this._dateBox.css({top:t})},applyTo:function(t){$(t).on("click",$.proxy(this.toggleHandler,this))},refresh:function(){this.scrollerYmd&&this.scrollerYmd.refresh(),this.scrollerHr&&this.scrollerHr.refresh(),this.scrollerMt&&this.scrollerMt.refresh()},scrollToCurDate:function(){var t=new Date,i=t.getDate(),s=t.getHours(),l=t.getMinutes();0!=l%10?(l=10*Math.floor(l/10)+10,l>=60&&(l="00",s+=1,t.setHours(s),s>=24&&(s="00",i+=1,t.setDate(i)))):l=0==l?"00":l;var e="date-"+t.format("yyyy-MM-dd"),o="hours-"+t.format("hh"),r="minute-"+l;this.scrollerYmd&&this.scrollerYmd.scrollToElement($("#"+e).prev().get(0),0),this.scrollerHr&&this.scrollerHr.scrollToElement($("#"+o).prev().get(0),0),this.scrollerMt&&this.scrollerMt.scrollToElement($("#"+r).prev().get(0),0)},toggleHandler:function(){this.show(),this.setPos(),this.refresh(),this.scrollToCurDate()},render:function(){this._dateBox.appendTo(document.body)},show:function(){this._dateBox.css({left:"50%"}),this._bg.show()},hide:function(){this._dateBox.css({left:-1e3}),this._bg.hide()}}),s.exports=l});