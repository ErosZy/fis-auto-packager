define("index:widget/nbserachbox/nbserachbox.js",function(e,t,r){var n="我的位置",a=e("common:widget/geolocation/location.js"),i=e("common:widget/url/url.js"),s=e("common:widget/stat/stat.js");r.exports={init:function(){this.render(),this.bind()},render:function(){this.searchmorenearby=$("#index-widget-nbserachbox"),this.searchInput=$("#search-input"),this.DEFAULT_VALUE="输入其他分类",this.searchBtn=$("#search-button"),this.searcForm=$("#search-form")},bind:function(){var e=this;e._renderCenterName(),e.searchInput.on("focus",$.proxy(e._clearInput,this)),e.searchInput.on("blur",$.proxy(e._resetInput,this)),e.searcForm.on("submit",$.proxy(e._searchPoint,this)),e.searchBtn.on("click",$.proxy(e._searchPoint,this))},_renderCenterName:function(){var e=this._getCenterName();me=this,me.searchmorenearby.prepend('<p id="search-more-nearby">在 <span class="center-name">'+e+"</span> 附近找</p>")},_getCenterName:function(){var e=i.get(),t=e.pageState||{},r=e.query||{},s=(r.wd||"").split("     ");return"更多"===s[1]?(this.centerName=s[0],this.centerName):t.center_name?t.center_name:a.hasExactPoi()?n:a.getCity()},_clearInput:function(e){var t=this,r=$(e.target);r.val()===t.DEFAULT_VALUE&&(r.val(""),r.removeClass("ipt-default"))},_resetInput:function(e){var t=this,r=$(e.target),n=r.val();""===$.trim(n)&&(r.val(t.DEFAULT_VALUE),r.addClass("ipt-default"))},_searchPoint:function(e){e&&e.stopPropagation&&e.stopPropagation(),e&&e.preventDefault&&e.preventDefault();var t=this,r=$("#search-input"),n=r.val();return r.get(0).blur(),t._checkValueValid(n)?(t.search($.trim(n)),!1):void 0},_checkValueValid:function(e){return""!==$.trim(e)&&$.trim(e)!==this.DEFAULT_VALUE?!0:!1},search:function(e){var t=i.get();"more"==t.action&&s.addStat(STAT_CODE.STAT_MORE_CATEGORY_SEARCH_INPUT);var r=this,n=r._getDirParam($.trim(e));i.update({module:"search",action:"search",query:n})},_getDirParam:function(e,t){if(e&&"string"==typeof e){t=t||{};var r={qt:"s",wd:this.centerName?e+" "+this.centerName:e,c:a.getCityCode()||1,searchFlag:t.from||""},n=i.get(),s=n.pageState||{};return s.nb_x&&s.nb_x?(r.nb_x=s.nb_x,r.nb_y=s.nb_y,r.center_rank=1,r.center_name=s.center_name):a.hasExactPoi()&&(r.nb_x=a.getPointX(),r.nb_y=a.getPointY(),r.center_rank=1),r.searchFlag="more_cate",r}}}});