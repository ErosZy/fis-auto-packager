define("common:widget/api/ext/geocontrol.js",function(t,o,e){function n(){i.isIPad()?(this.defaultAnchor=BMAP_ANCHOR_TOP_RIGHT,this.defaultOffset=new s.Size(16,80)):(this.defaultAnchor=BMAP_ANCHOR_BOTTOM_LEFT,this.defaultOffset=new s.Size(8,14))}var i=t("common:static/js/util.js"),a=t("common:widget/url/url.js"),s=t("common:widget/api/api.js"),c=(t("common:widget/api/ext/custommarker.js"),t("common:widget/api/ext/basecontrol.js"),t("common:widget/map/map.js")),r=t("common:widget/geolocation/location.js"),d=t("common:widget/popup/popup.js"),l=t("common:widget/stat/stat.js"),m=function(){this.defaultAnchor=BMAP_ANCHOR_BOTTOM_LEFT,this.defaultOffset=new s.Size(48,14)};m.prototype=new s.Control,$.extend(m.prototype,{initialize:function(t){this._map=t;var o=this._container=document.createElement("div");return o.className="map-geo-info",$(o).html("<b></b><em></em>"),t.getContainer().appendChild(o),this.bind(),o},bind:function(){$(this._container).on("click",function(){l.addCookieStat(COM_STAT_CODE.MAP_GEO_ADDR_CLICK),a.update({module:"index",action:"mylocation",pageState:{vt:""}},{trigger:!0})})},text:function(t){$(this._container).find("b").text(t||"")},hide:function(){c.scaleControl&&c.scaleControl.show(),s.Control.prototype.hide.call(this)}}),n.prototype=new s.Control,n.prototype.initialize=function(t){this._map=t;var o=this._container=document.createElement("div");return o.className="map-geo",this._geoBtn=document.createElement("div"),this._geoBtn.innerHTML='<div class="geo-btn" id="geoState"><b class="index-loc-pic"></b></div>',o.appendChild(this._geoBtn),t.getContainer().appendChild(o),this.bind(),this._geo=!1,this.resetGeoBtn(),i.isIPad()||(this._infoBar=new m,t.addControl(this._infoBar),this._infoBar.hide()),o},n.prototype.bind=function(){this._map;var t=this;t._geoBtn=$(t._geoBtn.children[0]),t._geoBtn.on("click",function(){l.addStat(COM_STAT_CODE.MAP_GEO_ICON_CLICK),t._geo=!0,r.startGeo()}),listener.on("common.geolocation","success",function(){t.resetGeoBtn();var o=a.get();1!=t._geo||i.isIPad()||"index"!=o.module||"index"!=o.action||(t._infoBar.text(r.getAddress()),t._infoBar.show(),c.scaleControl&&c.scaleControl.hide())}),listener.on("common.geolocation","fail",function(){1==t._geo&&(0==t._geo,d.open({text:"无法获取您的精确定位，请开启浏览器定位功能，刷新页面并选择允许定位。"})),t.resetGeoBtn()})},n.prototype.resetGeoBtn=function(){var t=this;r.hasExactPoi()?t._geoBtn.removeClass("geo-fail"):t._geoBtn.addClass("geo-fail")},n.prototype.hideInfoBar=function(){this._infoBar&&this._infoBar.hide()},n._className_="GeoControl",e.exports=n});