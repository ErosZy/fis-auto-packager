define("common:widget/api/ext/menucontrol.js",function(t,e,n){var i=t("common:static/js/util.js"),a=t("common:widget/url/url.js"),o=t("common:widget/api/api.js"),s=t("common:widget/cookie/cookie.js"),c=t("common:widget/login/login.js"),d=t("common:widget/api/ext/basecontrol.js"),r=t("common:widget/pagemgr/pagemgr.js"),u=t("common:widget/stat/stat.js"),m=function(t){this.defaultAnchor=BMAP_ANCHOR_BOTTOM_RIGHT;var e=new o.Size(53,38);i.isIPad()&&(e=new o.Size(16,62)),this.defaultOffset=e,this.menuBtn=t,this.isOn=!1};m.prototype=new d,$.extend(m.prototype,{initialize:function(t){this._map=t;var e=this._container=document.createElement("div");e.id="menu-drop-container",e.style.position="absolute",e.className="menu-ctrl-drop";var n=document.createElement("ul");n.className="menu-list-con",e.appendChild(n),$(n).html('<li id="menu-city" data-tab="1">切换城市</li><li id="menu-pano" data-tab="2">全景</li><li id="menu-info-center" data-tab="3">个人中心(<span>未登录</span>)</li><li id="menu-feedback" data-tab="4">意见反馈</li><li id="menu-download" data-tab="5" style="color:#00c;" data="">下载手机客户端</li>'),t.getContainer().appendChild(e),this.bind(),this.setCmsConfig();var i=function(){var t=a.get();"index"!==t.module||"index"!==t.action?$("#menu-city, #menu-pano, #menu-info-center").hide():$("#menu-city, #menu-pano, #menu-info-center").show()};return listener.on("common.page","switchend",i),i("init",a.get()),e},setCmsConfig:function(){$appbutton=$("#menu-download"),i.isInstalledClient(function(t){$appbutton.attr("data",t).text("打开客户端")},function(t){$appbutton.attr("data",t).text("下载手机客户端")})},bind:function(){this._map;var t=this,e=r.isSinglePageApp()?"click":"touchstart";$(this._container).on(e,function(n){"touchstart"===e&&(n.preventDefault(),n.stopPropagation()),t.onClick(n,this)}),$(this._container).find("li").on("touchstart",function(){$(this).css("background","#eee")}),$(this._container).find("li").on("touchend",function(){$(this).css("background","none")})},onClick:function(t,e){var n=a.get(),o=$(t.target).data("tab");switch(o){case 1:u.addCookieStat(COM_STAT_CODE.MAP_MENU_CHANGE_CITY_CLICK),a.update({module:"index",action:"setmylocation",query:n.query,pageState:{}},{trigger:!0,queryReplace:!0,pageStateReplace:!0});break;case 2:u.addCookieStat(COM_STAT_CODE.MAP_MENU_SVENTRY_CLICK),a.update({module:"index",action:"sventry"},{trigger:!0,pageStateReplace:!0,queryReplace:!0});break;case 3:c.checkLogin(function(t){t.status?(u.addCookieStat(COM_STAT_CODE.MAP_MENU_USER_CENTER_CLICK),c.goMycenter()):(u.addStat(COM_STAT_CODE.MAP_MENU_USER_CENTER_CLICK),c.loginAction())});break;case 4:if(u.addCookieStat(COM_STAT_CODE.MAP_MENU_FEEDBACK_CLICK),"feedback"==n.module)return;var s=n.module+"/"+n.action,d=[n.module,n.action,i.jsonToUrl(n.query),i.jsonToUrl(n.pageState)].join("/"),n={module:"feedback",action:"show",query:{page_id:encodeURIComponent(s),hash:encodeURIComponent(d)}};a.update(n,{trigger:!0,pageStateReplace:!0,queryReplace:!0});break;case 5:u.addStat(COM_STAT_CODE.MAP_MENU_BDAPP_CLICK),setTimeout(function(){window.location.href=$(t.target).attr("data")},200)}this.menuBtn.hideMenuDrop()}});var l=function(){this.defaultAnchor=BMAP_ANCHOR_BOTTOM_RIGHT;var t=new o.Size(8,16);i.isIPad()&&(t=new o.Size(16,62)),this.defaultOffset=t,this.isOn=!1};l.prototype=new d,$.extend(l.prototype,{initialize:function(t){this._map=t;var e=this._container=document.createElement("div");e.id="menu-btn-container",e.style.position="absolute",e.className="menu-ctrl-btn";var n=document.createElement("div");return n.className="menu-ctrl-icon",e.appendChild(n),t.getContainer().appendChild(e),this.bind(),e},bind:function(){var t=this._map,e=this;this._container.onclick=$.proxy(function(){u.addStat(COM_STAT_CODE.MAP_MENU_ICON_CLICK),this._menuDrop||(this._menuDrop=new m(e),t.addControl(this._menuDrop)),this._menuDrop[this.isOn?"hide":"show"](),this.isOn=!this.isOn;var n=$("#menu-info-center span");s.get("myUserName")?n.text("已登录"):c.checkLogin(function(t){t.status?n.text("已登录"):n.text("未登录")})},this)},hideMenuDrop:function(){this.isOn=!1,this._menuDrop&&this._menuDrop.hide()}}),l._className_="MenuControl",n.exports=l});