define("subway:widget/popupwindow/popupwindow.js",function(require,exports,module){var url=require("common:widget/url/url.js"),util=require("common:static/js/util.js"),Coords=require("subway:static/js/base/coords.js"),stat=require("common:widget/stat/stat.js");module.exports=$.extend({},{offset:{left:1,top:-5},init:function(data){this.data=data;var tpl=this.tpl=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';if(eval(_template_varName),_template_fun_array.push('<div id="sw_pw">    '),data.notification)_template_fun_array.push('        <div class="sw-pw-notification">这是离您最近的地铁站</div>    ');else{_template_fun_array.push('        <ul class="sw-pw-title">            <li class="sw-pw-tl"></li>            <li class="sw-pw-tc">',"undefined"==typeof data.station.lb?"":data.station.lb,'</li>            <li class="sw-pw-tr"></li>        </ul>        <div class="sw-pw-content">            ');for(var i=0;i<data.lines.length;i++){_template_fun_array.push('                <div class="sw-pw-line">                    <div class="sw-pw-line-title" style="border-color:',"undefined"==typeof data.lines[i].color?"":data.lines[i].color,'">                        <span class="line_title_content" style="background-color:',"undefined"==typeof data.lines[i].color?"":data.lines[i].color,'">',"undefined"==typeof data.lines[i].name?"":data.lines[i].name,"</span>                    </div>                    ");for(var j=0;j<data.lines[i].dirs.length;j++)_template_fun_array.push("                        "),data.lines[i].dirs[j].startTime&&data.lines[i].dirs[j].endTime&&_template_fun_array.push('                        <ul class="sw-pw-line-list">                            <li class="sw-pw-line-dir">                                <span class="sw-pw-line-dir-name">',"undefined"==typeof data.lines[i].dirs[j].name?"":data.lines[i].dirs[j].name,'</span><span class="sw-pw-text-gray">方向</span>                            </li>                            <li class="sw-pw-line-time">                                <span class="sw-pw-text-gray-bkg">始</span><span class="sw-pw-text-inline-block">',"undefined"==typeof(data.lines[i].dirs[j].startTime||"00:00")?"":data.lines[i].dirs[j].startTime||"00:00",'</span><span class="sw-pw-text-gray-bkg">末</span><span class="sw-pw-text-inline-block">',"undefined"==typeof(data.lines[i].dirs[j].endTime||"00:00")?"":data.lines[i].dirs[j].endTime||"00:00","</span>                            </li>                        </ul>                        "),_template_fun_array.push("                    ");_template_fun_array.push("                </div>            ")}_template_fun_array.push("        </div>    ")}_template_fun_array.push("</div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],$el=this.$el=$(tpl({data:data}));$("#sw_renderer").append($el),this.bind()},bind:function(){var t=this,a=$(".sw-pw-tl");a.on("touchstart",function(t){a.start={x:t.touches[0].pageX,y:t.touches[0].pageY},t.target.handled=!0}),a.on("click",function(e){if(a.start){var s=e.pageX-a.start.x,i=e.pageY-a.start.y,n=s*s+i*i;if(n>100)return a.start=null,void 0}a.start=null,t.nbSearch()});var e=$(".sw-pw-tr");e.on("touchstart",function(t){e.start={x:t.touches[0].pageX,y:t.touches[0].pageY},t.target.handled=!0}),e.on("click",function(a){if(e.start){var s=a.pageX-e.start.x,i=a.pageY-e.start.y,n=s*s+i*i;if(n>100)return e.start=null,void 0}e.start=null,t.lineSearch()});var s=$(".sw-pw-tc, .sw-pw-content");s.on("touchstart",function(t){s.start={x:t.touches[0].pageX,y:t.touches[0].pageY},t.target.handled=!0}),s.on("click",function(a){if(s.start){var e=a.pageX-s.start.x,i=a.pageY-s.start.y,n=e*e+i*i;if(n>100)return s.start=null,void 0}s.start=null,t.poiSearch()})},destroy:function(){$(".sw-pw-tl, .sw-pw-tr, .sw-pw-tc, .sw-pw-content").off(),this.$el.remove()},show:function(t,a){var e=this.$el;e.css({visibility:"hidden"}).show();var s=this.width=parseFloat(e.width()),i=this.height=parseFloat(e.height());e.css({left:t.x-s/2+this.offset.left,top:t.y-i/2+this.offset.top,visibility:""}),a&&a(s/2,i/2)},hide:function(){this.$el.hide()},move:function(t,a){var e=this.$el,s=parseFloat(e.css("left")),i=parseFloat(e.css("top"));e.css({left:s+t,top:i+a})},setPosition:function(t,a){var e=this.$el;e.css({left:t-this.width/2+this.offset.left,top:a-this.height+this.offset.top})},getPosition:function(){var t=this.$el;return{left:parseFloat(t.css("left")),top:parseFloat(t.css("top"))}},getPoint:function(){return new Coords(this.data.x,this.data.y)},nbSearch:function(){stat.addCookieStat(STAT_CODE.SUBWAY_IW_NB_SEARCH);var t=this.data,a={nb_x:t.lng,nb_y:t.lat,center_name:t.station.lb||"",from:"searchnearby"};url.update({module:"index",action:"searchnearby",query:{foo:"bar"},pageState:a},{trigger:!0,queryReplace:!0,pageStateReplace:!0})},lineSearch:function(){stat.addCookieStat(STAT_CODE.SUBWAY_IW_LINE_SEARCH);var t=this.data,a={word:t.station.lb||"",point:t.lng+","+t.lat},e={};e.end=util.jsonToQuery(a),url.update({module:"place",action:"linesearch",query:{foo:"bar"},pageState:e},{trigger:!0,pageStateReplace:!0,queryReplace:!0})},poiSearch:function(){this.data.uid&&(stat.addCookieStat(STAT_CODE.SUBWAY_IW_DETAIL_SEARCH),url.update({module:"place",action:"detail",query:{qt:"inf",uid:this.data.uid}},{trigger:!0,pageStateReplace:!0,queryReplace:!0}))}})});