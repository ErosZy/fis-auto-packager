define("third:widget/searchline/searchline.js",function(t,e,r){t("common:static/js/gmu/src/core/widget.js");var o=(t("common:static/js/util.js"),t("common:widget/geolocation/location.js")),s=t("common:widget/popup/popup.js"),n=t("common:widget/url/url.js").get(),a=t("common:widget/url/url.js"),i=t("common:widget/stat/stat.js"),d="我的位置",l=!1;r.exports={init:function(){this.render(),this.bind();var t=this._getPagetype();t.isSelf||(this[t.elSelf].val(t.word),this.model.set([t.el],{word:t.word,point:t.point}))},render:function(){var e=this;e.sestart=$("#se_txt_start"),e.seend=$("#se_txt_end"),e.maskid=$("#se_wrap"),e.reverseBtn=$("#se_dir_reverse"),e.model=t("third:widget/searchline/searchboxmodel.js"),e.urlstart=e._proceedUrl(n.pageState.start),e.urlend=e._proceedUrl(n.pageState.end),e.pagetype=e._getPagetype(),e.selement=$("#se_txt_start, #se_txt_end"),e.submitbtn=$(".se-btn-tr"),e.sedirform=$(".se-dir-form")},_proceedUrl:function(t){var e=!1;return void 0!=t&&(e={word:"",point:""},datarr=t.trim().split("&"),datarr[0]&&(e.word=decodeURIComponent(datarr[0].split("=")[1])),datarr[1]&&(e.point=decodeURIComponent(datarr[1].split("=")[1]))),e},bind:function(){var t=this;$(window).on("pageshow",function(){l&&setTimeout(function(){t._setLocation()},0)}),t.reverseBtn.on("touchstart",$.proxy(t._reverse,this)),t.reverseBtn.on("touchend",$.proxy(t._reverseEnd,this)),listener.on("common.geolocation","mylocsuc",function(){var t=this;l=!!o.getMyLocation().point,t._setLocation()},this),t.selement.on("focus",$.proxy(t._focus,this)),t.selement.on("blur",$.proxy(t._blur,this)),t.selement.on("mousedown",$.proxy(t._touchstart,this)),t.submitbtn.on("touchstart",$.proxy(t._poiSubmit,this)),t.submitbtn.on("touchend",$.proxy(t._poiSubmitEnd,this)),t.selement.on("mousedown",$.proxy(t._touchstart,this)),t.sedirform.on("submit",$.proxy(this._poiSubmit,this))},_getPagetype:function(){var t=this;return result={elSelf:"",el:"sestart",key:"start",isSelf:!1,word:"",point:""},t.urlend?(result.elSelf="seend",result.word=t.urlend.word,result.point=t.urlend.point):t.urlstart?(result.key="end",result.el="seend",result.elSelf="sestart",result.word=t.urlstart.word,result.point=t.urlend.point):result.isSelf=!0,result},_checkInput:function(t){return t?/\S+/.test(t.val())?t.val()==d&&this.model.get("geo").word!=d?(t.val(""),s.open({text:"定位失败！"}),!1):!0:(t.focus(),!1):!1},_getGeoData:function(){var t={word:"",point:"",citycode:""};return o.getLocation(),l&&(t={word:d,point:o.getMyPointX()+","+o.getMyPointY(),citycode:o.getMyCityCode()}),t},_reverse:function(){var t=this,e={start:$("#se_txt_start").val(),end:$("#se_txt_end").val()};t.reverseBtn.addClass("active"),t.sestart.val(e.end),t.seend.val(e.start),t.model.set("end",{word:e.start}),t.model.set("start",{word:e.end}),t._update()},_reverseEnd:function(){this.reverseBtn.removeClass("active")},_update:function(){var t=this,e=t.sestart,r=t.seend,o=t.model.get("geo");e.val()==d&&o.word==d&&l?(e.addClass("geo"),r.removeClass("geo")):e.removeClass("geo"),r.val()==d&&o.word==d&&l?(r.addClass("geo"),e.removeClass("geo")):r.removeClass("geo")},_setLocation:function(){var t=this;t.sestart,t.seend,result=t.pagetype,geoData=t._getGeoData(),l&&t[result.el].val(d),result.key&&t.model.set(result.key,geoData);var e=t.model.get("geo");(!e.point||geoData&&""!==geoData.point)&&t.model.set("geo",geoData),t._update()},_focus:function(t){var e=$(t.target),r=$(".se-inner");e.hasClass("se_txt_start")&&(r[0].style.border="1px solid #D55959",r[1].style.border="1px solid #d9d9d9"),e.hasClass("se_txt_end")&&(r[0].style.border="1px solid #d9d9d9",r[1].style.border="1px solid #D55959"),e.val()==d&&e.val(""),e.removeClass("geo")},_blur:function(t){var e=this,r=$(t.target),o=r.attr("key"),n=e.model.get("geo"),a=n.word!=d&&i==d&&l,i=r.val().trim();if(a&&(r.val(""),s.open({text:"定位失败！"})),n.point&&""==i&&l){e.model.get(o).word==n.word&&(r.val(d),r.addClass("geo"));var u="start"==o?"start":"end";e["se"+u].val()!=d&&(e.model.set(o,e._getGeoData()),e.model.set(u,{word:""}))}},_fixDirData:function(){var t=$(".se-dir-form input[type=text]"),e=this._getPagetype();ptIsSelf=e.isSelf,me=this,$.each(t,function(){var t=$(this).attr("key"),r=$("#se_txt_"+t),o=me.model.get(t),s=o.word!=r.val();(!o.word||s)&&(r.val()===d&&l?me.model.set(t,me._getGeoData()):ptIsSelf||r.val()!=e.word?me.model.set(t,{word:r.val()}):me.model.set(t,{word:e.word,point:e.point}))})},_touchstart:function(t){var e=$(t.target);e.focus(),t.stopPropagation()},_getDirParam:function(t,e,r,s){var n,a=o.getCityCode()||1,i=this._getTabIndex("search",t),d=e.citycode||a,l=r.citycode||a,u=d||a;if(e.point&&r.point||!e.point&&!r.point)n={qt:["s","bt","nav","walk"][i]||"bt",sn:this._joinParam(e),en:this._joinParam(r),sc:d,ec:l,c:u,pn:"0",rn:"5"};else{var c,p,m,g;e.point?(c=e,g=r,p="sn",m="1"):(c=r,g=e,p="en",m="0");var v=["s","bse","nse","wse"][i]||"bse",_=c.point;n={qt:v,ptx:_.split(",")[0],pty:_.split(",")[1],wd:g.word||"",name:c.word||"",c:a,sc:e.citycode||a,ec:r.citycode||a,isSingle:"true"},n[v+"tp"]=m,n[p]=this._joinParam(c)}return s&&s.from&&(n.searchFlag=s.from||""),["nav","nse","walk","wse"].indexOf(n.qt)>=0&&(n.version="3"),["bse","bt"].indexOf(n.qt)>=0&&(n.version="5",n.exptype="dep"),n},_poiSubmit:function(t){t&&t.stopPropagation&&t.stopPropagation(),t&&t.preventDefault&&t.preventDefault();var e,r=t;r.target&&(e=$(t.target).attr("data-value"));var o=$(r.target);o.addClass("active"),e||(e=1);var s=this,n=s.sestart,d=s.seend;if(!s._checkInput(n)||!s._checkInput(d))return!1;this._fixDirData(),i.addCookieStat(STAT_CODE.STAT_TRANSIT_PLAN_CLICK);var l=s._getDirParam(e,this.model.get("start"),this.model.get("end"),t);a.update({module:"search",action:"search",query:l},{queryReplace:!0,trigger:!0})},_poiSubmitEnd:function(t){var e=t,r=$(e.target);r.removeClass("active")},_getTabIndex:function(t,e){if(!isNaN(e)){var r=this._num2str(t,e),o=this._str2num(t,r);return o}return"string"==typeof e?this._str2num(t,e):void 0},_getTabStr:function(t,e){if(!isNaN(e))return this._num2str(t,e);if(_.isString(e)){var r=this._str2num(t,e),o=this._num2str(t,r);return o}},_num2str:function(t,e){return"tab"==t?["place","line"][e]||"place":["place","transit","drive","walk"][e]||"place"},_str2num:function(t,e){return"tab"==t?{plcae:0,line:1}[e]||0:{place:0,transit:1,drive:2,walk:3}[e]||0},_joinParam:function(t){if(!t)return"";var e=t.point?"1":"2",r=t.uid||"",o=t.point||"",s=t.word||"";return[e,r,o,s,""].join("$$")}}});