define("common:widget/api/api.js",function(require,exports,module){!function(){function w(t,i){if(t=aC.g(t)){var n=this;aC.lang.Class.call(n),n.config={clickInterval:200,enableDragging:!0,enableDblclickZoom:!0,enableMouseDown:!0,enablePinchToZoom:!0,enableAutoResize:!0,fps:25,actionDuration:450,minZoom:1,maxZoom:18,mapType:new aG("地图",ax,{tips:"显示普通地图",mapInstance:this}),enableInertialDragging:!1,drawMargin:100,enableHighResolution:!1,devicePixelRatio:window.devicePixelRatio||2,vectorMapLevel:12,beautifyBlackList:["chrome"],trafficStatus:!1},aC.extend(n.config,i||{});for(var o=n.config.beautifyBlackList,a=0,s=o.length;s>a;a++)if(aC.browser[o[a]]){n.config.devicePixelRatio=1;break}n.container=t,n._setStyle(t),t.unselectable="on",t.innerHTML="",t.appendChild(n.render());var r=n.getSize();n.width=r.width,n.height=r.height,n.offsetX=0,n.offsetY=0,n.platform=t.firstChild,n.maskLayer=n.platform.firstChild,n.maskLayer.style.width=n.width+"px",n.maskLayer.style.height=n.height+"px",n._panes={},n.centerPoint=new e(0,0),n.mercatorCenter=new e(0,0),n.zoomLevel=1,n.lastLevel=0,n.defaultZoomLevel=null,n.defaultCenter=null,n._hotspots={},n.currentOperation=0,i=i||{};var l=n.mapType=n.config.mapType;n.projection=l.getProjection();var h=n.config;h.userMinZoom=i.minZoom,h.userMaxZoom=i.maxZoom,n._checkZoom(),n.temp={operating:!1,arrow:0,lastDomMoveTime:0,lastLoadTileTime:0,lastMovingTime:0,canKeyboard:!1,registerIndex:-1,curSpots:[]};for(var a=0;a<BMap._register.length;a++)BMap._register[a](n);n.temp.registerIndex=a,n._bind(),am.load("map",function(){n._draw()}),am.load("opmb",function(){n._asyncRegister()}),t=null,n.enableLoadTiles=!0,n._viewTiles=[]}}function aD(t){var e={duration:1e3,fps:30,delay:0,transition:f.linear,onStop:function(){}};if(this._anis=[],t)for(var i in t)e[i]=t[i];if(this._opts=e,I(e.delay)){var n=this;setTimeout(function(){n.start()},e.delay)}else e.delay!=aD.INFINITE&&this.start()}function aL(t,e){var i=t.style;i.left=e[0]+"px",i.top=e[1]+"px"}function l(t){t.style.MozUserSelect="none"}function n(t){return t&&t.parentNode&&11!=t.parentNode.nodeType}function V(t,e){return aC.dom.insertHTML(t,"beforeEnd",e),t.lastChild}function t(t){for(var e={left:0,top:0};t&&t.offsetParent;)e.left+=t.offsetLeft,e.top+=t.offsetTop,t=t.offsetParent;return e}function ac(t){var t=window.event||t;t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}function x(t){var t=window.event||t;return t.preventDefault?t.preventDefault():t.returnValue=!1,!1}function av(t){return ac(t),x(t)}function H(){var t=document.documentElement,e=document.body;return t&&(t.scrollTop||t.scrollLeft)?[t.scrollTop,t.scrollLeft]:e?[e.scrollTop,e.scrollLeft]:[0,0]}function p(t,e){return t&&e?Math.round(Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))):void 0}function o(t,e,i){var n=document.createElement(t);return i&&(n=document.createElementNS(i,t)),aC.dom.setAttrs(n,e||{})}function ak(t){return t.currentStyle?t.currentStyle:t.ownerDocument&&t.ownerDocument.defaultView?t.ownerDocument.defaultView.getComputedStyle(t,null):void 0}function aq(t){return"function"==typeof t}function I(t){return"number"==typeof t}function aB(t){return"string"==typeof t}function ad(t){return"undefined"!=typeof t}function B(t){return"object"==typeof t}function c(t){return"[object Array]"==Object.prototype.toString.call(t)}function h(){return"boolean"!=typeof h.result&&(h.result=!!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Shape","1.1")),h.result}function al(t){return t*Math.PI/180}function ao(){return!!(aC.platform.isIphone||aC.platform.isIpad||aC.platform.isAndroid)}function v(){return(new Date).getTime()}function Z(t,e){return t.data("events")&&t.data("events")[e]?!0:!1}function am(){}function aH(t,e){this.x=t||0,this.y=e||0}function U(t,e){this.width=t||0,this.height=e||0}function J(t,e){t&&(this._position=t,this.guid="spot"+J.guid++,e=e||{},this._text=e.text||"",this._offsets=e.offsets?e.offsets.slice(0):[5,5,5,5],this._userData=e.userData||null,this._minZoom=e.minZoom||null,this._maxZoom=e.maxZoom||null)}function M(){this._map=null,this._container,this._type="control",this._visible=!0}function O(t){M.call(this),t=t||{},this._opts={printable:!1},this._opts=aC.object.extend(aC.object.extend(this._opts,{color:"black",unit:"metric"}),t),this.defaultAnchor=BMAP_ANCHOR_BOTTOM_LEFT,this.defaultOffset=new U(81,18),this.setAnchor(t.anchor),this._units={metric:{name:"metric",conv:1,incon:1e3,u1:"米",u2:"公里"}},this._units[this._opts.unit]||(this._opts.unit="metric"),this._scaleText=null,this._numberArray={},this._asyncLoadCode()}function r(t,i){t&&!i&&(i=t),this._sw=this._ne=null,this._swLng=this._swLat=null,this._neLng=this._neLat=null,t&&(this._sw=new e(t.lng,t.lat),this._ne=new e(i.lng,i.lat),this._swLng=t.lng,this._swLat=t.lat,this._neLng=i.lng,this._neLat=i.lat)}function e(t,e){this.lng=parseFloat(t),this.lat=parseFloat(e)}function au(t){this._mapType=t}function L(){this._type="overlay"}function az(){aC.lang.Class.call(this),L.call(this),this.map=null,this._visible=!0,this._dblclickTime=0}function an(){this.map=null,this._overlays={},this._customOverlays=[]}function ap(t){az.call(this),this._config={strokeColor:"#3a6bdb",strokeWeight:5,strokeOpacity:.65,strokeStyle:"solid",enableMassClear:!0,getParseTolerance:null,getParseCacheIndex:null,enableParse:!0,clickable:!0},t=t||{},this.setConfig(t),this._config.strokeWeight<=0&&(this._config.strokeWeight=5),(this._config.strokeOpacity<0||this._config.strokeOpacity>1)&&(this._config.strokeOpacity=.65),"solid"!=this._config.strokeStyle&&"dashed"!=this._config.strokeStyle&&(this._config.strokeStyle="solid"),ad(t.enableClicking)&&(this._config.clickable=t.enableClicking),this.domElement=null,this._bounds=new BMap.Bounds(0,0,0,0),this._parseCache=[],this._temp={}}function q(t,e,i){if(t&&e){this.imageUrl=t,this.size=e;var n=new U(Math.floor(e.width/2),Math.floor(e.height/2)),o={anchor:n,imageOffset:new U(0,0)};i=i||{},aC.extend(o,i),this.anchor=o.anchor,this.imageOffset=o.imageOffset,this.printImageUrl=i.printImageUrl||""}}function C(t,e){az.call(this),e=e||{},this.point=t,this.map=null,this._config={offset:new U(0,0),icon:aA,shadow:F,title:"",baseZIndex:0,clickable:!0,zIndexFixed:!1,isTop:!1,enableMassClear:!0},this.setConfig(e),e.icon&&!e.shadow&&(this._config.shadow=null),ad(e.enableClicking)&&(this._config.clickable=e.enableClicking);var i=this;am.load("marker",function(){i._draw()})}function ag(t,e){ap.call(this,e),this.setPath(t);var i=this;am.load("poly",function(){i._draw()})}function ay(t){this.map=t,this.mapTypeLayers=[],this.tileLayers=[],this.bufferNumber=300,this.realBufferNumber=0,this.mapTiles={},this.bufferTiles={},this.numLoading=0,this.isFirstTile=!0,this._mapTypeLayerContainer=this._createDiv(1),this._vectorLayerContainer=this._createDiv(2),this._normalLayerContainer=this._createDiv(3),t.platform.appendChild(this._mapTypeLayerContainer),t.platform.appendChild(this._vectorLayerContainer),t.platform.appendChild(this._normalLayerContainer)}function at(t,e,i,a,s){this.mgr=t,this.position=i,this._cbks=[],this.name=t.getTileName(a,s),this.info=a,this.level=parseInt(a[2],10);var r=o("img");l(r),r.galleryImg=!1;var h=r.style,c=t.map.getMapType(),u=c.getTileSize();h.position="absolute",h.width=u+"px",h.height=u+"px",h.left=i[0]+"px",h.top=i[1]+"px",this.img=r,this.src=e;var d=this;this.img.onload=function(){if(d.loaded=!0,d.mgr){var e=d.mgr,i=e.bufferTiles;i[d.name]||(e.realBufferNumber++,i[d.name]=d),d.img&&!n(d.img)&&s.tilesDiv&&s.tilesDiv.appendChild(d.img);var o=e.realBufferNumber-e.bufferNumber;for(var a in i){if(0>=o)break;if(!e.mapTiles[a]){i[a].mgr=null;var r=i[a].img;r&&r.parentNode&&r.parentNode.removeChild(r),r=null,i[a].img=null,delete i[a],e.realBufferNumber--,o--}}d._callCbks(),this.src.indexOf("TrafficTileService")>-1&&(t._statRTCount++,t._statRTCount==t._statRTTotalCount&&t.map.dispatchEvent(new ar("onTrafficloaded")))}},this.isHighResolution=t.map.highResolutionEnabled(),this.img.onerror=function(){var t=d.img,i=t?t.getAttribute("errorCount"):!0;if(t&&(!i||i&&5>i))i=i||0,i++,t.src=e,BMap.logCountError.countPic(d.isHighResolution,!1,i,d.level),t.setAttribute("errorCount",i),BMap.logCountError.countPic(d.isHighResolution,!0,i,d.level);else{if(d._callCbks(),!d.mgr)return;var o=d.mgr,a=o.map.getMapType();a.getErrorImageUrl()&&(d.error=!0,d.img.src=a.getErrorImageUrl(),d.img&&!n(d.img)&&s.tilesDiv.appendChild(d.img)),BMap.logCountError.countPic(d.isHighResolution,!0,6,d.level)}},r=null}function z(t){this.opts=t||{},this.baseLayer=this.opts.baseLayer||!1,this.zIndex=this.opts.zIndex||0,this.guid=z._guid++}function af(t){z.call(this,t),this._opts={},t=t||{},this._opts=aC.object.extend(this._opts,t),this._opts.predictDate&&((this._opts.predictDate.weekday<1||this._opts.predictDate.weekday>7)&&(this._opts.predictDate=1),(this._opts.predictDate.hour<0||this._opts.predictDate.hour>23)&&(this._opts.predictDate.hour=0)),this._tileUrl="http://its.map.baidu.com:8002/traffic/"}function E(t,e){var i={zIndex:2};z.call(this,i),this._keyWord=t,this._cityCode=e,this._isVectorLayer=!0,this._map=null,this._container=null;var n=this;am.load("layer",function(){n._asyncLoadCode()})}function aG(t,e,i){this._name=t,this._layers=e instanceof z?[e]:e.slice(0),this._opts={tips:"",labelText:"",minZoom:1,maxZoom:18,tileSize:256,textColor:"black",errorImageUrl:"",projection:new au(this)},1==this._layers.length&&(this._layers[0].baseLayer=!0),aC.extend(this._opts,i||{})}function y(t,e){this._container="string"==typeof t?aC.g(t):t,this._opts={linksControl:!0,enableDoubleClickZoom:!0},e=e||{};for(var i in e)this._opts[i]=e[i];this._pov={heading:0,pitch:0},this._links=[],this._id=null,this._position=null,this._zoom=2,this._description="",this._mode="";var n=this;am.load("streetview",function(){n._draw()}),this._init()}function j(){z.call(this)}function D(t,e){window.BMap[t]=e}var W,aC=W=aC||{version:"1.3.4"};aC.guid="$BAIDU$",window[aC.guid]=window[aC.guid]||{},aC.object=aC.object||{},aC.extend=aC.object.extend=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},aC.dom=aC.dom||{},aC.dom.g=function(t){return"string"==typeof t||t instanceof String?document.getElementById(t):t&&t.nodeName&&(1==t.nodeType||9==t.nodeType)?t:null},aC.g=aC.G=aC.dom.g,aC.dom.hide=function(t){return t=aC.dom.g(t),t.style.display="none",t},aC.hide=aC.dom.hide,aC.lang=aC.lang||{},aC.lang.isString=function(t){return"[object String]"==Object.prototype.toString.call(t)},aC.isString=aC.lang.isString,aC.dom._g=function(t){return aC.lang.isString(t)?document.getElementById(t):t},aC._g=aC.dom._g,aC.dom.contains=function(t,e){var i=aC.dom._g;return t=i(t),e=i(e),t.contains?t!=e&&t.contains(e):!!(16&t.compareDocumentPosition(e))},aC.browser=aC.browser||{},aC.dom._NAME_ATTRS=function(){var t={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",usemap:"useMap",frameborder:"frameBorder"};return t.htmlFor="for",t.className="class",t}(),aC.dom.setAttr=function(t,e,i){return t=aC.dom.g(t),"style"==e?t.style.cssText=i:(e=aC.dom._NAME_ATTRS[e]||e,t.setAttribute(e,i)),t},aC.setAttr=aC.dom.setAttr,aC.dom.setAttrs=function(t,e){t=aC.dom.g(t);for(var i in e)aC.dom.setAttr(t,i,e[i]);return t},aC.setAttrs=aC.dom.setAttrs,aC.string=aC.string||{},aC.dom.removeClass=function(t,e){t=aC.dom.g(t);for(var i,n,o=t.className.split(/\s+/),a=e.split(/\s+/),s=a.length,r=0;s>r;++r)for(n=0,i=o.length;i>n;++n)if(o[n]==a[r]){o.splice(n,1);break}return t.className=o.join(" "),t},aC.removeClass=aC.dom.removeClass,aC.dom.insertHTML=function(t,e,i){t=aC.dom.g(t);var n,o;return t.insertAdjacentHTML?t.insertAdjacentHTML(e,i):(n=t.ownerDocument.createRange(),e=e.toUpperCase(),"AFTERBEGIN"==e||"BEFOREEND"==e?(n.selectNodeContents(t),n.collapse("AFTERBEGIN"==e)):(o="BEFOREBEGIN"==e,n[o?"setStartBefore":"setEndAfter"](t),n.collapse(o)),n.insertNode(n.createContextualFragment(i))),t},aC.insertHTML=aC.dom.insertHTML,aC.dom.show=function(t){return t=aC.dom.g(t),t.style.display="",t},aC.show=aC.dom.show,aC.dom.getDocument=function(t){return t=aC.dom.g(t),9==t.nodeType?t:t.ownerDocument||t.document},aC.dom.addClass=function(t,e){t=aC.dom.g(t);for(var i=e.split(/\s+/),n=t.className,o=" "+n+" ",a=0,s=i.length;s>a;a++)o.indexOf(" "+i[a]+" ")<0&&(n+=" "+i[a]);return t.className=n,t},aC.addClass=aC.dom.addClass,aC.dom._styleFixer=aC.dom._styleFixer||{},aC.dom._styleFilter=aC.dom._styleFilter||[],aC.dom._styleFilter.filter=function(t,e,i){for(var n,o=0,a=aC.dom._styleFilter;n=a[o];o++)(n=n[i])&&(e=n(t,e));return e},aC.string.toCamelCase=function(t){return t.indexOf("-")<0&&t.indexOf("_")<0?t:t.replace(/[-_][^-_]/g,function(t){return t.charAt(1).toUpperCase()})},aC.dom.getStyle=function(t,e){var i=aC.dom;t=i.g(t),e=aC.string.toCamelCase(e);var n=t.style[e];if(!n){var o=i._styleFixer[e],a=t.currentStyle||getComputedStyle(t,null);n=o&&o.get?o.get(t,a):a[o||e]}return(o=i._styleFilter)&&(n=o.filter(e,n,"get")),n},aC.getStyle=aC.dom.getStyle,/opera\/(\d+\.\d)/i.test(navigator.userAgent)&&(aC.browser.opera=+RegExp.$1),aC.browser.isWebkit=/webkit/i.test(navigator.userAgent),aC.browser.isGecko=/gecko/i.test(navigator.userAgent)&&!/like gecko/i.test(navigator.userAgent),aC.browser.isStrict="CSS1Compat"==document.compatMode,aC.dom.getPosition=function(t){t=aC.dom.g(t);var e,i,n=aC.dom.getDocument(t),o=aC.browser,a=aC.dom.getStyle,s=(o.isGecko>0&&n.getBoxObjectFor&&"absolute"==a(t,"position")&&(""===t.style.top||""===t.style.left),{left:0,top:0}),r=o.ie&&!o.isStrict?n.body:n.documentElement;if(t==r)return s;if(t.getBoundingClientRect){i=t.getBoundingClientRect(),s.left=Math.floor(i.left)+Math.max(n.documentElement.scrollLeft,n.body.scrollLeft),s.top=Math.floor(i.top)+Math.max(n.documentElement.scrollTop,n.body.scrollTop),s.left-=n.documentElement.clientLeft,s.top-=n.documentElement.clientTop;var l=n.body,h=parseInt(a(l,"borderLeftWidth")),c=parseInt(a(l,"borderTopWidth"));o.ie&&!o.isStrict&&(s.left-=isNaN(h)?2:h,s.top-=isNaN(c)?2:c)}else{e=t;do{if(s.left+=e.offsetLeft,s.top+=e.offsetTop,o.isWebkit>0&&"fixed"==a(e,"position")){s.left+=n.body.scrollLeft,s.top+=n.body.scrollTop;break}e=e.offsetParent}while(e&&e!=t);for((o.opera>0||o.isWebkit>0&&"absolute"==a(t,"position"))&&(s.top-=n.body.offsetTop),e=t.offsetParent;e&&e!=n.body;)s.left-=e.scrollLeft,o.opera&&"TR"==e.tagName||(s.top-=e.scrollTop),e=e.offsetParent}return s},/firefox\/(\d+\.\d)/i.test(navigator.userAgent)&&(aC.browser.firefox=+RegExp.$1),function(){var t=navigator.userAgent;/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(t)&&!/chrome/i.test(t)&&(aC.browser.safari=+(RegExp.$1||RegExp.$2))}(),/chrome\/(\d+\.\d)/i.test(navigator.userAgent)&&(aC.browser.chrome=+RegExp.$1),aC.array=aC.array||{},aC.array.each=function(t,e){var i,n,o,a=t.length;if("function"==typeof e)for(o=0;a>o&&(n=t[o],i=e.call(t,n,o),i!==!1);o++);return t},aC.each=aC.array.each,aC.lang.guid=function(){return"TANGRAM__"+(window[aC.guid]._counter++).toString(36)},window[aC.guid]._counter=window[aC.guid]._counter||1,window[aC.guid]._instances=window[aC.guid]._instances||{},aC.lang.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},aC.lang.Class=function(t){this.guid=t||aC.lang.guid(),window[aC.guid]._instances[this.guid]=this},window[aC.guid]._instances=window[aC.guid]._instances||{},aC.lang.Class.prototype.dispose=function(){delete window[aC.guid]._instances[this.guid];for(var t in this)aC.lang.isFunction(this[t])||delete this[t];this.disposed=!0},aC.lang.Class.prototype.toString=function(){return"[object "+(this._className||"Object")+"]"},aC.lang.Event=function(t,e){this.type=t,this.returnValue=!0,this.target=e||null,this.currentTarget=null},aC.lang.Class.prototype.addEventListener=function(t,e,i){if(aC.lang.isFunction(e)){!this.__listeners&&(this.__listeners={});var n,o=this.__listeners;if("string"==typeof i&&i){if(/[^\w\-]/.test(i))throw"nonstandard key:"+i;e.hashCode=i,n=i}0!=t.indexOf("on")&&(t="on"+t),"object"!=typeof o[t]&&(o[t]={}),n=n||aC.lang.guid(),e.hashCode=n,o[t][n]=e}},aC.lang.Class.prototype.removeEventListener=function(t,e){if(aC.lang.isFunction(e))e=e.hashCode;else if(!aC.lang.isString(e))return;!this.__listeners&&(this.__listeners={}),0!=t.indexOf("on")&&(t="on"+t);var i=this.__listeners;i[t]&&i[t][e]&&delete i[t][e]},aC.lang.Class.prototype.dispatchEvent=function(t,e){aC.lang.isString(t)&&(t=new aC.lang.Event(t)),!this.__listeners&&(this.__listeners={}),e=e||{};for(var i in e)t[i]=e[i];var i,n=this.__listeners,o=t.type;if(t.target=t.target||this,t.currentTarget=this,0!=o.indexOf("on")&&(o="on"+o),aC.lang.isFunction(this[o])&&this[o].apply(this,arguments),"object"==typeof n[o])for(i in n[o])n[o][i].apply(this,arguments);return t.returnValue},aC.lang.inherits=function(t,e,i){var n,o,a=t.prototype,s=new Function;s.prototype=e.prototype,o=t.prototype=new s;for(n in a)o[n]=a[n];t.prototype.constructor=t,t.superClass=e.prototype,"string"==typeof i&&(o._className=i)},aC.inherits=aC.lang.inherits,aC.lang.instance=function(t){return window[aC.guid]._instances[t]||null},aC.platform=aC.platform||{},aC.platform.isAndroid=/android/i.test(navigator.userAgent),/android (\d+\.\d)/i.test(navigator.userAgent)&&(aC.platform.android=aC.android=RegExp.$1),aC.platform.isIpad=/ipad/i.test(navigator.userAgent),aC.platform.isIphone=/iphone/i.test(navigator.userAgent),aC.platform.iosVersion=/iphone os (\d)\_/i.test(navigator.userAgent)?+RegExp.$1:0,aC.lang.Event.prototype.inherit=function(t){var e=this;if(this.domEvent=t=window.event||t,e.clientX=t.clientX||t.pageX,e.clientY=t.clientY||t.pageY,e.offsetX=t.offsetX||t.layerX,e.offsetY=t.offsetY||t.layerY,e.screenX=t.screenX,e.screenY=t.screenY,e.ctrlKey=t.ctrlKey||t.metaKey,e.shiftKey=t.shiftKey,e.altKey=t.altKey,t.touches){e.touches=[];for(var i=0;i<t.touches.length;i++)e.touches.push({clientX:t.touches[i].clientX,clientY:t.touches[i].clientY,screenX:t.touches[i].screenX,screenY:t.touches[i].screenY,pageX:t.touches[i].pageX,pageY:t.touches[i].pageY,target:t.touches[i].target,identifier:t.touches[i].identifier})}if(t.changedTouches){e.changedTouches=[];for(var i=0;i<t.changedTouches.length;i++)e.changedTouches.push({clientX:t.changedTouches[i].clientX,clientY:t.changedTouches[i].clientY,screenX:t.changedTouches[i].screenX,screenY:t.changedTouches[i].screenY,pageX:t.changedTouches[i].pageX,pageY:t.changedTouches[i].pageY,target:t.changedTouches[i].target,identifier:t.changedTouches[i].identifier})}if(t.targetTouches){e.targetTouches=[];for(var i=0;i<t.targetTouches.length;i++)e.targetTouches.push({clientX:t.targetTouches[i].clientX,clientY:t.targetTouches[i].clientY,screenX:t.targetTouches[i].screenX,screenY:t.targetTouches[i].screenY,pageX:t.targetTouches[i].pageX,pageY:t.targetTouches[i].pageY,target:t.targetTouches[i].target,identifier:t.targetTouches[i].identifier})}return e.rotation=t.rotation,e.scale=t.scale,e},aC.lang.decontrol=function(t){var e=window[aC.guid];e._instances&&delete e._instances[t]},aC.event={},aC.on=aC.event.on=function(t,e,i){return(t=aC.g(t))?(e=e.replace(/^on/,""),t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent&&t.attachEvent("on"+e,i),t):t},aC.un=aC.event.un=function(t,e,i){return(t=aC.g(t))?(e=e.replace(/^on/,""),t.removeEventListener?t.removeEventListener(e,i,!1):t.detachEvent&&t.detachEvent("on"+e,i),t):t},aC.dom.hasClass=function(t,e){if(!t||!t.className||"string"!=typeof t.className)return!1;var i=-1;try{i=t.className==e||t.className.indexOf(e)}catch(n){return!1}return i>-1},window.BMap=window.BMap||{},window.BMap._register=[],window.BMap.register=function(t){this._register.push(t)},BMap._streetViewRegister=[],BMap.streetViewRegister=function(t){this._streetViewRegister.push(t)},aC.lang.inherits(w,aC.lang.Class,"Map"),aC.extend(w.prototype,{render:function(){var t=o("div"),e=t.style;e.overflow="visible",e.position="absolute",e.zIndex="0",e.top=e.left="0px";var i=o("div",{"class":"BMap_mask"}),n=i.style;return n.position="absolute",n.top=n.left="0px",n.zIndex="9",n.overflow="hidden",n.WebkitUserSelect="none",t.appendChild(i),t},_setStyle:function(t){var e=t.style;e.overflow="hidden","absolute"!=ak(t).position&&(e.position="relative",e.zIndex=0),e.backgroundColor="#F5F3F0",e.color="#000",e.textAlign="left"},_bind:function(){var t=this;t._watchSize=function(){var e=t.getSize();if(t.width!=e.width||t.height!=e.height){var i=new U(t.width,t.height),n=new ar("onbeforeresize");n.size=i,t.dispatchEvent(n),t._updateCenterPoint((e.width-t.width)/2,(e.height-t.height)/2),t.maskLayer.style.width=(t.width=e.width)+"px",t.maskLayer.style.height=(t.height=e.height)+"px";var o=new ar("onresize");o.size=e,t.dispatchEvent(o)}},t.config.enableAutoResize&&(t.temp.autoResizeTimer=setInterval(t._watchSize,80))},_updateCenterPoint:function(t,i,n,o){var a=this.getMapType().getZoomUnits(this.getZoom()),s=!0;n&&(this.centerPoint=new e(n.lng,n.lat),s=!1);var r=n&&o?n:this.mercatorCenter;r&&(this.mercatorCenter=new e(r.lng+t*a,r.lat-i*a),this.mercatorCenter&&s&&(this.centerPoint=this.mercatorCenter))},zoomTo:function(t,e){if(I(t)&&(t=this._getProperZoom(t).zoom,t!=this.zoomLevel)){this.lastLevel=this.zoomLevel,this.zoomLevel=t;var i;if(e&&(i=e),i){var n=this.pointToPixel(i,this.lastLevel);this._updateCenterPoint(this.width/2-n.x,this.height/2-n.y,this.pixelToPoint(n,this.lastLevel),!0)}this.dispatchEvent(new ar("onzoomstart")),this.dispatchEvent(new ar("onzoomstartcode"))}},setZoom:function(t){this.zoomTo(t)},zoomIn:function(t){this.zoomLevel>=this.config.vectorMapLevel&&this.zoomLevel<=18&&BMap.logCountError.countTouch(0,1),this.zoomTo(this.zoomLevel+1,t)},zoomOut:function(t){this.zoomLevel>=this.config.vectorMapLevel&&this.zoomLevel<=18&&BMap.logCountError.countTouch(0,1),this.zoomTo(this.zoomLevel-1,t)},panTo:function(t){t instanceof e&&(this.mercatorCenter=t,this.centerPoint=t?new e(t.lng,t.lat):this.mercatorCenter)},panBy:function(t,e){t=Math.round(t)||0,e=Math.round(e)||0,this._updateCenterPoint(-t,-e)},addControl:function(t){t&&aq(t._i)&&(t._i(this),this.dispatchEvent(new ar("onaddcontrol",t)))},removeControl:function(t){t&&aq(t.remove)&&(t.remove(),this.dispatchEvent(new ar("onremovecontrol",t)))},addOverlay:function(t){t&&aq(t._i)&&(t._i(this),this.dispatchEvent(new ar("onaddoverlay",t)))},removeOverlay:function(t){t&&aq(t.remove)&&(t.remove(),this.dispatchEvent(new ar("onremoveoverlay",t)))},clearOverlays:function(){this.dispatchEvent(new ar("onclearoverlays"))},addTileLayer:function(t){t&&this.dispatchEvent(new ar("onaddtilelayer",t))},removeTileLayer:function(t){t&&this.dispatchEvent(new ar("onremovetilelayer",t))},setCenter:function(t){var i=this;t instanceof e&&i.panTo(t,{noAnimation:!0})},centerAndZoom:function(t,i,n){var o=this;if(t instanceof e&&i){i=o._getProperZoom(i).zoom,o.lastLevel=o.zoomLevel||i,o.zoomLevel=i,o.centerPoint=new e(t.lng,t.lat),o.mercatorCenter=o.centerPoint,o.defaultZoomLevel=o.defaultZoomLevel||o.zoomLevel,o.defaultCenter=o.defaultCenter||o.centerPoint;var a=new ar("onload"),s=new ar("onloadcode");a.point=new e(t.lng,t.lat),a.pixel=o.pointToPixel(o.centerPoint,o.zoomLevel),a.zoom=i,o.loaded||(o.loaded=!0,o.dispatchEvent(a)),o.dispatchEvent(s),n?o.dispatchEvent(new ar("onmoveend")):(o.dispatchEvent(new ar("onmoveend")),o.lastLevel!=o.zoomLevel&&o.dispatchEvent(new ar("onzoomend")))}},reset:function(){this.centerAndZoom(this.defaultCenter,this.defaultZoomLevel,!0)},enableDragging:function(){this.config.enableDragging=!0},disableDragging:function(){this.config.enableDragging=!1},enableInertialDragging:function(){this.config.enableInertialDragging=!0},disableInertialDragging:function(){this.config.enableInertialDragging=!1},enableDoubleClickZoom:function(){this.config.enableDblclickZoom=!0},disableDoubleClickZoom:function(){this.config.enableDblclickZoom=!1},enablePinchToZoom:function(){this.config.enablePinchToZoom=!0},disablePinchToZoom:function(){this.config.enablePinchToZoom=!1},enableAutoResize:function(){this.config.enableAutoResize=!0,this._watchSize(),this.temp.autoResizeTimer||(this.temp.autoResizeTimer=setInterval(this._watchSize,80))},disableAutoResize:function(){this.config.enableAutoResize=!1,this.temp.autoResizeTimer&&(clearInterval(this.temp.autoResizeTimer),this.temp.autoResizeTimer=null)},getSize:function(){return new U(this.container.clientWidth,this.container.clientHeight)},getCenter:function(){return this.centerPoint},getZoom:function(){return this.zoomLevel},checkResize:function(){this._watchSize()},_getProperZoom:function(t){var e=this.config.minZoom,i=this.config.maxZoom,n=!1;return e>t&&(n=!0,t=e),t>i&&(n=!0,t=i),{zoom:t,exceeded:n}},getContainer:function(){return this.container},pointToPixel:function(t,e){return e=e||this.getZoom(),this.projection.pointToPixel(t,e,this.mercatorCenter,this.getSize())},pixelToPoint:function(t,e){return e=e||this.getZoom(),this.projection.pixelToPoint(t,e,this.mercatorCenter,this.getSize())},pointToOverlayPixel:function(t,i){if(t){var n=new e(t.lng,t.lat),o=this.pointToPixel(n,i);return o.x-=this.offsetX,o.y-=this.offsetY,o}},overlayPixelToPoint:function(t,e){if(t){var i=new aH(t.x,t.y);return i.x+=this.offsetX,i.y+=this.offsetY,this.pixelToPoint(i,e)}},getBounds:function(){if(!this.isLoaded())return new r;var t=this.getSize();this.width=t.width,this.height=t.height;var e=arguments[0]||{},i=e.margins||[0,0,0,0],n=e.zoom||null,o=this.pixelToPoint({x:i[3],y:this.height-i[2]},n),a=this.pixelToPoint({x:this.width-i[1],y:i[0]},n);return new r(o,a)},isLoaded:function(){return!!this.loaded},_getBestLevel:function(t,e){for(var i=this.getMapType(),n=e.margins||[10,10,10,10],o=e.zoomFactor||0,a=n[1]+n[3],s=n[0]+n[2],r=i.getMinZoom(),l=i.getMaxZoom(),h=l;h>=r;h--){var c=this.getMapType().getZoomUnits(h);if(t.toSpan().lng/c<this.width-a&&t.toSpan().lat/c<this.height-s)break}return h+=o,r>h&&(h=r),h>l&&(h=l),h},getViewport:function(t,e){var i={center:this.getCenter(),zoom:this.getZoom()};if(!t||!t instanceof r&&0==t.length||t instanceof r&&t.isEmpty())return i;var n=[];t instanceof r?(n.push(t.getNorthEast()),n.push(t.getSouthWest())):n=t.slice(0),e=e||{};for(var o=[],a=0,s=n.length;s>a;a++)o.push(n[a]);for(var l=new r,a=o.length-1;a>=0;a--)l.extend(o[a]);if(l.isEmpty())return i;var h=l.getCenter(),c=this._getBestLevel(l,e);if(e.margins){var u=e.margins,d=(u[1]-u[3])/2,f=(u[0]-u[2])/2,p=this.getMapType().getZoomUnits(c);h.lng=h.lng+p*d,h.lat=h.lat+p*f}return{center:h,zoom:c}},setViewport:function(t,e){var i;i=t&&t.center?t:this.getViewport(t,e),e=e||{};var n=e.delay||200;if(i.zoom==this.zoomLevel&&0!=e.enableAnimation){var o=this;setTimeout(function(){o.panTo(i.center,{duration:210})},n)}else this.centerAndZoom(i.center,i.zoom)},getPanes:function(){return this._panes},getOverlays:function(){var t=[],e=this._overlays,i=this._customOverlays;if(e)for(var n in e)e[n]instanceof az&&t.push(e[n]);if(i)for(var n=0,o=i.length;o>n;n++)t.push(i[n]);return t},getMapType:function(){return this.mapType},_asyncRegister:function(){for(var t=this.temp.registerIndex;t<BMap._register.length;t++)BMap._register[t](this);this.temp.registerIndex=t},highResolutionEnabled:function(){return this.config.enableHighResolution&&window.devicePixelRatio>1},enableHighResolution:function(){this.config.enableHighResolution=!0},disableHighResolution:function(){this.config.enableHighResolution=!1},addHotspot:function(t){t instanceof J&&(this._hotspots[t.guid]=t,t.initialize(this));var e=this;am.load("hotspot",function(){e._asyncRegister()})},removeHotspot:function(t){this._hotspots[t.guid]&&delete this._hotspots[t.guid]},clearHotspots:function(){this._hotspots={}},_checkZoom:function(){var t=this.mapType.getMinZoom(),e=this.mapType.getMaxZoom(),i=this.config;i.minZoom=i.userMinZoom||t,i.maxZoom=i.userMaxZoom||e,i.minZoom<t&&(i.minZoom=t),i.maxZoom>e&&(i.maxZoom=e)},setMinZoom:function(t){t>this.config.maxZoom&&(t=this.config.maxZoom),this.config.userMinZoom=t,this._updateZoom()},setMaxZoom:function(t){t<this.config.minZoom&&(t=this.config.minZoom),this.config.userMaxZoom=t,this._updateZoom()},_updateZoom:function(){this._checkZoom();var t=this.config;this.zoomLevel<t.minZoom?this.setZoom(t.minZoom):this.zoomLevel>t.maxZoom&&this.setZoom(t.maxZoom);var e=new ar("onzoomspanchange");e.minZoom=t.minZoom,e.maxZoom=t.maxZoom,this.dispatchEvent(e)},getViewTiles:function(){return this._viewTiles},vectorMapEnabled:function(){return 99!=this.config.vectorMapLevel},setTrafficOn:function(){this.config.trafficStatus=!0;var t=new ar("ontrafficchange");this.dispatchEvent(t)},setTrafficOff:function(){this.config.trafficStatus=!1;var t=new ar("ontrafficchange");this.dispatchEvent(t)}}),window.BMAP_CANVAS_DRAWER=3,function(){window.asyncMdlVer={control:"otzzoh",hotspot:"fzmizk",map:"0g5gtk",marker:"3kozvf",opmb:"mrzahz",poly:"1aehwb",tile:"uhunrl",vector:"besg3a",streetview:"30xam4",layer:"3bn2hs"},window.chkVersion=function(t){try{var e=window.localStorage;return e?e[t]&&e[t].length>0:!1}catch(i){return!1}},window.saveVersion=function(t,e,i){try{var n=window.localStorage;if(n){for(var o=n.length,a=o-1;a>=0;a--){var s=n.key(a);s.indexOf(i)>-1&&n.removeItem(s)}n.setItem(t,e)}}catch(r){}},window.getVersion=function(t){try{var e=window.localStorage;return e?e.getItem(t):""}catch(i){return""}}}(),aD.INFINITE="INFINITE",aD.prototype.start=function(){this._beginTime=v(),this._endTime=this._beginTime+this._opts.duration,this._launch()},aD.prototype.add=function(t){this._anis.push(t)},aD.prototype._launch=function(){var t=this,e=v();if(e>=t._endTime){if(aq(t._opts.render)&&t._opts.render(t._opts.transition(1)),aq(t._opts.finish)&&t._opts.finish(),t._anis.length>0){var i=t._anis[0];i._anis=[].concat(t._anis.slice(1)),i.start()}}else t.schedule=t._opts.transition((e-t._beginTime)/t._opts.duration),aq(t._opts.render)&&t._opts.render(t.schedule),t.terminative||(t._timer=setTimeout(function(){t._launch()},1e3/t._opts.fps))},aD.prototype.stop=function(t){this.terminative=!0;for(var e=0;e<this._anis.length;e++)this._anis[e].stop(),this._anis[e]=null;this._anis.length=0,this._timer&&(clearTimeout(this._timer),this._timer=null),this._opts.onStop(this.schedule),t&&(this._endTime=this._beginTime,this._launch())},aD.prototype.cancel=function(){this._timer&&clearTimeout(this._timer),this._endTime=this._beginTime,this.schedule=0},aD.prototype.setFinishCallback=function(t){this._anis.length>0?this._anis[this._anis.length-1]._opts.finish=t:this._opts.finish=t};var f={linear:function(t){return t},reverse:function(t){return 1-t},easeInQuad:function(t){return t*t},easeInCubic:function(t){return Math.pow(t,3)},easeOutQuad:function(t){return-(t*(t-2))},easeOutCubic:function(t){return Math.pow(t-1,3)+1},easeInOutQuad:function(t){return.5>t?2*t*t:-2*(t-2)*t-1},easeInOutCubic:function(t){return.5>t?4*Math.pow(t,3):4*Math.pow(t-1,3)+1},easeInOutSine:function(t){return(1-Math.cos(Math.PI*t))/2}};f["ease-in"]=f.easeInQuad,f["ease-out"]=f.easeOutQuad;var aK={imgPath:"http://map.baidu.com/res_mobile2/images/"},ar=aC.lang.Event;BMap.logCountError=function(){function t(){return window.speedTest&&window.speedTest.ab&&(x=window.speedTest.ab),t=function(){return x},x}function e(e,i,n,o){var s=o>=12&&18>=o;i?(e?(u+=1,s&&(_+=1)):(c+=1,s&&(g+=1)),1==n&&(e?(m+=1,s&&(w+=1)):(p+=1,s&&(C+=1)))):e?(f+=1,s&&(y+=1)):(d+=1,s&&(v+=1)),a&&(a=!1,setTimeout(function(){var e=(1e8*Math.random()).toFixed(0);a=!0,h.src="http://map.baidu.com/mobile/img/transparent.gif?type=pic&newmap=1&t="+e+"&code=20066&pic_pl_error="+c+"&pic_ph_error="+u+"&pic_pl_all="+d+"&pic_ph_all="+f+"&pic_pl_s="+p+"&pic_ph_s="+m+"&pic_pl_error_1="+g+"&pic_ph_error_1="+_+"&pic_pl_all_1="+v+"&pic_ph_all_1="+y+"&pic_pl_s_1="+C+"&pic_ph_s_1="+m+"&ab="+t(),c=0,u=0,d=0,f=0,p=0,m=0,g=0,_=0,v=0,y=0,C=0,w=0},1e4))}function i(e){e?b+=1:M+=1,s&&(s=!1,setTimeout(function(){var e=(1e8*Math.random()).toFixed(0);s=!0,h.src="http://map.baidu.com/mobile/img/transparent.gif?type=vec&newmap=1&t="+e+"&code=20066&vec_pl_error="+T+"&vec_ph_error="+b+"&vec_pl_all="+L+"&vec_ph_all="+M+"&ab="+t(),T=0,b=0,L=0,M=0},1e4))}function n(e,i){var n=t();1==n&&(z+=e,E+=i),2==n&&(k+=e,O+=i),r&&(r=!1,setTimeout(function(){var t=(1e8*Math.random()).toFixed(0);
r=!0,h.src="http://map.baidu.com/mobile/img/transparent.gif?res=webapp&counttype=touch&newmap=1&t="+t+"&move1="+z+"&zoom1="+E+"&move2="+k+"&zoom2="+O,z=0,E=0,k=0,O=0},1e4))}function o(t,e){t?(I+=1,1==e&&(S+=1)):D+=1,l&&(l=!1,setTimeout(function(){var t=(1e8*Math.random()).toFixed(0);l=!0,h.src="http://map.baidu.com/mobile/img/transparent.gif?type=stpic&t="+t+"&code=20066&st_pic_error="+I+"&st_pic_all="+D+"&st_pic_s="+S,I=0,D=0,S=0},1e4))}var a=!0,s=!0,r=!0,l=!0,h=new Image,c=0,u=0,d=0,f=0,p=0,m=0,g=0,_=0,v=0,y=0,C=0,w=0,T=0,b=0,L=0,M=0,x=0,z=0,E=0,k=0,O=0,I=0,D=0,S=0;return{countPic:e,countVec:i,countTouch:n,countStPic:o}}();var aF={request:function(t,e){var i=o("script",{src:t,type:"text/javascript",charset:"utf-8"});e&&(BMap.logCountError.countVec(!1),i.onerror=function(){BMap.logCountError.countVec(!0)}),i.addEventListener("load",function(t){var e=t.target;e.parentNode.removeChild(e)},!1),document.getElementsByTagName("head")[0].appendChild(i),i=null}};window.sendReqNo=0,aC.object.extend(am,{Request:{INITIAL:-1,WAITING:0,COMPLETED:1},getDependency:function(){return{vector:["tile"],poly:["marker"],layer:["vector"]}},Config:{_baseUrl:"/mobile/?qt=getMobileModules&v=2&"},delayFlag:!1,ModuleTree:{_modules:{},_arrMdls:[]},load:function(t,e){var i=this.getModule(t);if(i._status!=this.Request.COMPLETED){if(i._status==this.Request.INITIAL){this.combine(t),this.pushUniqueMdl(t);var n=this;0==n.delayFlag&&(n.delayFlag=!0,window.setTimeout(function(){for(var t=n.ModuleTree._arrMdls.slice(0),e=[],i=0,o=t.length;o>i;i++){var a=t[i],s=window.asyncMdlVer[a],r="async_"+a+"_"+s;window.chkVersion(r)?t[t[i]]=window.getVersion(r):(t[t[i]]="",e.push(a+"_"+s))}if(0==e.length)for(var i=0,o=t.length;o>i;i++){var l=t[i],r="async_"+l+"_"+window.asyncMdlVer[l],h=window.getVersion(r);am.run(l,h)}else{var c=n.Config._baseUrl+"mod="+e.join(",")+"&sendReqNo="+window.sendReqNo+"&cbk=_jsload";aF.request(c),window["sendReqNo"+window.sendReqNo]=t,window.sendReqNo++}n.delayFlag=!1,n.ModuleTree._arrMdls.length=0},1)),i._status=this.Request.WAITING}i._callbacks.push(e)}},combine:function(t){var e=this.getDependency();if(t&&e[t])for(var e=e[t],i=0;i<e.length;i++)this.combine(e[i]),this.ModuleTree._modules[e[i]]||this.pushUniqueMdl(e[i])},pushUniqueMdl:function(t){for(var e=this.ModuleTree._arrMdls,i=0,n=e.length;n>i;i++)if(e[i]==t)return;e.push(t)},getModule:function(t){var e;return this.ModuleTree._modules[t]||(this.ModuleTree._modules[t]={},this.ModuleTree._modules[t]._status=this.Request.INITIAL,this.ModuleTree._modules[t]._callbacks=[]),e=this.ModuleTree._modules[t]},run:function(aO,aR){var aM="async_"+aO+"_"+window.asyncMdlVer[aO],aQ="async_"+aO;window.chkVersion(aM)||window.saveVersion(aM,aR,aQ);var aN=this.getModule(aO);try{eval(aR)}catch(aS){return}aN._status=this.Request.COMPLETED;for(var aP=0,T=aN._callbacks.length;T>aP;aP++)aN._callbacks[aP]();aN._callbacks.length=0}}),window._jsload=function(t,e,i){var n=window["sendReqNo"+i],o=t.split("_")[0];n[o]=e;for(var a=!0,s=0,r=n.length;r>s;s++)if(n[n[s]].length<=0){a=!1;break}if(a){for(var s=0,r=n.length;r>s;s++){var t=n[s],e=n[t];am.run(t,e)}n.length=0,delete window["sendReqNo"+i]}},aH.prototype.equals=function(t){return t&&t.x==this.x&&t.y==this.y},U.prototype.equals=function(t){return t&&this.width==t.width&&this.height==t.height},J.guid=0,aC.extend(J.prototype,{initialize:function(t){null==this._minZoom&&(this._minZoom=t.config.minZoom),null==this._maxZoom&&(this._maxZoom=t.config.maxZoom)},setPosition:function(t){t instanceof e&&(this._position=t)},getPosition:function(){return this._position},setText:function(t){this._text=t},getText:function(){return this._text},setUserData:function(t){this._userData=t},getUserData:function(){return this._userData}}),aC.lang.inherits(M,aC.lang.Class,"Control"),aC.extend(M.prototype,{initialize:function(t){return this._map=t,this._container?(t.container.appendChild(this._container),this._container):void 0},_i:function(t){!this._container&&this.initialize&&aq(this.initialize)&&(this._container=this.initialize(t)),this._opts=this._opts||{printable:!1},this._setStyle(),this._setPosition(),this._container&&(this._container._jsobj=this)},_setStyle:function(){var t=this._container;if(t){var e=t.style;e.position="absolute",e.zIndex=this._container.style.zIndex||"10",e.MozUserSelect="none",e.WebkitTextSizeAdjust="none",this._opts.printable||aC.dom.addClass(t,"BMap_noprint")}},remove:function(){this._map=null,this._container&&(this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container._jsobj=null,this._container=null)},_render:function(){return this._container=V(this._map.container,"<div unselectable='on'></div>"),0==this._visible&&aC.dom.hide(this._container),this._container},_setPosition:function(){this.setAnchor(this._opts.anchor)},setAnchor:function(t){(this.anchorFixed||!I(t)||isNaN(t)||BMAP_ANCHOR_TOP_LEFT>t||t>BMAP_ANCHOR_BOTTOM_RIGHT)&&(t=this.defaultAnchor),this._opts=this._opts||{printable:!1},this._opts.offset=this._opts.offset||this.defaultOffset;var e=this._opts.anchor;if(this._opts.anchor=t,this._container){var i=this._container,n=this._opts.offset.width,o=this._opts.offset.height;switch(this instanceof O&&this._map&&this._map.highResolutionEnabled()&&(i.childNodes[1].style.height="2px",i.childNodes[2].style.height="4px",i.childNodes[3].style.height="4px",i.style.height="19px"),i.firstChild.style.cssText="font-size:11px;line-height:18px;",i.style.left=i.style.top=i.style.right=i.style.bottom="auto",t){case BMAP_ANCHOR_TOP_LEFT:i.style.top=o+"px",i.style.left=n+"px";break;case BMAP_ANCHOR_TOP_RIGHT:i.style.top=o+"px",i.style.right=n+"px";break;case BMAP_ANCHOR_BOTTOM_LEFT:i.style.bottom=o+"px",i.style.left=n+"px";break;case BMAP_ANCHOR_BOTTOM_RIGHT:i.style.bottom=o+"px",i.style.right=n+"px"}var a=["TL","TR","BL","BR"];aC.dom.removeClass(this._container,"anchor"+a[e]),aC.dom.addClass(this._container,"anchor"+a[t])}},getAnchor:function(){return this._opts.anchor},setOffset:function(t){t instanceof U&&(this._opts=this._opts||{printable:!1},this._opts.offset=new U(t.width,t.height),this._container&&this.setAnchor(this._opts.anchor))},getOffset:function(){return this._opts.offset},getDom:function(){return this._container},show:function(){1!=this._visible&&(this._visible=!0,this._container&&aC.dom.show(this._container))},hide:function(){0!=this._visible&&(this._visible=!1,this._container&&aC.dom.hide(this._container))},isPrintable:function(){return!!this._opts.printable},isVisible:function(){return this._container||this._map?!!this._visible:!1}}),window.BMAP_ANCHOR_TOP_LEFT=0,window.BMAP_ANCHOR_TOP_RIGHT=1,window.BMAP_ANCHOR_BOTTOM_LEFT=2,window.BMAP_ANCHOR_BOTTOM_RIGHT=3,window.BMAP_UNIT_METRIC="metric",aC.lang.inherits(O,M,"ScaleControl"),aC.object.extend(O.prototype,{initialize:function(t){return this._map=t,this._container},setColor:function(t){this._opts.color=t+""},getColor:function(){return this._opts.color},_asyncLoadCode:function(){var t=this;am.load("control",function(){t._asyncDraw()})}}),aC.object.extend(r.prototype,{isEmpty:function(){return!this._sw||!this._ne},equals:function(t){return t instanceof r&&!this.isEmpty()?this.getSouthWest().equals(t.getSouthWest())&&this.getNorthEast().equals(t.getNorthEast()):!1},getSouthWest:function(){return this._sw},getNorthEast:function(){return this._ne},getCenter:function(){return this.isEmpty()?null:new e((this._swLng+this._neLng)/2,(this._swLat+this._neLat)/2)},extend:function(t){if(t instanceof e){var i=t.lng,n=t.lat;this._sw||(this._sw=new e(0,0)),this._ne||(this._ne=new e(0,0)),(!this._swLng||this._swLng>i)&&(this._sw.lng=this._swLng=i),(!this._neLng||this._neLng<i)&&(this._ne.lng=this._neLng=i),(!this._swLat||this._swLat>n)&&(this._sw.lat=this._swLat=n),(!this._neLat||this._neLat<n)&&(this._ne.lat=this._neLat=n)}},toSpan:function(){return this.isEmpty()?new e(0,0):new e(Math.abs(this._neLng-this._swLng),Math.abs(this._neLat-this._swLat))}}),e.prototype.equals=function(t){return t&&this.lat==t.lat&&this.lng==t.lng},aC.extend(au.prototype,{pointToPixel:function(t,e,i,n){if(t){var o=this._mapType.getZoomUnits(e),a=Math.round((t.lng-i.lng)/o+n.width/2),s=Math.round((i.lat-t.lat)/o+n.height/2);return new aH(a,s)}},pixelToPoint:function(t,i,n,o){if(t){var a=this._mapType.getZoomUnits(i),s=n.lng+a*(t.x-o.width/2),r=n.lat-a*(t.y-o.height/2),l=new e(s,r);return l}}}),aC.lang.inherits(L,aC.lang.Class,"Overlay"),L.getZIndex=function(t){return t=1*t,t?-1e5*t<<1:0},aC.extend(L.prototype,{_i:function(t){!this.domElement&&aq(this.initialize)&&(this.domElement=this.initialize(t),this.domElement&&(this.domElement.style.WebkitUserSelect="none")),this.draw()},initialize:function(){throw"initialize方法未实现"},draw:function(){throw"draw方法未实现"},remove:function(){this.domElement&&this.domElement.parentNode&&this.domElement.parentNode.removeChild(this.domElement),this.domElement=null,this.dispatchEvent(new ar("onremove"))},hide:function(){this.domElement&&aC.dom.hide(this.domElement)},show:function(){this.domElement&&aC.dom.show(this.domElement)},isVisible:function(){return this.domElement?"none"==this.domElement.style.display||"hidden"==this.domElement.style.visibility?!1:!0:!1}}),BMap.register(function(t){function e(t,e){var i=o("div"),n=i.style;return n.position="absolute",n.top=n.left=n.width=n.height="0",n.zIndex=e,t.appendChild(i),i}var i=t.temp;i.overlayDiv=t.overlayDiv=e(t.platform,200),t._panes.floatPane=e(i.overlayDiv,800),t._panes.markerMouseTarget=e(i.overlayDiv,700),t._panes.floatShadow=e(i.overlayDiv,600),t._panes.labelPane=e(i.overlayDiv,500),t._panes.markerPane=e(i.overlayDiv,400),t._panes.markerShadow=e(i.overlayDiv,300),t._panes.mapPane=e(i.overlayDiv,200)}),aC.lang.inherits(az,L,"OverlayInternal"),aC.extend(az.prototype,{initialize:function(t){return this.map=t,aC.lang.Class.call(this,this.guid),null},getMap:function(){return this.map},draw:function(){},remove:function(){this.map=null,aC.lang.decontrol(this.guid),L.prototype.remove.call(this)},hide:function(){0!=this._visible&&(this._visible=!1)},show:function(){1!=this._visible&&(this._visible=!0)},isVisible:function(){return this.domElement?!!this._visible:!1},getContainer:function(){return this.domElement},setConfig:function(t){t=t||{};for(var e in t)this._config[e]=t[e]},setZIndex:function(t){this.zIndex=t},enableMassClear:function(){this._config.enableMassClear=!0},disableMassClear:function(){this._config.enableMassClear=!1}}),BMap.register(function(t){var e=new an;e.map=t,t._overlays=e._overlays,t._customOverlays=e._customOverlays,t.addEventListener("load",function(t){e.draw(t)}),t.addEventListener("moveend",function(t){e.draw(t)}),t.addEventListener("zoomend",function(t){e.draw(t)}),t.addEventListener("addoverlay",function(t){var i=t.target;if(i instanceof az)e._overlays[i.guid]||(e._overlays[i.guid]=i);else{for(var n=!1,o=0,a=e._customOverlays.length;a>o;o++)if(e._customOverlays[o]===i){n=!0;break}n||e._customOverlays.push(i)}}),t.addEventListener("removeoverlay",function(t){var i=t.target;if(i instanceof az)delete e._overlays[i.guid];else for(var n=0,o=e._customOverlays.length;o>n;n++)if(e._customOverlays[n]===i){e._customOverlays.splice(n,1);break}}),t.addEventListener("clearoverlays",function(){for(var t in e._overlays)e._overlays[t]._config.enableMassClear&&(e._overlays[t].remove(),delete e._overlays[t]);for(var i=0,n=e._customOverlays.length;n>i;i++)0!=e._customOverlays[i].enableMassClear&&(e._customOverlays[i].remove(),e._customOverlays[i]=null,e._customOverlays.splice(i,1),i--,n--)})}),an.prototype.draw=function(){for(var t in this._overlays)this._overlays[t].draw();aC.array.each(this._customOverlays,function(t){t.draw()})},aC.lang.inherits(ap,az,"Graph"),ap.getGraphPoints=function(t){var i=[];if(!t)return i;if(aB(t)){var n=t.split(";");aC.array.each(n,function(t){var n=t.split(",");i.push(new e(n[0],n[1]))})}return t.constructor==Array&&t.length>0&&(i=t),i},ap.parseTolerance=[.09,.005,1e-4,1e-5],aC.extend(ap.prototype,{initialize:function(t){return this.map=t,null},draw:function(){},setPath:function(t){this._parseCache.length=0,this.points=ap.getGraphPoints(t).slice(0),this._calcBounds()},_calcBounds:function(){if(this.points){var t=this;t._bounds=new r,aC.array.each(this.points,function(e){t._bounds.extend(e)})}},getPath:function(){return this.points},setPositionAt:function(t,i){i&&this.points[t]&&(this._parseCache.length=0,this.points[t]=new e(i.lng,i.lat),this._calcBounds())},setStrokeColor:function(t){this._config.strokeColor=t},getStrokeColor:function(){return this._config.strokeColor},setStrokeWeight:function(t){t>0&&(this._config.strokeWeight=t)},getStrokeWeight:function(){return this._config.strokeWeight},setStrokeOpacity:function(t){!t||t>1||0>t||(this._config.strokeOpacity=t)},getStrokeOpacity:function(){return this._config.strokeOpacity},setStrokeStyle:function(t){("solid"==t||"dashed"==t)&&(this._config.strokeStyle=t)},getStrokeStyle:function(){return this._config.strokeStyle},getBounds:function(){return this._bounds},remove:function(){az.prototype.remove.call(this),this._parseCache.length=0}});var N=q.prototype;N.setImageUrl=function(t){t&&(this.imageUrl=t)},N.setPrintImageUrl=function(t){t&&(this.printImageUrl=t)},N.setSize=function(t){t&&(this.size=new U(t.width,t.height))},N.setAnchor=function(t){t&&(this.anchor=new U(t.width,t.height))},N.setImageOffset=function(t){t&&(this.imageOffset=new U(t.width,t.height))},N.toString=function(){return"Icon"};var ae=aK.imgPath+"red_marker.png",aA=new q(ae,new U(19,25),{anchor:new U(10,25)}),F=new q(ae,new U(20,11),{anchor:new U(6,11),imageOffset:new U(-19,-13)});C.TOP_ZINDEX=L.getZIndex(-90)+1e6,aC.lang.inherits(C,az,"Marker"),aC.extend(C.prototype,{setIcon:function(t){t instanceof q&&(this._config.icon=t)},getIcon:function(){return this._config.icon},setShadow:function(t){t instanceof q&&(this._config.shadow=t)},getShadow:function(){return this._config.shadow},getPosition:function(){return this.point},setPosition:function(t){t instanceof e&&(this.point=new e(t.lng,t.lat))},setTop:function(t,e){this._config.isTop=!!t,t&&(this._addi=e||0)},setTitle:function(t){this._config.title=t+""},getTitle:function(){return this._config.title},setOffset:function(t){t instanceof U&&(this._config.offset=t)},getOffset:function(){return this._config.offset}}),aC.lang.inherits(ag,ap,"Polyline"),BMap.register(function(t){var e=new ay(t);e.initialize(),t.tileMgr=e}),aC.extend(ay.prototype,{initialize:function(){var t=this,e=t.map;e.addEventListener("loadcode",function(){t.loadTiles()}),e.addEventListener("addtilelayer",function(e){t.addTileLayer(e)}),e.addEventListener("removetilelayer",function(e){t.removeTileLayer(e)}),e.addEventListener("zoomstartcode",function(e){t._zoom(e)}),e.addEventListener("zoomend",function(e){t.setRasterTrafficStatus(e)}),e.addEventListener("trafficchange",function(e){this.rasterTrafficLayer||(this.rasterTrafficLayer=new af),t.setRasterTrafficStatus(e)}),t.addMapClickEvent()},loadTiles:function(){var t=this;if(t.loaded||t.initMapTypeTiles(),t.moveGridTiles(),!t.loaded){t.loaded=!0;var e="tile",i="vector",n=window.asyncMdlVer[e],o=window.asyncMdlVer[i],a="async_"+e+"_"+n,s="async_"+i+"_"+o,r=window.getVersion(a),l=window.getVersion(s);n&&r&&o&&l?(am.run(e,r),am.run(i,l),t._asyncLoadCode()):t.map.vectorMapEnabled()?am.load("vector",function(){t._asyncLoadCode()}):am.load("tile",function(){t._asyncLoadCode()})}},initMapTypeTiles:function(){for(var t=this.map.getMapType(),e=t.getTileLayers(),i=0;i<e.length;i++){var n=new z;aC.extend(n,e[i]),this.mapTypeLayers.push(n),n.initialize(this.map,this._mapTypeLayerContainer)}},_createDiv:function(t){var e=o("div");return e.style.position="absolute",e.style.left=e.style.top="0",e.style.zIndex=t,e},_checkTilesLoaded:function(){this.numLoading--;var t=this;this.isFirstTile&&(this.map.dispatchEvent(new ar("onfirsttileloaded")),this.isFirstTile=!1),0==this.numLoading&&(this._checkLoadedTimer&&(clearTimeout(this._checkLoadedTimer),this._checkLoadedTimer=null),this._checkLoadedTimer=setTimeout(function(){0==t.numLoading&&(t.map.dispatchEvent(new ar("ontilesloaded")),t.isFirstTile=!0),t._checkLoadedTimer=null},80))},getTileName:function(t,e){return"TILE-"+e.guid+"-"+t[0]+"-"+t[1]+"-"+t[2]},hideTile:function(t){var e=t.img;e&&n(e)&&e.parentNode.removeChild(e),delete this.mapTiles[t.name],t.loaded||(e=null,t._callCbks(),t.img=null,t.mgr=null)},moveGridTiles:function(){for(var t=this.mapTypeLayers,e=t.concat(this.tileLayers),i=e.length,n=0;i>n;n++){var o=e[n];if(o.baseLayer){this.tilesDiv=o.tilesDiv;var a=this.tilesDiv;if(this.map.getZoom()>=this.map.config.vectorMapLevel){a.style.display="none";continue}a.style.display="block"}if(!o._isVectorLayer){var s=this.map,r=s.getMapType(),l=(r.getProjection(),s.zoomLevel),h=s.mercatorCenter,c=r.getZoomUnits(l),u=r.getZoomFactor(l),d=Math.ceil(h.lng/u),f=Math.ceil(h.lat/u),p=r.getTileSize(),m=[d,f,(h.lng-d*u)/u*p,(h.lat-f*u)/u*p],g=m[0]-Math.ceil((s.width/2-m[2])/p),_=m[1]-Math.ceil((s.height/2-m[3])/p),v=m[0]+Math.ceil((s.width/2+m[2])/p),y=m[1]+Math.ceil((s.height/2+m[3])/p),C=this.mapTiles,w=-h.lng/c,T=h.lat/c,b=[Math.round(w),Math.round(T)],L=s.getZoom();for(var M in C){var x=C[M],z=x.info;(z[2]!=L||z[2]==L&&(g>z[0]||v<=z[0]||_>z[1]||y<=z[1]))&&this.hideTile(x)}var E=-s.offsetX+s.width/2,k=-s.offsetY+s.height/2;o.tilesDiv.style.left=E+"px",o.tilesDiv.style.top=k+"px",this.tilesOrder?this.tilesOrder.length=0:this.tilesOrder=[],s._viewTiles?s._viewTiles.length=0:s._viewTiles=[];for(var O=g;v>O;O++)for(var I=_;y>I;I++)this.tilesOrder.push([O,I]),s._viewTiles.push({x:O,y:I});if(this.tilesOrder.sort(function(t){return function(e,i){return.4*Math.abs(e[0]-t[0])+.6*Math.abs(e[1]-t[1])-(.4*Math.abs(i[0]-t[0])+.6*Math.abs(i[1]-t[1]))}}([m[0]-1,m[1]-1])),!this.map.enableLoadTiles)return;var D=o.baseLayer?!0:!1;D&&(this.map.dispatchEvent(new ar("ontilesbegin")),this.numLoading+=this.tilesOrder.length),o instanceof af&&(this.map.dispatchEvent(new ar("onTrafficbegin")),this._statRTCount=0,this._statRTTotalCount=0);for(var O=0,S=this.tilesOrder.length;S>O;O++)this.showTile([this.tilesOrder[O][0],this.tilesOrder[O][1],L],b,o)}}},showTile:function(t,i,n){var o=this,a=n.baseLayer?!0:!1;o.centerPos=i;var s=this.map.getMapType(),r=o.getTileName(t,n),l=s.getTileSize(),h=t[0]*l+i[0],c=(-1-t[1])*l+i[1],u=[h,c],d=this.mapTiles[r];if(d&&d.img)return aL(d.img,u),a&&(d.loaded?this._checkTilesLoaded():d._addLoadCbk(function(){o._checkTilesLoaded()})),void 0;if(d=this.bufferTiles[r],d&&d.img)return n.tilesDiv.insertBefore(d.img,n.tilesDiv.lastChild),this.mapTiles[r]=d,aL(d.img,u),a&&(d.loaded?this._checkTilesLoaded():d._addLoadCbk(function(){o._checkTilesLoaded()})),void 0;var f=l*Math.pow(2,s.getMaxZoom()-t[2]),p=(new e(t[0]*f,t[1]*f),new aH(t[0],t[1])),m=n.getTilesUrl(p,t[2]);d=new at(this,m,u,t,n),a&&d._addLoadCbk(function(){o._checkTilesLoaded()}),d._load(),this.mapTiles[r]=d},addTileLayer:function(t){for(var e=this,i=t.target,n=0;n<e.tileLayers.length;n++)if(e.tileLayers[n]==i)return;var o=i._isVectorLayer?this._vectorLayerContainer:this._normalLayerContainer;i.initialize(this.map,o),e.tileLayers.push(i)},removeTileLayer:function(t){for(var e=this,i=t.target,n=0,o=e.tileLayers.length;o>n;n++)i==e.tileLayers[n]&&e.tileLayers.splice(n,1);i.remove()},_zoom:function(){var t=this;setTimeout(function(){t.moveGridTiles(),t.map.dispatchEvent(new ar("onzoomend"))},10)},addMapClickEvent:function(){var t=this,e=200,i=null,n=0;t.map.addEventListener("click",function(o){return n++,1!=n?(clearTimeout(i),n=0,!1):(i=setTimeout(function(){n=0;var e=null,i=t.tileLayers;for(var a in i)if(i[a]instanceof E){e=i[a];break}e&&e.vectorClick(o)||t.vectorDrawLib&&t.vectorDrawLib.vectorClick(o)},e),void 0)})},setRasterTrafficStatus:function(){var t=this,e=t.map,i=e.getZoom();e.config.trafficStatus&&i<e.config.vectorMapLevel?e.addTileLayer(e.rasterTrafficLayer):e.removeTileLayer(e.rasterTrafficLayer)}}),at.prototype._addLoadCbk=function(t){this._cbks.push(t)},at.prototype._load=function(){this.img.src=this.src,BMap.logCountError.countPic(this.isHighResolution,!1,0,this.level)},at.prototype._callCbks=function(){for(var t=this,e=0;e<t._cbks.length;e++)t._cbks[e]();t._cbks.length=0},z._guid=0,aC.lang.inherits(z,aC.lang.Class,"TileLayer"),aC.extend(z.prototype,{initialize:function(t,e){if(this.baseLayer&&(this.zIndex=-100),this.map=t,!this.tilesDiv){var i=o("div"),n=i.style;n.position="absolute",n.zIndex=this.zIndex,n.left=Math.ceil(-t.offsetX+t.width/2)+"px",n.top=Math.ceil(-t.offsetY+t.height/2)+"px",e.appendChild(i),this.tilesDiv=i}},remove:function(){this.tilesDiv&&this.tilesDiv.parentNode&&(this.tilesDiv.innerHTML="",this.tilesDiv.parentNode.removeChild(this.tilesDiv)),delete this.tilesDiv},getTilesUrl:function(t,e){var i="";return this.opts.tileUrlTemplate&&(i=this.opts.tileUrlTemplate.replace(/\{X\}/,t.x),i=i.replace(/\{Y\}/,t.y),i=i.replace(/\{Z\}/,e)),i},getMapType:function(){return this.mapType}}),af.prototype=new z,af.prototype.initialize=function(t,e){z.prototype.initialize.call(this,t,e),this._map=t},af.prototype.getTilesUrl=function(t,e){this._map.tileMgr._statRTTotalCount++;var i="";i=this._opts.predictDate?"HistoryService?day="+(this._opts.predictDate.weekday-1)+"&hour="+this._opts.predictDate.hour+"&t="+(new Date).getTime()+"&":"TrafficTileService?time="+(new Date).getTime()+"&";var n=(this._map,t.x),o=t.y,a=(Math.floor(n/200),Math.floor(o/200),this._tileUrl+i+"level="+e+"&x="+n+"&y="+o);return a.replace(/-(\d+)/gi,"M$1")},aC.inherits(E,z,"MDLayer"),aC.extend(E.prototype,{initialize:function(t,e){this._map=t,this._container=e},remove:function(){this._map=null,this._container=null},setKeyword:function(t){this._keyWord=t},getKeyword:function(){return this._keyWord},setCityCode:function(t){this._cityCode=t},getCityCode:function(){return this._cityCode},refreshLayer:function(){}}),aC.extend(aG.prototype,{getName:function(){return this._name},getTips:function(){return this._opts.tips},getLabelText:function(){return this._opts.labelText},getTileLayer:function(){return this._layers[0]},getTileLayers:function(){return this._layers},getTileSize:function(){this._opts.tileSize=256;var t=this._opts.mapInstance;return t.highResolutionEnabled()&&t.getZoom()<t.config.vectorMapLevel&&(this._opts.tileSize=128),this._opts.tileSize},getMinZoom:function(){return this._opts.minZoom},getMaxZoom:function(){return this._opts.maxZoom},getTextColor:function(){return this._opts.textColor},getProjection:function(){return this._opts.projection},getErrorImageUrl:function(){return this._opts.errorImageUrl},getZoomUnits:function(t){var e=1,i=this._opts.mapInstance;return i.highResolutionEnabled()&&i.getZoom()<i.config.vectorMapLevel&&(e=2),Math.pow(2,18-t)*e},getZoomFactor:function(t){return this.getZoomUnits(t)*this.getTileSize()}});var s={pd:{host:["http://online0.map.bdimg.com/it/","http://online1.map.bdimg.com/it/","http://online2.map.bdimg.com/it/","http://online3.map.bdimg.com/it/"],params:{fm:42,f:"webapp",format_add:".jpg"}},hd:{host:["http://or1.map.baidu.com:8080/it/","http://or2.map.baidu.com:8080/it/","http://or3.map.baidu.com:8080/it/","http://or4.map.baidu.com:8080/it/"],params:{format:"jpeg",fm:41,quality:70,f:"webapp",format_add:".jpg"}}},ax=new z;ax.getTilesUrl=function(t,e){var i,n,o=t.x,a=t.y,r=BMap.TILE_CONFIG||s;this.map.highResolutionEnabled()?(i=r.hd,"undefined"!=typeof TVC&&(n=TVC.webapp.high_normal)):(i=r.pd,"undefined"!=typeof TVC&&(n=TVC.webapp.lower_normal));var l="u=x="+o+";y="+a+";z="+e;l+=n&&n.version?";v="+n.version:";v=014",l+=";type=web";var h=i.host[Math.abs(o+a)%i.host.length]+l;n&&n.updateDate&&(h+="&udt="+n.updateDate);for(var c in i.params)h+="&"+c+"="+i.params[c];return h.replace(/-(\d+)/gi,"M$1")},y.MAX_ZOOM=5,y.MIN_ZOOM=0,aC.lang.inherits(y,aC.lang.Class,"StreetView"),aC.extend(y.prototype,{_init:function(){},getLinks:function(){return this._links},getId:function(){return this._id},getPosition:function(){return this._position},getPov:function(){return this._pov},getZoom:function(){return this._zoom},getDescription:function(){return this._description},getRelevants:function(){return this._relevants||[]},getMode:function(){return this._mode},setId:function(t){t!=this._id&&(this._lastId=this._id,this._id=t,this._position=null,this._innerId=null)},setInnerId:function(t){t!=this._innerId&&(this._innerId=t,this._id=null,this._position=null)},setPosition:function(t){t.equals(this._position)||(this._lastId=this._id,this._position=t,this._id=null,this._innerId=null)},setPov:function(t){this._pov=t,this._pov.pitch>45&&(this._pov.pitch=45),this._pov.pitch<-10&&(this._pov.pitch=-10)},setZoom:function(t){t!=this._zoom&&(t>y.MAX_ZOOM&&(t=y.MAX_ZOOM),t<y.MIN_ZOOM&&(t=y.MIN_ZOOM),t!=this._zoom&&(this._zoom=t))},enableDoubleClickZoom:function(){this._opts.enableDoubleClickZoom=!0},disableDoubleClickZoom:function(){this._opts.enableDoubleClickZoom=!1},clear:function(){this._data=null,this._id=null,this._position=null,this._links=[],this.dispatchEvent(new ar("onclear"))}}),j.URLS=["http://pcsv0.map.bdimg.com/tile/","http://pcsv1.map.bdimg.com/tile/"],j.prototype=new z,j.prototype.getTilesUrl=function(t,e){var i=(t.x+t.y)%j.URLS.length,n="pl";return j.URLS[i]+"?udt=v&qt=tile&styles="+n+"&x="+t.x+"&y="+t.y+"&z="+e},D("Map",w),D("Hotspot",J),D("MapType",aG),D("Point",e),D("Pixel",aH),D("Size",U),D("Bounds",r),D("TileLayer",z),D("MDLayer",E),D("Overlay",L),D("Marker",C),D("Icon",q),D("Polyline",ag),D("Control",M),D("ScaleControl",O),D("StreetView",y),D("StreetViewCoverageLayer",j)}(),module.exports=BMap});