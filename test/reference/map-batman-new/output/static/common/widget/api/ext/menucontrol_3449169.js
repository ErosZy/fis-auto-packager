define("common:widget/api/ext/menucontrol.js",function(t,e,n){var i=t("common:static/js/util.js"),a=t("common:widget/url/url.js"),o=t("common:widget/cookie/cookie.js"),s=t("common:widget/login/login.js"),c=t("common:widget/pagemgr/pagemgr.js"),d=t("common:widget/stat/stat.js"),r=function(t){this.defaultAnchor=BMAP_ANCHOR_BOTTOM_RIGHT;var e=new BMap.Size(53,38);i.isIPad()&&(e=new BMap.Size(16,62)),this.defaultOffset=e,this.menuBtn=t,this.isOn=!1};r.prototype=new BMap.Control,$.extend(r.prototype,{initialize:function(t){this._map=t;var e=this._container=document.createElement("div");e.id="menu-drop-container",e.style.position="absolute",e.className="menu-ctrl-drop";var n=document.createElement("ul");n.className="menu-list-con",e.appendChild(n),$(n).html('<li id="menu-city" data-tab="1">切换城市</li><li id="menu-pano" data-tab="2">全景</li><li id="menu-info-center" data-tab="3">个人中心(<span>未登录</span>)</li><li id="menu-feedback" data-tab="4">意见反馈</li><li id="menu-download" data-tab="5" style="color:#00c;" data="">下载手机客户端</li>'),t.getContainer().appendChild(e),this.bind(),this.setCmsConfig();var i=function(){var t=a.get();"index"!==t.module||"index"!==t.action?$("#menu-city, #menu-pano, #menu-info-center").hide():$("#menu-city, #menu-pano, #menu-info-center").show()};return listener.on("common.page","switchend",i),i("init",a.get()),e},setCmsConfig:function(){$appbutton=$("#menu-download"),i.isInstalledClient(function(t){$appbutton.attr("data",t).text("打开客户端")},function(t){$appbutton.attr("data",t).text("下载手机客户端")})},bind:function(){var t=(this._map,this),e=c.isSinglePageApp()?"click":"touchstart";$(this._container).on(e,function(n){"touchstart"===e&&(n.preventDefault(),n.stopPropagation()),t.onClick(n,this)}),$(this._container).find("li").on("touchstart",function(){$(this).css("background","#eee")}),$(this._container).find("li").on("touchend",function(){$(this).css("background","none")})},onClick:function(t,e){var n=a.get(),o=$(t.target).data("tab");switch(o){case 1:d.addCookieStat(COM_STAT_CODE.MAP_MENU_CHANGE_CITY_CLICK),a.update({module:"index",action:"setmylocation",query:n.query,pageState:{}},{trigger:!0,queryReplace:!0,pageStateReplace:!0});break;case 2:d.addCookieStat(COM_STAT_CODE.MAP_MENU_SVENTRY_CLICK),a.update({module:"index",action:"sventry"},{trigger:!0,pageStateReplace:!0,queryReplace:!0});break;case 3:s.checkLogin(function(t){t.status?(d.addCookieStat(COM_STAT_CODE.MAP_MENU_USER_CENTER_CLICK),s.goMycenter()):(d.addStat(COM_STAT_CODE.MAP_MENU_USER_CENTER_CLICK),s.loginAction())});break;case 4:if(d.addCookieStat(COM_STAT_CODE.MAP_MENU_FEEDBACK_CLICK),"feedback"==n.module)return;var c=n.module+"/"+n.action,r=[n.module,n.action,i.jsonToUrl(n.query),i.jsonToUrl(n.pageState)].join("/"),n={module:"feedback",action:"show",query:{page_id:encodeURIComponent(c),hash:encodeURIComponent(r)}};a.update(n,{trigger:!0,pageStateReplace:!0,queryReplace:!0});break;case 5:d.addStat(COM_STAT_CODE.MAP_MENU_BDAPP_CLICK),setTimeout(function(){window.location.href=$(t.target).attr("data")},200)}this.menuBtn.hideMenuDrop()}});var u=function(){this.defaultAnchor=BMAP_ANCHOR_BOTTOM_RIGHT;var t=new BMap.Size(8,16);i.isIPad()&&(t=new BMap.Size(16,62)),this.defaultOffset=t,this.isOn=!1};u.prototype=new BMap.Control,$.extend(u.prototype,{initialize:function(t){this._map=t;var e=this._container=document.createElement("div");e.id="menu-btn-container",e.style.position="absolute",e.className="menu-ctrl-btn";var n=document.createElement("div");return n.className="menu-ctrl-icon",e.appendChild(n),t.getContainer().appendChild(e),this.bind(),e},bind:function(){var t=this._map,e=this;this._container.onclick=$.proxy(function(){d.addStat(COM_STAT_CODE.MAP_MENU_ICON_CLICK),this._menuDrop||(this._menuDrop=new r(e),t.addControl(this._menuDrop)),this._menuDrop[this.isOn?"hide":"show"](),this.isOn=!this.isOn;var n=$("#menu-info-center span");o.get("myUserName")?n.text("已登录"):s.checkLogin(function(t){t.status?n.text("已登录"):n.text("未登录")})},this)},hideMenuDrop:function(){this.isOn=!1,this._menuDrop&&this._menuDrop.hide()}}),u._className_="MenuControl",n.exports=u});