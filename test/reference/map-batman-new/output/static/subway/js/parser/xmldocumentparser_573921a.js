var Station=require("subway:static/js/base/station.js"),Line=require("subway:static/js/base/line.js"),Subway=require("subway:static/js/base/subway.js");define("subway:static/js/parser/xmldocumentparser.js",function(t,e,r){var a=function(t,e){this.xmlDoc=t,this.transformScale=e||1.3,this.marginRatio=1.1};a.prototype.parse=function(){if(!this.xmlDoc)return null;for(var t,e,r,a,i=this.xmlDoc.getElementsByTagName("sw")[0],s=this.parseSubway(i),o={left:Number.POSITIVE_INFINITY,right:Number.NEGATIVE_INFINITY,top:Number.POSITIVE_INFINITY,bottom:Number.NEGATIVE_INFINITY},u=[],n=this.xmlDoc.getElementsByTagName("l"),l=0;l<n.length;l++){for(var b=this.parseLine(n[l]),g=[],h=n[l].getElementsByTagName("p"),p=0;p<h.length;p++){var c=this.parseStation(h[p]);c.lid=b.lid,c.x<o.left&&(o.left=c.x,t=c.sid),c.x>o.right&&(o.right=c.x,e=c.sid),c.y<o.top&&(o.top=c.y,r=c.sid),c.y>o.bottom&&(o.bottom=c.y,a=c.sid),g.push(c)}b.stations=g,u.push(b)}for(var m=o.left*this.marginRatio>>0,A=o.top*this.marginRatio>>0,f=0;f<u.length;f++){var y=u[f];y.lbx-=m,y.lby-=A;for(var S=0;S<y.stations.length;S++){var x=y.stations[S];x.x-=m,x.y-=A,x.lc=y.lc}}return s.bounds=o,s.lines=u,s.width=Math.abs(o.left-o.right)*this.marginRatio>>0,s.height=Math.abs(o.bottom-o.top)*this.marginRatio>>0,s},a.prototype.parseSubway=function(t){var e=t.getAttribute("c"),r=t.getAttribute("cid"),a=t.getAttribute("n");return new Subway(e,r,a)},a.prototype.parseLine=function(t){var e=t.getAttribute("lid"),r=t.getAttribute("lb"),a=t.getAttribute("slb"),i=t.getAttribute("uid"),s=parseInt(t.getAttribute("n"),10),o="true"==t.getAttribute("loop"),u=parseFloat(t.getAttribute("lbx"))*this.transformScale,n=parseFloat(t.getAttribute("lby"))*this.transformScale+15*this.transformScale,l=parseFloat(t.getAttribute("lbr")),b="#"+t.getAttribute("lc").slice(2);return new Line(e,r,a,i,s,o,u,n,l,b)},a.prototype.parseStation=function(t){var e=t.getAttribute("sid"),r=t.getAttribute("lb"),a=t.getAttribute("uid"),i=parseFloat(t.getAttribute("px")),s=parseFloat(t.getAttribute("py")),o=parseFloat(t.getAttribute("x"))*this.transformScale,u=parseFloat(t.getAttribute("y"))*this.transformScale,n=parseFloat(t.getAttribute("rx"))*this.transformScale+2*this.transformScale,l=parseFloat(t.getAttribute("ry"))*this.transformScale+12*this.transformScale,b="true"==t.getAttribute("st"),g="true"==t.getAttribute("ex"),h="true"==t.getAttribute("iu"),p="true"==t.getAttribute("rc"),c="true"==t.getAttribute("slb"),m=t.getAttribute("ln"),A=t.getAttribute("icon")||"",f=parseFloat(t.getAttribute("dx"))*this.transformScale,y=parseFloat(t.getAttribute("dy"))*this.transformScale,S=0,x=0;try{S=parseFloat(t.getAttribute("trs_x"))*this.transformScale||0,x=parseFloat(t.getAttribute("trs_y"))*this.transformScale||0}catch(I){}S-=8*this.transformScale,x-=8*this.transformScale;var d;return new Station(e,r,a,i,s,o,u,n,l,b,g,h,p,c,m,d,A,f,y,S,x)},r.exports=a});