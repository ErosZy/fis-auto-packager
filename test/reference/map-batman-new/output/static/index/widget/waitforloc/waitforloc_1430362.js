define("index:widget/waitforloc/waitforloc.js",function(t,e,n){var i=t("common:widget/geolocation/geolocation.js"),a=t("common:widget/url/url.js"),o=t("common:widget/geolocation/location.js");n.exports={config:{lineQtMap:{bt:"bse"},qtMap:{place:"s|con|nb|bd",transit:"bt|bse",drive:"nav|nse",walk:"walk|wse"}},init:function(){this.initIpGeo(),this.bindEvent(),this.initGeo()},initIpGeo:function(){try{var t=window.localStorage;window._DEFAULT_CITY.index?(t.setItem("_DEFAULT_CITY",JSON.stringify(window._DEFAULT_CITY)),cookie.set("DEFAULT_CITY","1",{expires:3e5,domain:"baidu.com",path:"/"})):window._DEFAULT_CITY=JSON.parse(t.getItem("_DEFAULT_CITY"))||{}}catch(e){}var n,i,a,r,c;n=JSON.parse(_DEFAULT_CITY.index)||{},i=n&&n.content,a=i&&i.geo,c=i.level,r=a.split(";")[1].split("|")[0].split(","),1==i.code&&(i.name="全国"),locationData={addr:{city:i.cname,cityCode:i.code},point:{x:r[0],y:r[1]},level:c,type:"ip",isExactPoi:!1,isGeoEnd:!1},o.setAddress(locationData)},bindEvent:function(){var t=this;listener.on("common.geolocation","success",function(){t.geoSuccess()}),listener.on("common.geolocation","fail",function(){t.geoFail()})},initGeo:function(){var t=this;i.init(),setTimeout(function(){t.geoFail()},8e3)},geoSuccess:function(){var t=a.get();this._initMixLocOptionsPage(t)},geoFail:function(){var t=a.get();this.locErrorCallback(t)},_initMixLocOptionsPage:function(t){var e=this,n=t.pageState&&t.pageState.needloc;t.query,n&&"1"===n?e._initPlacePage(t):e._initTransitPage(t)},_initTransitPage:function(t){var e="我的位置",n=t.query||{},i=n.sn||"",r=n.en||"",c=n,s="sn",d=""+i.split("$$")[3],g=""+r.split("$$")[3],l="1$$$$"+o.getPointX()+","+o.getPointY()+"$$我的位置$$",h=c.wd?c.wd:d!=e?d:g;d===e||g===e?g===e&&(s="en"):s=""===$.trim(d)?"sn":"en",c[s]=l,c=$.extend(c,{ptx:o.getPointX(),pty:o.getPointY(),bsetp:1,ec:o.getCityCode(),sc:o.getCityCode(),isSingle:"true",name:e,wd:h}),c.qt=this.config.lineQtMap[c.qt]||c.qt,a.update({module:"search",action:"search",query:c,pageState:{has_handle_geo:1,needloc:""}},{trigger:!0,replace:!0})},getSearchTypeConfig:function(){var t=this.config.qtMap,e={};return $.each(t,function(t,n){_qt=n.split("|"),$.each(_qt,function(n,i){e[i]=t})}),e},_initPlacePage:function(t){var e=this,n={center_rank:1,nb_x:o.getPointX(),nb_y:o.getPointY(),c:o.getCityCode()};e._getOptions(t,n),a.update({module:"search",action:"search",query:{center_rank:n.center_rank,nb_x:n.nb_x,nb_y:n.nb_y,c:n.c},pageState:{center_name:"我的位置",has_handle_geo:1,needloc:""}},{replace:!0})},_getOptions:function(t,e){for(var n in e)t.query[n]=e[n];return t},_initPage:function(){this._searchData()},locErrorCallback:function(t){var e=this.getSearchType(t);switch(e){case"place":this._initPage(t);break;case"walk":case"transit":case"drive":this.setSearchBoxValue(t);default:this._switchToIndex(t)}},getSearchType:function(t){if(t){var e=t.query||{},n=e.qt,i=this.searchTypeConfig||this.getSearchTypeConfig();return this.searchTypeConfig=i,i[n]}},setSearchBoxValue:function(t){var e=this._getStartAndEndWord(t)||{},n="我的位置";e.start&&e.start!=n&&(this.start="word="+encodeURIComponent(e.start)),e.end&&e.end!=n&&(this.end="word="+encodeURIComponent(e.end))},_getUrl:function(){var t=a.get().query||{};return this.isLanding&&(third_party=location.href.match(/[\?\&]third_party=([^&^#]+)/),third_party&&(t.searchFlag=third_party[1]||"","baidukuangpush"===third_party[1]&&(t.tg="push"))),t.c||(t.c=o.getCityCode()),["nav","nse","walk","wse"].indexOf(t.qt)>=0&&(t.version="3"),("nav"==t.qt||"bt"==t.qt)&&(t.wd1&&!t.sn&&(t.sn="2$$$$$$"+t.wd1+"$$"),t.wd2&&!t.en&&(t.en="2$$$$$$"+t.wd2+"$$")),t},_searchData:function(){var t=this._getUrl();a.update({module:"search",action:"search",query:t,pageState:{needloc:""}},{replace:!0,queryReplace:!0})},_switchToIndex:function(t){var e=this.getSearchType(t),n=t.pagestate||{},i=t.query||{},o="";n.tab=e,("walk"===n.tab||"drive"===n.tab||"transit"===n.tab)&&(o="line");var r={};this.start&&(r.start=this.start),this.end&&(r.end=this.end),r.tab=o,a.update({module:"index",action:"index",query:i,pageState:r},{trigger:!0,replace:!0,queryReplace:!0,pageStateReplace:!0})},_getStartAndEndWord:function(t){if(t&&t.query){var e=t.query,n=e.sn||"",i=e.en||"",a=n.split("$$")[3]||e.name||"",o=i.split("$$")[3]||e.wd||"";return{start:a,end:o}}}}});