define("common:widget/bottombanner/bottombanner.js",function(e,t,n){"use strict";var i=e("common:static/js/util.js"),o={loadCmsAdConfig:function(e){var t=(new Date).getTime(),n=document.getElementsByTagName("HEAD").item(0),i=document.createElement("script");i.type="text/javascript",i.src="http://map.baidu.com/zt/cms/ws.js?"+t,i.onload=$.proxy(e,this),n.appendChild(i)},getCurrentHash:function(){var e=window._APP_HASH,t=window.location.pathname.replace("/mobile/webapp/",""),n=t.split("/"),o=n[2],a=n[3];return{module:e.module,action:e.action,query:i.urlToJSON(o||""),pageState:i.urlToJSON(a||"")}},checkDisplayBanner:function(e){var t,n,i,o,a,r=[],s=window.bottomBannerDisplayRule,d=e.module,c=e.action,l=e.query,u=e.pageState;return s?($.each(s,function(e,s){t=[],s.module&&(n=s.module.substring(0,1),i=s.module.substring(1),t.push("!"===n?-1===i.indexOf(d):i.indexOf(d)>-1)),s.action&&(n=s.action.substring(0,1),i=s.action.substring(1),t.push("!"===n?-1===i.indexOf(c):i.indexOf(c)>-1)),s.query&&$.each(s.query,function(e,a){n=a.substring(0,1),i=a.substring(1),o=l[e]||void 0,t.push("!"===n?-1===i.indexOf(o):i.indexOf(o)>-1)}),s.pagestate&&$.each(s.pagestate,function(e,o){n=o.substring(0,1),i=o.substring(1),a=u[e]||void 0,t.push("!"===n?-1===i.indexOf(a):i.indexOf(a)>-1)}),r.push(-1===t.indexOf(!1))}),-1!==r.indexOf(!0)?!0:!1):!1},isHideBanner:function(){return this.bannerHide?(localStorage.hbt=Date.now(),!0):localStorage.hbt?Date.now()>Number(localStorage.hbt)+9e5?(localStorage.removeItem("hbt"),!1):!0:!1},getPageConfig:function(){var e,t,n,o=this.getCurrentHash(),a=o.module,r=o.action,s=o.query,d=o.pageState,c={};this.cmsDisplayRule=window.bottomBannerDisplayRule;var l=window.webapp_cms_bottom_download_img;if(_APP_HASH.third_party){var u=window["third_"+_APP_HASH.third_party+"_bottom_config"];u&&$.each(u,function(e,t){l[e]=t})}if(!l||!this.checkDisplayBanner(o)||this.isHideBanner())return null;try{e=l[a][r]}catch(h){e=null}try{l&&l.wd&&(t=new RegExp(l.wd.transitType,"g"),n=new RegExp(l.wd.driveType,"g"))}catch(h){}if(s.wd&&s.wd.search(t)>-1)try{e=l.transit.list}catch(h){}else if(s.wd&&s.wd.search(n)>-1)try{e=l.drive.list}catch(h){}else"groupon"===d.detail_part&&(e=l.groupon||e);if(!e){if(!l.other)return null;e=l.other}return e?(c.needOpen=e.openUrl?!0:!1,c.bgUrl=e.openUrl&&this.hasInstalled?e.openUrl:e.downloadImgUrl,c.srcUrl=i.isIPhone()?e.iponeSrc:i.isAndroid()?e.androidSrc:i.isIPad()?e.ipadSrc:e.androidSrc,c):null},renderAfterLoaded:function(){this.config=this.getPageConfig(),this.config&&this.config.bgUrl?(this.$el.css("background-image","url("+this.config.bgUrl+")").attr("data-href",this.config.srcUrl).show(),listener.trigger("common","sizechange")):this.$el.hide()},init:function(e){this.bannerHide=e||!1,this.loadCmsAdConfig(function(){var e=this;this.$el=$(".common-widget-bottom-banner"),this.$el.on("click",function(){e.hasInstalled&&e.config.needOpen?location.href="bdapp://map/":open($(this).attr("data-href"),"_blank")}),window.webapp_cms_bottom_download_img&&(void 0===this.hasInstalled?i.getNativeInfo("com.baidu.BaiduMap",function(t){e.hasInstalled=0===t.error,e.renderAfterLoaded()},function(){e.hasInstalled=!1,e.renderAfterLoaded()}):e.renderAfterLoaded())})}};n.exports=o});