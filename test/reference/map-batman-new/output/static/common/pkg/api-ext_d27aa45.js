define("common:widget/api/ext/basecontrol.js",function(t,e,o){var s=t("common:widget/api/api.js"),i=function(){this.x=10,this.y=10,this.yKeys=[],this.defaultOffset=new s.Size(this.x,this.y),this.ySpace=10};i.prototype=new s.Control,i.prototype.constructor=i,$.extend(i.prototype,{setPosition:function(){var t=0;this.setOffset(new s.Size(this.x,this.y+t))}}),i._className_="BaseControl",o.exports=i});
;define("common:widget/api/ext/circleoverlay.js",function(t,e,i){function o(t,e){this.center=t,this.radius=1*e,this.enableMassClear=!1}var a=t("common:widget/api/api.js");o.prototype=new a.Overlay,o.prototype.initialize=function(t){this._map=t;var e=this._outer=document.createElement("div"),i=e.style;return i.position="absolute",i.border="2px solid #A4B2CC",i.opacity=.6,i.backgroundColor="rgba(70, 115, 204, 0.2)",t.getPanes().mapPane.appendChild(e),e},o.prototype.setInfo=function(t,e){this.center=t||this.point,this.radius=1*(e||this.radius),this.draw()},o.prototype.draw=function(){var t=this._map,e=t.getZoom(),i=Math.pow(2,t.getMapType().getMaxZoom()-e),o=this.radius/i;10>o?this.hide():this.show();var a=t.pointToOverlayPixel(this.center),r=this._outer.style;r.width=r.height=2*o+"px",r.left=a.x-o-2+"px",r.top=a.y-o-2+"px",r.WebkitBorderRadius=o+2+"px",r.borderRadius=o+2+"px"},o._className_="CircleOverlay",i.exports=o});
;define("common:widget/api/ext/custommarker.js",function(t,i,o){function n(t,i,o){this._point=i,this._icon=t,this._div=null,this._container=null,this.drawCount=0,this.draggable=!1,this._config={click:null,isAnimation:!1},this.setConfig(o)}var e=(t("common:static/js/util.js"),t("common:widget/api/api.js"));n.prototype=new e.Overlay,n.prototype.setConfig=function(t){t=t||{};for(var i in t)this._config[i]=t[i]},n.prototype.initialize=function(t){var i=this;i._map=t,i._div=i.getDiv();var o=i._container=$(i._div);return o.on("touchend",function(t){void 0==i._config.notstop&&(window.dtCon0&&dtCon0.isOn||"function"==typeof i._config.click&&i._config.click(),t.stopPropagation())}),o.on("touchstart",function(t){if(t.stopPropagation(),t.preventDefault(),i._ontouch(t),i.draggable){var n=function(t){i._map.disableDragging(),i._ontouch(t)};o.on("touchmove",n),o.on("touchend",function(t){i._map.enableDragging(),i._ontouch(t),o.off("touchmove",n)})}}),o.on("click",function(t){t.stopPropagation()}),t.getPanes().labelPane.appendChild(this._div),i._div},n.prototype._ontouch=function(){var t,i={},o=function(t){for(var i=[],o=null,n=0,e=t.touches.length;e>n;n++)o=t.touches[n],i.push({x:o.pageX,y:o.pageY});return i},n={},e={},a=null,s=[];return function(r){function c(){return a?(setTimeout(c,30),void 0):(p._map.centerAndZoom(p._point,p._map.getZoom()),p.dispatchEvent("dragend"),void 0)}if(!this.draggable)return!1;var p=this;switch(r.preventDefault(),r.stopPropagation(),r.type){case"touchstart":i.start=o(r),n=p._map.pointToOverlayPixel(p._point),p.dispatchEvent("dragstart");break;case"touchmove":i.move=o(r);var h=i.move[0].x-i.start[0].x,g=i.move[0].y-i.start[0].y;e.x=n.x+h,e.y=n.y+g,s.push(e),a||(a=setInterval(function(){var i=s.shift();return i?(t=p._map.overlayPixelToPoint({x:i.x,y:i.y}),p.setPoint(t),p.dispatchEvent("draging"),void 0):(clearInterval(a),a=null,void 0)},25));break;case"touchend":c()}}}(),n.prototype.draw=function(){var t=this;t._draw()},n.prototype._draw=function(){var t=this,i=t._map,o=t._icon.anchor,n=i.pointToOverlayPixel(t._point),e=t._div.style;e.left=n.x-o.width+"px",e.top=n.y-o.height+"px",navigator.userAgent.indexOf("iPhone OS 5_")>-1&&(e.WebkitBackfaceVisibility="hidden"),t._config&&t._config.className&&""!=t._config.className&&t._container.addClass(t._config.className)},n.prototype.setIcon=function(t){var i=this._icon=t;$.extend(this._div.style,{position:"absolute",height:i.size.height+"px",width:i.size.width+"px",backgroundImage:"url("+i.imageUrl+")",backgroundRepeat:"no-repeat",backgroundPosition:0-i.imageOffset.width+"px "+(0-i.imageOffset.height)+"px"}),this.draw()},n.prototype.setClassName=function(t){this._container.removeClass(this._config.className),this._config.className=t,this._container.addClass(this._config.className)},n.prototype.getDiv=function(){var t=this._icon,i=document.createElement("div");return $.extend(i.style,{position:"absolute",height:t.size.height+"px",width:t.size.width+"px",backgroundImage:"url("+t.imageUrl+")",backgroundRepeat:"no-repeat",zIndex:"200",backgroundPosition:0-t.imageOffset.width+"px "+(0-t.imageOffset.height)+"px"}),this._config.isAnimation&&(i.className="mkr_trans"),i},n.prototype.getContainer=function(){return this._div},n.prototype.setPoint=function(t){this._point=t,this.draw()},n.prototype.setDraggingEnabled=function(t){this.draggable=!!t},n.prototype.setZIndex=function(t){this._div.style.zIndex=t},n._className_="CustomMarker",o.exports=n});
;define("common:widget/api/ext/geocontrol.js",function(t,o,e){function n(){i.isIPad()?(this.defaultAnchor=BMAP_ANCHOR_TOP_RIGHT,this.defaultOffset=new s.Size(16,80)):(this.defaultAnchor=BMAP_ANCHOR_BOTTOM_LEFT,this.defaultOffset=new s.Size(8,14))}var i=t("common:static/js/util.js"),a=t("common:widget/url/url.js"),s=t("common:widget/api/api.js"),c=(t("common:widget/api/ext/custommarker.js"),t("common:widget/api/ext/basecontrol.js"),t("common:widget/map/map.js")),r=t("common:widget/geolocation/location.js"),d=t("common:widget/popup/popup.js"),l=t("common:widget/stat/stat.js"),m=function(){this.defaultAnchor=BMAP_ANCHOR_BOTTOM_LEFT,this.defaultOffset=new s.Size(48,14)};m.prototype=new s.Control,$.extend(m.prototype,{initialize:function(t){this._map=t;var o=this._container=document.createElement("div");return o.className="map-geo-info",$(o).html("<b></b><em></em>"),t.getContainer().appendChild(o),this.bind(),o},bind:function(){$(this._container).on("click",function(){l.addCookieStat(COM_STAT_CODE.MAP_GEO_ADDR_CLICK),a.update({module:"index",action:"mylocation",pageState:{vt:""}},{trigger:!0})})},text:function(t){$(this._container).find("b").text(t||"")},hide:function(){c.scaleControl&&c.scaleControl.show(),s.Control.prototype.hide.call(this)}}),n.prototype=new s.Control,n.prototype.initialize=function(t){this._map=t;var o=this._container=document.createElement("div");return o.className="map-geo",this._geoBtn=document.createElement("div"),this._geoBtn.innerHTML='<div class="geo-btn" id="geoState"><b class="index-loc-pic"></b></div>',o.appendChild(this._geoBtn),t.getContainer().appendChild(o),this.bind(),this._geo=!1,this.resetGeoBtn(),i.isIPad()||(this._infoBar=new m,t.addControl(this._infoBar),this._infoBar.hide()),o},n.prototype.bind=function(){this._map;var t=this;t._geoBtn=$(t._geoBtn.children[0]),t._geoBtn.on("click",function(){l.addStat(COM_STAT_CODE.MAP_GEO_ICON_CLICK),t._geo=!0,r.startGeo()}),listener.on("common.geolocation","success",function(){t.resetGeoBtn();var o=a.get();1!=t._geo||i.isIPad()||"index"!=o.module||"index"!=o.action||(t._infoBar.text(r.getAddress()),t._infoBar.show(),c.scaleControl&&c.scaleControl.hide())}),listener.on("common.geolocation","fail",function(){1==t._geo&&(0==t._geo,d.open({text:"无法获取您的精确定位，请开启浏览器定位功能，刷新页面并选择允许定位。"})),t.resetGeoBtn()})},n.prototype.resetGeoBtn=function(){var t=this;r.hasExactPoi()?t._geoBtn.removeClass("geo-fail"):t._geoBtn.addClass("geo-fail")},n.prototype.hideInfoBar=function(){this._infoBar&&this._infoBar.hide()},n._className_="GeoControl",e.exports=n});
;define("common:widget/api/ext/infowindowoverlay.js",function(i,t,n){function e(){this.type=0,this.point=null,this.json={},this.points={},this.cityCode=null,this.index=-1,this.offsetX=0,this.offsetY=0,this.visible=!1}var s=i("common:widget/api/api.js"),o=i("common:widget/pagemgr/pagemgr.js");e.prototype=new s.Overlay,$.extend(e.prototype,{initialize:function(i,t){this._map=i;var n=this.container=this._createContainer(t);this.create(t),i.getPanes().floatPane.appendChild(n),$(n).parent().css({"z-index":800}),this._bindEvent()},_createContainer:function(){return $("<ul />",{"class":"iw-ct"}).get(0)},create:function(){return $(this.container).append($("<li />",{"class":"iw-l",css:{display:""},"data-iw-id":"iw-l"})).append($("<li />",{"class":"iw-c","data-iw-id":"iw-c"})).append($("<li />",{"class":"iw-r",css:{display:""},"data-iw-id":"iw-r"}))},_bindEvent:function(){var i=this,t=$(this.container).find("li"),n=o.isSinglePageApp()?"click":"tap";t.on(n,function(t){i.visible&&listener.trigger("infowindow."+i.type,"click",{id:$(t.target).data("iw-id")||$(t.target).parents("[data-iw-id]").data("iw-id"),data:i.getData(i.type,i.index),instance:i})}),t.on("touchstart",function(t){t.touches&&t.touches.length>1?t.cancelBubble=!0:i.handled=!0})},setData:function(i,t){return this.type=i,t.json&&(this.json[i]=t.json),t.points&&(this.points[i]=t.points),t.cityCode&&(this.cityCode=t.cityCode),this},getData:function(i,t){var n=this.json[i];if(n)return t>-1&&void 0!==n[t]?n[t]:n},hide:function(){$(this.container).hide(),this.visible=!1},show:function(){$(this.container).css({visibility:"hidden"}).show(),this.html().draw(),$(this.container).css({visibility:""}),this.visible=!0;var i=this;this.timer||(this.timer=setTimeout(function(){i.setPosition(),clearTimeout(i.timer),i.timer=null},100))},html:function(i){var t=$(this.container),n=t.find(".iw-c");return n.html(i||this.content),this.width=t.width(),this.height=t.height(),this},draw:function(){var i=$(this.container),t=8,n=this.width/2+(this.offsetX||0),e=this.height+t+(this.offsetY||0);if(this.point){var s=this._map.pointToOverlayPixel(this.point),o=s.x-n,a=s.y-e;i.css({left:o+"px",top:a+"px"})}},setPosition:function(){if(this.point){var i=this._map,t=this.point,n=i.pointToPixel(t),e=new s.Pixel(0,0),o=i.getSize(),a=this.width/2+16,h=this.height/2+78;n.x<a?e.x=a-n.x:o.width-n.x-8<a&&(e.x=o.width-n.x-8-a),n.y<h?e.y=h-n.y:o.height-n.y<60&&(e.y=o.height-n.y-60),i.panBy(e.x,e.y),setTimeout(function(){i.centerAndZoom(i.getCenter(),i.getZoom())},450)}}}),e._className_="InfoWindowOverlay",n.exports=e});
;define("common:widget/api/ext/linestepcontrol.js",function(t,n,e){function i(){this.defaultAnchor=BMAP_ANCHOR_BOTTOM_LEFT,this.isOn=!1}var s=t("common:static/js/util.js"),o=t("common:widget/stat/stat.js"),a=t("common:widget/api/ext/basecontrol.js"),o=t("common:widget/stat/stat.js");i.prototype=new a,$.extend(i.prototype,{initialize:function(t){this._map=t;var n=this._content=document.createElement("div"),e="<b></b>";n.className="line_step";var i=document.createElement("div");i.className="step_pre",i.innerHTML=e,n.appendChild(i);var s=document.createElement("div");return s.className="step_next",s.innerHTML=e,n.appendChild(s),this.container=n,this.preBtn=i,this.nextBtn=s,t.getContainer().appendChild(n),this.bind(),n},bind:function(){var t=this;$(t.preBtn).on("touchend",function(){t.goPreStop()}),$(t.nextBtn).on("touchend",function(){t.goNextStop()})},setIWCon:function(t){this.iwCon=t},goPreStop:function(){this.iwCon&&this.iwCon.pre()&&o.addStat(COM_STAT_CODE.MAP_LINE_STEP_PRE)},goNextStop:function(){this.iwCon&&this.iwCon.next()&&o.addStat(COM_STAT_CODE.MAP_LINE_STEP_NEXT)},draw:function(){this.container.style.margin=""},ableBtn:function(t){if("string"==typeof t&&("pre"===t||"next"===t)){var n="pre"==t?this.preBtn:this.nextBtn;this._able(n)}},disableBtn:function(t){if("string"==typeof t&&("pre"===t||"next"===t)){var n="pre"==t?this.preBtn:this.nextBtn;this._disable(n)}},_able:function(t){t&&($(t).hasClass("able")||$(t).removeClass("disable"))},_disable:function(t){t&&($(t).hasClass("disable")||$(t).addClass("disable"))},setPos:function(){var t=parseInt((s.getClientSize().width-this.width)/2,10);this.x=t,this.setPosition()},hide:function(){this.isOn=!1,a.prototype.hide.call(this)},show:function(){this.isOn=!0,a.prototype.show.call(this)}}),i._className_="LineStepControl",e.exports=i});
;define("common:widget/api/ext/menucontrol.js",function(t,e,n){var i=t("common:static/js/util.js"),a=t("common:widget/url/url.js"),o=t("common:widget/api/api.js"),s=t("common:widget/cookie/cookie.js"),c=t("common:widget/login/login.js"),d=t("common:widget/api/ext/basecontrol.js"),r=t("common:widget/pagemgr/pagemgr.js"),u=t("common:widget/stat/stat.js"),m=function(t){this.defaultAnchor=BMAP_ANCHOR_BOTTOM_RIGHT;var e=new o.Size(53,38);i.isIPad()&&(e=new o.Size(16,62)),this.defaultOffset=e,this.menuBtn=t,this.isOn=!1};m.prototype=new d,$.extend(m.prototype,{initialize:function(t){this._map=t;var e=this._container=document.createElement("div");e.id="menu-drop-container",e.style.position="absolute",e.className="menu-ctrl-drop";var n=document.createElement("ul");n.className="menu-list-con",e.appendChild(n),$(n).html('<li id="menu-city" data-tab="1">切换城市</li><li id="menu-pano" data-tab="2">全景</li><li id="menu-info-center" data-tab="3">个人中心(<span>未登录</span>)</li><li id="menu-feedback" data-tab="4">意见反馈</li><li id="menu-download" data-tab="5" style="color:#00c;" data="">下载手机客户端</li>'),t.getContainer().appendChild(e),this.bind(),this.setCmsConfig();var i=function(){var t=a.get();"index"!==t.module||"index"!==t.action?$("#menu-city, #menu-pano, #menu-info-center").hide():$("#menu-city, #menu-pano, #menu-info-center").show()};return listener.on("common.page","switchend",i),i("init",a.get()),e},setCmsConfig:function(){$appbutton=$("#menu-download"),i.isInstalledClient(function(t){$appbutton.attr("data",t).text("打开客户端")},function(t){$appbutton.attr("data",t).text("下载手机客户端")})},bind:function(){this._map;var t=this,e=r.isSinglePageApp()?"click":"touchstart";$(this._container).on(e,function(n){"touchstart"===e&&(n.preventDefault(),n.stopPropagation()),t.onClick(n,this)}),$(this._container).find("li").on("touchstart",function(){$(this).css("background","#eee")}),$(this._container).find("li").on("touchend",function(){$(this).css("background","none")})},onClick:function(t,e){var n=a.get(),o=$(t.target).data("tab");switch(o){case 1:u.addCookieStat(COM_STAT_CODE.MAP_MENU_CHANGE_CITY_CLICK),a.update({module:"index",action:"setmylocation",query:n.query,pageState:{}},{trigger:!0,queryReplace:!0,pageStateReplace:!0});break;case 2:u.addCookieStat(COM_STAT_CODE.MAP_MENU_SVENTRY_CLICK),a.update({module:"index",action:"sventry"},{trigger:!0,pageStateReplace:!0,queryReplace:!0});break;case 3:c.checkLogin(function(t){t.status?(u.addCookieStat(COM_STAT_CODE.MAP_MENU_USER_CENTER_CLICK),c.goMycenter()):(u.addStat(COM_STAT_CODE.MAP_MENU_USER_CENTER_CLICK),c.loginAction())});break;case 4:if(u.addCookieStat(COM_STAT_CODE.MAP_MENU_FEEDBACK_CLICK),"feedback"==n.module)return;var s=n.module+"/"+n.action,d=[n.module,n.action,i.jsonToUrl(n.query),i.jsonToUrl(n.pageState)].join("/"),n={module:"feedback",action:"show",query:{page_id:encodeURIComponent(s),hash:encodeURIComponent(d)}};a.update(n,{trigger:!0,pageStateReplace:!0,queryReplace:!0});break;case 5:u.addStat(COM_STAT_CODE.MAP_MENU_BDAPP_CLICK),setTimeout(function(){window.location.href=$(t.target).attr("data")},200)}this.menuBtn.hideMenuDrop()}});var l=function(){this.defaultAnchor=BMAP_ANCHOR_BOTTOM_RIGHT;var t=new o.Size(8,16);i.isIPad()&&(t=new o.Size(16,62)),this.defaultOffset=t,this.isOn=!1};l.prototype=new d,$.extend(l.prototype,{initialize:function(t){this._map=t;var e=this._container=document.createElement("div");e.id="menu-btn-container",e.style.position="absolute",e.className="menu-ctrl-btn";var n=document.createElement("div");return n.className="menu-ctrl-icon",e.appendChild(n),t.getContainer().appendChild(e),this.bind(),e},bind:function(){var t=this._map,e=this;this._container.onclick=$.proxy(function(){u.addStat(COM_STAT_CODE.MAP_MENU_ICON_CLICK),this._menuDrop||(this._menuDrop=new m(e),t.addControl(this._menuDrop)),this._menuDrop[this.isOn?"hide":"show"](),this.isOn=!this.isOn;var n=$("#menu-info-center span");s.get("myUserName")?n.text("已登录"):c.checkLogin(function(t){t.status?n.text("已登录"):n.text("未登录")})},this)},hideMenuDrop:function(){this.isOn=!1,this._menuDrop&&this._menuDrop.hide()}}),l._className_="MenuControl",n.exports=l});
;define("common:widget/api/ext/poiinfowindow.js",function(t,e,o){function a(){this.uid=Date.now()}var i=t("common:static/js/mapconst.js"),n=t("common:widget/url/url.js"),c=t("common:static/js/util.js"),s=t("common:widget/geolocation/location.js"),r=t("common:widget/api/ext/infowindowoverlay.js"),d=t("common:widget/stat/stat.js");a.prototype=new r,$.extend(a.prototype,{index:0,offsetX:-1,offsetY:36,switchTo:function(t){this.index=t||0,this.point=this._getPoint(),this.content=this._getContent(),this.show()},getPoiData:function(){this.index;var t=this.getData(this.type,this.index);if(t)return t},_getPoint:function(){var t=this.getPoiData();if(t)return c.geoToPoint(t.geo)},_getContent:function(){var t=this.getPoiData();if(t){var e=t.name.replace("\\","");t.poiType==i.POI_TYPE_BUSSTOP?e+="-公交车站":t.poiType==i.POI_TYPE_SUBSTOP&&(e+="-地铁站");var o=$("<div />",{"class":"iw-c-title "+(t.pano&&1==t.pano?"iw-c-title-pano":""),text:e,html:t.html,"data-name":t.name,"data-uid":t.uid,"data-geo":t.geo});return o}},nbSearch:function(t,e){if(t&&e){var o=c.geoToPoint(e),a={nb_x:o&&o.lng,nb_y:o&&o.lat,center_name:t||"",from:"searchnearby"};d.addCookieStat(COM_STAT_CODE.MAP_IW_NB_SEARCH),n.update({module:"index",action:"searchnearby",query:{foo:"bar"},pageState:a},{trigger:!0,pageStateReplace:!0,queryReplace:!0})}},lineSearch:function(t,e){if(t&&e){var o=c.geoToPoint(e),a={word:t,point:(o&&o.lng)+","+(o&&o.lat),citycode:this.cityCode||s.getCityCode()},i={end:c.jsonToQuery(a),from:"place"};d.addCookieStat(COM_STAT_CODE.MAP_IW_LINE_SEARCH),n.update({module:"place",action:"linesearch",query:{foo:"bar"},pageState:i},{trigger:!0,queryReplace:!0,pageStateReplace:!0})}},detailSearch:function(t){d.addCookieStat(COM_STAT_CODE.MAP_IW_DETAIL_SEARCH),t?n.update({module:"place",action:"detail",query:{qt:"inf",uid:t},pageState:{vt:""}},{trigger:!0,queryReplace:!0,pageStateReplace:!0}):n.update({module:"place",action:"detail",query:{foo:"bar"},pageState:{vt:"",i:this.index}},{trigger:!0,queryReplace:!1,pageStateReplace:!0})}}),o.exports={_className_:"PoiInfoWindow",_instances:{},_constructor:a,init:function(t){var e;if(!this._instances[t])switch(e=this._instances[t]=new this._constructor,t){case i.IW_GRT:e.offsetX=2,e.offsetY=32;break;case i.IW_VCT:e.offsetX=0,e.offsetY=7;break;case i.IW_CNT:e.offsetX=1,e.offsetY=15}return e}}});
;define("common:widget/api/ext/tfcinfowindow.js",function(t,i,e){function n(){}var s=(t("common:static/js/mapconst.js"),t("common:static/js/util.js")),o=t("common:widget/api/ext/infowindowoverlay.js");n.prototype=new o,$.extend(n.prototype,{index:0,offsetX:0,offsetY:26,create:function(){return $(this.container).append($("<li />",{"class":"iw-c",css:{width:"254px"},"data-iw-id":"iw-c"}))},switchTo:function(t){this.index=t||0,this.point=this._getPoint(),this.content=this._getContent(),this.show()},_getPoiData:function(){this.index;var t=this.getData(this.type,this.index);if(t)return t},_getPoint:function(){var t=this._getPoiData();if(t)return s.geoToPoint(t.geo)},_getContent:function(){var t=this._getPoiData();if(t){var i,e;if(t.starttime){var n=new Date;n.setTime(1e3*parseInt(t.starttime)),i="开始时间："+n.format("yyyy-MM-dd hh:mm")}if(t.endtime){var s=new Date;s.setTime(1e3*parseInt(t.endtime)),e="预计结束时间："+s.format("yyyy-MM-dd hh:mm")}var o="详情："+t.des,a=$("<div />",{id:"iw_c_"+this.type,html:"<div class='iw-c-title'>{0}</div><div class='iw-c-list'><p>{1}</p><p>{2}</p><p>{3}</p></div>".format(t.title,i,e,o),"class":"iw-c-c"});return a}}}),e.exports={_className_:"TfcInfoWindow",_instances:{},_constructor:n,init:function(t){var i;return this._instances[t]||(i=this._instances[t]=new this._constructor),i}}});
;define("common:widget/api/ext/trafficcontrol.js",function(t,e,i){var n=t("common:static/js/util.js"),a=t("common:widget/popup/popup.js"),s=t("common:widget/url/url.js"),o=t("common:static/js/mapconst.js"),r=t("common:widget/api/api.js"),c=t("common:widget/api/ext/custommarker.js"),f=t("common:widget/api/ext/basecontrol.js"),d=(t("common:widget/geolocation/location.js"),t("common:widget/stat/stat.js")),h=function(){this.defaultAnchor=BMAP_ANCHOR_BOTTOM_RIGHT,n.isIPad()?(this.defaultAnchor=BMAP_ANCHOR_TOP_RIGHT,this.defaultOffset=new r.Size(16,16)):this.defaultOffset=new r.Size(8,160),this.isOn=!1,this.trafficLayer=null,this.PAGE_ID="traffic_map"};h.prototype=new f,$.extend(h.prototype,{initialize:function(e){this._map=e;var i=document.createElement("div");i.className="tf_btn tf_close",i.innerHTML='<div class="btn_bg">                            <span class="tf_icon"></span>                        </div>',e.getContainer().appendChild(i),this._node=$(i);var n=this;this._node.on("click",function(t){n.toggleTraffic.call(n,t),this.blur()}),n.resetStatus(),e.addEventListener("zoomend",function(){n.resetStatus()}),e.addEventListener("gestureend",function(){setTimeout(function(){n.resetStatus()},80)}),e.addEventListener("load",function(){n.resetStatus()}),e.addEventListener("touchend",function(){e.lastLevel!=e.zoomLevel&&n.isOn}),e.addEventListener("dragend",function(){if(n.isOn){var t=function(){clearTimeout(n.eventTimeout),n.eventTimeout=null};setTimeout(function(){t(),setTimeout(function(){t()},200)},500)}});var a=s.get(),o=a.pageState;return t("common:widget/map/map.js"),listener.on("common.map","addlazycontrol",function(){o&&"on"===o.traffic&&n.turnOnTraffic()}),i},toggleTraffic:function(){this.isOn?this.turnOffTraffic():this.turnOnTraffic()},turnOnTraffic:function(){this.isOn||d.addStat(COM_STAT_CODE.MAP_TRAFFIC_ICON_ON),this._node.removeClass("tf_close"),this._node.addClass("tf_on"),this._addTrafficLayer(),n.need2ShowTraffic()||"third"===window._APP_HASH.module&&"traffic"===window._APP_HASH.action?this.isOn||d.addStat(COM_STAT_CODE.MAP_TRAFFIC_ON_PV):(this._showTips(),this.hide()),this.isOn=!0,this.initTrafficEvents(),s.update({pageState:{traffic:"on"}},{replace:!0,trigger:!1})},turnOffTraffic:function(){this.isOn&&d.addStat(COM_STAT_CODE.MAP_TRAFFIC_ICON_OFF),this._node.removeClass("tf_on"),this._node.addClass("tf_close"),n.need2ShowTraffic()&&0!=this.isOn&&d.addStat(COM_STAT_CODE.MAP_TRAFFIC_OFF_PV),s.update({pageState:{traffic:"off"}},{replace:!0,trigger:!1}),this._removeTrafficLayer(),this.isOn=!1},initTrafficEvents:function(){var t=this._map.getZoom();9>=t||!this.isOn?this.removeTrafficEvents():!this.eventTimeout&&this.isOn&&this._getTrafficEvents($.proxy(this._onTrafficEventsHandler,this))},_onTrafficEventsHandler:function(t){-1!=t.result&&this.addTrafficEvents(t.content||[]),this.eventTimeout||(this.eventTimeout=setTimeout($.proxy(function(){this._getTrafficEvents($.proxy(this._onTrafficEventsHandler,this))},this),3e5))},_getCityByBounds:function(t){var e=document.getElementsByTagName("HEAD")[0],i=this._map.getBounds(),a=this._map.getZoom(),s={newmap:1,qt:"cen",b:i._neLng+","+i._neLat+";"+i._swLng+","+i._swLat,l:a},r=o.CITY_BY_BOUNDS_URI+"?"+n.jsonToQuery(s),c=document.createElement("script");c.type="text/javascript",c.src=r,e.appendChild(c),c.onload=function(){t&&t(_mapCenter||{}),e.removeChild(c),c.onload=null}},_getTrafficEvents:function(t){var e=document.getElementsByTagName("HEAD")[0],i=this;window.Instance=function(){return this.trafficDataModel={},this.trafficDataModel.setData=function(t){this.data=t},trafficDataModel};var a={qt:"traeve_data",call_back:"HANDER_TRAFFIC_DATA"};this._getCityByBounds(function(s){var r=s.current_city?s.current_city.code:location.getCityCode(),c=[];if(i.lastCityCode===r)return t&&t(trafficDataModel.data),void 0;i.lastCityCode=r,i.removeTrafficEvents(),c.push($.extend({time:Date.now(),t:Date.now(),city_code:r},a));try{}catch(f){console.log(f.message)}c.forEach(function(i){var a=o.TRAFIIC_URI+"?"+n.jsonToQuery(i),s=document.createElement("script");s.type="text/javascript",s.src=a,e.appendChild(s),s.onload=function(){t&&t(trafficDataModel.data),e.removeChild(s),s.onload=null}})})},getIconByType:function(t){var e="/mobile/simple/static/common/images/trf_evt_04682c9.png",i=0;switch(t){case"1":i=110;break;case"2":i=83;break;case"3":i=0;break;case"5":i=51;break;case"6":i=24;break;case"8":i=134;break;default:i="0"}var n=new r.Icon(e,new r.Size(28,28),{anchor:new r.Size(14,28),imageOffset:new r.Size(-1,i)});return n},addTrafficEvents:function(t){var e=this;e.eventMarkers=e.eventMarkers||[];var i=function(t){e.dispatchEvent("click",{data:t})};t.forEach(function(t){var n=t.geo.split(","),a=n[0].indexOf("|")?n[0].split("|")[1]:n[0],s=new r.Point(a,n[1]);t.point=s;var o=new c(e.getIconByType(t.type),s,{className:"events_mrk",click:function(t){return function(){i.call(this,t)}}(t)});e._map.addOverlay(o),e.eventMarkers.push(o)})},removeTrafficEvents:function(){this.eventMarkers=this.eventMarkers||[],this.eventMarkers.forEach($.proxy(function(t){this._map.removeOverlay(t)},this)),this.eventMarkers.length=0,clearTimeout(this.eventTimeout),this.eventTimeout=null,this.dispatchEvent("remove")},_addTrafficLayer:function(){this._map.setTrafficOn()},_removeTrafficLayer:function(){this._map.setTrafficOff(),this.removeTrafficEvents()},_showTips:function(){var t=this._map,e=t.getZoom(),i=s.get().pageState.vt,n=window._APP_HASH;e>9&&("map"==i||/map/i.test(n.page))&&(d.addStat(COM_STAT_CODE.MAP_TRAFFIC_TIPS),a.open({text:"当前城市暂无实时路况数据"}))},resetStatus:function(){this._ifShow()?this.show():this.hide()},_ifShow:function(){return this._map.getZoom()>5&&n.need2ShowTraffic()?!0:!1},hide:function(){$(".tf_btn").hide()},show:function(){$(".tf_btn").show()},update:function(){var t=s.get().pageState;n.need2ShowTraffic()?(this.show(),t&&"on"===t.traffic&&this._getTrafficEvents($.proxy(this._onTrafficEventsHandler,this))):(t&&"on"===t.traffic&&this._showTips(),this.hide())}}),h._className_="TrafficControl",i.exports=h});
;define("common:widget/api/ext/trsinfowindow.js",function(t,i,n){function e(){}var s=t("common:static/js/mapconst.js"),o=t("common:static/js/util.js"),c=t("common:widget/api/ext/infowindowoverlay.js");e.prototype=new c,$.extend(e.prototype,{index:0,offsetX:0,offsetY:5,create:function(){return $(this.container).append($("<li />",{"class":"iw-c","data-iw-id":"iw-c"})).css({width:"228px",height:"auto","min-height":"64px"})},switchTo:function(t){this.index=t||0,this.point=this._getPoint(),this.content=this._getContent(),this.show()},_getPoiData:function(){this.index;var t=this.getData(this.type,this.index);if(t)return t},_getPoint:function(){var t=(this.index,this._getPoints(this.type,this.index));return o.getPointByStr(t.p)},_getPoints:function(t,i){var n=this.points[t];if(n)return i>-1&&void 0!==n[i]?n[i]:n},_getContent:function(){var t=this._getPoiData();if(t){var i=$("<div />",{id:"iw_c_"+this.type,text:t.content,html:t.content,"class":"iw-c-c","data-content":t.content});return i}}}),n.exports={_className_:"TrsInfoWindow",_instances:{},_constructor:e,init:function(t){var i;if(!this._instances[t])switch(i=this._instances[t]=new this._constructor,t){case s.IW_NAV:i.offsetX=0,i.offsetY=8}return i}}});
;define("common:widget/api/ext/userheading.js",function(t,i,n){function e(){this._timeStamp=0,this._doms=[],this._alpha=0,this._orientation=window.orientation}e.prototype.start=function(t){var i=this;i._doms.push(t),i._started||(i._started=!0,window.addEventListener("deviceorientation",function(t){var n;if(n=t.webkitCompassHeading?Math.round(0-t.webkitCompassHeading):Math.round(t.alpha),n-=i._orientation,!(t.timeStamp-i._timeStamp<100)){i._timeStamp=t.timeStamp;var e=Math.abs(i._alpha-n);if(e>5){for(var o=0;o<i._doms.length;o++)i._doms[o]&&i._doms[o].style&&(i._doms[o].style.transform=i._doms[o].style.webkitTransform="rotate("+Math.round(0-n)+"deg)");i._alpha=n}}},!0),window.addEventListener("orientationchange",function(){i._orientation=window.orientation},!0))},e.prototype.isSupport=function(){var t=navigator.userAgent;return t.indexOf("Android")>-1||!window.DeviceOrientationEvent?!1:!0},e.prototype._className_="UserHeading",n.exports=new e});
;define("common:widget/api/ext/zoomcontrol.js",function(o,t,n){var e=o("common:static/js/util.js"),i=o("common:widget/api/ext/basecontrol.js"),a=o("common:widget/stat/stat.js"),s=function(){this.defaultAnchor=BMAP_ANCHOR_BOTTOM_RIGHT;var o=new BMap.Size(8,70);e.isIPad()&&(o=new BMap.Size(16,62)),this.defaultOffset=o,this.isOn=!1};s.prototype=new i,$.extend(s.prototype,{initialize:function(o){this._map=o;var t=this._container=document.createElement("div");t.id="zoom-btn-container",t.style.position="absolute";var n=this._zoomIn=document.createElement("div");n.className="zoom_btn blue_off zoom_btn_in";var e=document.createElement("div");e.className="zin",n.appendChild(e);var i=this._zoomOut=document.createElement("div");i.className="zoom_btn blue_off zoom_btn_out";var a=document.createElement("div");return a.className="zout",i.appendChild(a),t.appendChild(n),t.appendChild(i),o.getContainer().appendChild(t),this.bind(),t},bind:function(){function o(){setTimeout(function(){18==t.getZoom()?$(n._zoomIn).addClass("blue_disable"):$(n._zoomIn).removeClass("blue_disable"),3==t.getZoom()?$(n._zoomOut).addClass("blue_disable"):$(n._zoomOut).removeClass("blue_disable")},60)}var t=this._map,n=this;n._zoomIn.onclick=function(){a.addStat(COM_STAT_CODE.MAP_ZOOMIN_ICON_CLICK),n.isOn=!0,t.zoomIn(),this.blur()},n._zoomOut.onclick=function(){a.addStat(COM_STAT_CODE.MAP_ZOOMOUT_ICON_CLICK),n.isOn=!0,t.zoomOut(),this.blur()},n._zoomIn.ontouchstart=function(){$(n._zoomIn).addClass("zoom_btn_on")},n._zoomIn.ontouchend=function(){$(n._zoomIn).removeClass("zoom_btn_on")},n._zoomOut.ontouchstart=function(){$(n._zoomOut).addClass("zoom_btn_on")},n._zoomOut.ontouchend=function(){$(n._zoomOut).removeClass("zoom_btn_on")},t.addEventListener("zoomend",o),t.addEventListener("gestureend",o),t.addEventListener("load",o)},clear:function(){me.isOn=!1}}),s._className_="ZoomControl",n.exports=s});