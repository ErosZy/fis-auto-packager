define("taxi:widget/verify/verify.js",function(e,t,i){"use strict";var n=e("taxi:static/js/storage.js"),o=e("taxi:widget/common/popup/popup.js"),a=e("common:widget/stat/stat.js"),s=e("taxi:widget/common/taxirequester/taxirequester.js"),t={create:function(){var e=this.$el=$(".taxi-widget-verify"),t=this.$inputPhone=e.find(".input-phone"),i=this.$inputCode=e.find(".input-code"),n=this.$btnGetCode=e.find(".btn-get-code"),o=this.$btnVerifyPhone=e.find(".btn-verify-phone"),a=this.options;n.on("click",$.proxy(this.onBtnGetCodeClick,this)),o.on("click",$.proxy(this.onBtnVerifyPhoneClick,this)),t.on("keyup",$.proxy(this.onInputPhoneKeyup,this)),i.on("keyup",$.proxy(this.onInputCodeKeyup,this)),t.val(a.phone||""),Taxi.validatePhone(t.val())&&n.removeAttr("disabled"),this.$btnGetCode=n,this.$inputPhone=t},onBtnGetCodeClick:function(){var e,t=this,i=this.$btnGetCode,n=this.$inputPhone,a=60,s=i.text(),r=this.$inputPhone.val(),d=function(){i.text(a+"秒"),a--};i.attr("disabled","disabled"),n.attr("disabled","disabled"),LoadManager.request({data:{qt:"sendcode",phone:r},success:function(){LoadManager.setPageOptions("phone",r),d(),e=t.interval=setInterval(function(){0===a?(i.removeAttr("disabled"),n.removeAttr("disabled"),i.text(s),clearInterval(e),e=-1):d()},1e3)},error:function(e){var a="";switch(e.errno){case-201:a="请求太频繁，请60秒后重试！";break;case-101:a="参数错误！";break;default:a="系统错误！"}o.open({text:a,layer:!0,onClose:function(){i.removeAttr("disabled"),n.removeAttr("disabled"),i.text(s),clearInterval(t.interval),t.interval=-1}})}})},onBtnVerifyPhoneClick:function(){var e=this.$inputPhone.val(),t=this.$btnVerifyPhone,i=this.options,r=i.referrer;t.attr("disabled","disabled"),o.open({text:"正在验证手机号...",layer:!0,autoCloseTime:0}),LoadManager.request({data:{qt:"verifycode",phone:e,code:this.$inputCode.val()},success:function(d){if(o.close(),1===d.info.is_pass)switch(n.set("phone",e),delete i.referrer,r){case"home":s.request($.extend({},i,{qt:"userreq",phone:e}));break;case"settings":LoadManager.loadPage("home");break;default:LoadManager.loadPage("home")}else o.open({text:"验证码错误！",layer:!0});t.removeAttr("disabled"),a.addStat(STAT_CODE.TAXI_VERIFYCODE)},error:function(){o.close(),t.removeAttr("disabled")}})},onInputPhoneKeyup:function(){Taxi.validatePhone(this.$inputPhone.val())?this.$btnGetCode.removeAttr("disabled"):this.$btnGetCode.attr("disabled","disabled")},onInputCodeKeyup:function(){Taxi.validatePhone(this.$inputPhone.val())&&Taxi.validateCode(this.$inputCode.val())?this.$btnVerifyPhone.removeAttr("disabled"):this.$btnVerifyPhone.attr("disabled","disabled")},destroy:function(){clearInterval(this.interval),this.interval=-1},init:function(){this.options=LoadManager.getPageOptions(),this.create()}};i.exports=t});