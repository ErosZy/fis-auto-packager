define("common:widget/geolocation/nativegeolocation.js",function(i,t,o){"use strict";var e=i("common:widget/stat/metrics-stat.js"),a="http://127.0.0.1:6259/",c={lochost:"http://map.baidu.com",apnUrl:a+"getapn?callback=getApnCallback",apinfoUrl:a+"getlocstring?timeout=0&callback=getapinfo",locSdkUrl:a+"geolocation?timeout=12000&callback=getGeoByNative",init:function(i){this._isApnTimeout=!1,this._isNativeAvailable=!1,this._isNativeTimeout=!1,this._isLocsdkTimeout=!1,this._isApinfoTimeout=!1,this._isGeoSuc=!1,this._isApinfoSuc=!1,this._isLocsdkSuc=!1,this._isLocsdkFail=!0,this._isApinfoFail=!0,this.outofdate=!1,this._data=i||{},this.checkApn()},checkApn:function(){var i=this;$.ajax({url:i.apnUrl,dataType:"jsonp",success:function(t){i._isApnTimeout===!1&&t&&0===t.error&&(i._isNativeAvailable=!0,i.nativeGeo&&i.nativeGeo())}}),i.checkApnTimeout(2)},checkApnTimeout:function(i){var t=this;setTimeout(function(){t._isNativeAvailable===!1&&(t._isApnTimeout=!0,listener.trigger("common.geomethod","fail",{}))},1e3*i)},nativeGeo:function(){this.geobyApinfo(),this.geobyLocsdk(),e.addStat("geo","native_geo_all",1,!0)},nativeGeofailed:function(i){var t=this;"locsdk"==i?t._isLocsdkFail=!0:"apinfo"==i&&(t._isApinfoFail=!0),t._isLocsdkFail&&t._isApinfoFail&&!t.outofdate&&(t.outofdate=!0,listener.trigger("common.geomethod","fail",{}),e.addStat("geo","native_geo_fail",1,!0))},geobyApinfo:function(){var i=this;$.ajax({url:i.apinfoUrl,dataType:"jsonp",success:function(t){0===t.error&&i._isApinfoTimeout===!1?i.getLocation(t):(e.addStat("geo","native_geo_apinfo_fail",{id:t.error},!0),i.nativeGeofailed("apinfo")),e.addStat("geo","native_get_geo_suc",{id:"apinfo"},!0)}}),i.checkApinfoTimeout(12)},geobyLocsdk:function(){var i=this;$.ajax({url:locSdkUrl,dataType:"jsonp",success:function(t){0===t.error&&i._isLocsdkTimeout===!1?i.getDetailLoc(t):i.nativeGeofailed("locsdk"),e.addStat("geo","native_get_geo_suc",{id:"locsdk"},!0)}}),i.checkLocsdkTimeout(12)},checkLocsdkTimeout:function(i){var t=this;setTimeout(function(){t._isLocsdkSuc!==!1&&t._isGeoSuc||(t._isLocsdkTimeout=!0,t.nativeGeofailed("locsdk"))},1e3*i)},checkApinfoTimeout:function(i){var t=this;setTimeout(function(){t._isApinfoSuc!==!1&&t._isGeoSuc||(t._isApinfoTimeout=!0,t.nativeGeofailed("apinfo"))},1e3*i)},getLocbyUrl:function(i){var t=this,o=t._data.id;$.ajax({url:i,dataType:"jsonp",success:function(i){var a,c=i&&i.content,s=c&&c.address_detail,n=c&&c.point;if(!t.outofdate){if(0!=i.error||""==c.address)return"apinfo"==i.reqtype||"locsdk"==i.reqtype?t.nativeGeofailed(i.reqtype):(t.outofdate=!0,listener.trigger("common.geomethod","fail",{})),void 0;0==i.error&&"apinfo"==i.reqtype&&e.addStat("geo","url_geo_apinfo_suc_back",1,!0),t._isGeoSuc||(t._isGeoSuc=!0,a={addr:{address:c.address||null,city:s.city||null,cityCode:s.city_code||1,district:s.district||null,street:s.street||null,accuracy:s.accuracy},point:{x:n.x||null,y:n.y||null},isGeoSuc:!0,isExactPoi:!0,type:"native",isUserDeny:!1,isSaveLocInCookie:!0},listener.trigger("common.geomethod","success",a),e.addStat("geo","native_geo_getinfo_suc",{type:i.reqtype,id:o},!0))}}})},getLocation:function(i){var t=this,o=i.locstring.split("&"),e=o[0]+"|"+o[1],a=t.lochost+"/mobile/?qt=geo&apinfo="+e+"&type=apinfo&callback=";t._isApinfoSuc=!0,t.getLocbyUrl(a)},getDetailLoc:function(i){var t=this,o=t.getRgcUrl(i);t._isLocsdkSuc=!0,t.getLocbyUrl(o)},getRgcUrl:function(i){var t,o=i.coords.longitude,e=i.coords.latitude,a=i.coords.accuracy,c=this;return t=o&&e?c.lochost+"/mobile/?qt=geo&x="+o+"&y="+e+"&radius="+a+"&type=locsdk&callback=":""}};o.exports=c});