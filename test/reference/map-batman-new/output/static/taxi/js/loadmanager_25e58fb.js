!function(e,t,a){"use strict";var i=require("taxi:widget/common/popup/popup.js"),r=require("common:static/js/util.js"),s=require("taxi:static/js/storage.js"),o={pageControllerMap:{home:require("taxi:widget/home/home.js"),waiting:require("taxi:widget/waiting/waiting.js"),resubmit:require("taxi:widget/resubmit/resubmit.js"),response:require("taxi:widget/response/response.js"),verify:require("taxi:widget/verify/verify.js"),settings:require("taxi:widget/settings/settings.js"),about:require("taxi:widget/about/about.js"),channel:require("taxi:widget/channel/channel.js"),"vip/home":require("taxi:widget/vip/home/home.js"),"vip/verify":require("taxi:widget/vip/verify/verify.js"),"vip/orderlist":require("taxi:widget/vip/orderlist/orderlist.js"),"vip/finish":require("taxi:widget/vip/finish/finish.js")},getPageOptions:function(e){var t=r.urlToJSON(s.get("pageOptions"));return e?t[e]:t},setPageOptions:function(e,t){var a;"string"==typeof e?(a=this.getPageOptions(),a[e]=t,this.setPageOptions(a)):"object"==typeof e&&s.set("pageOptions",r.jsonToQuery(e))},request:function(e){$.ajax({type:"POST",dataType:"json",url:"/mobile/webapp/taxi/api/"+r.jsonToQuery($.extend({},e.data,{api:2,os:"webapp"})),success:function(t){t&&0===t.errno?e.success&&$.isFunction(e.success)&&e.success(t):e.error&&$.isFunction(e.error)&&(t?e.error(t):i.open({text:"网络数据异常！"}))},error:function(t){$.isFunction(e.error)&&t&&t.errno>0&&e.error()},complete:e.complete})},loadPage:function(e,a,o){var n,g,u,p=this,c=$("#wrapper");e=e||p.getPageState("lastPage")||"home",a&&("object"==typeof a&&(a=r.jsonToQuery(a)),s.set("pageOptions",a)),n="taxi-pagelet-"+this.slash2dash(e),t.asyncLoad({id:n},a,function(){i.close(),$("<div/>").attr({id:n}).appendTo(c.html("")),p.getPageState("lastPage")!==e&&(g=p.getPageState("lastPage"),u=p.pageControllerMap[g],u&&u.destroy&&$.isFunction(u.destroy)&&u.destroy(),o&&o.privacy||p.setPageState("lastPage",e))})},routeVip:function(){var e;(e=r.urlToJSON(location.search.split("?")[1]).id)?this.loadPage("vip/finish",{order_id:e},{privacy:!0}):s.get("thirdPhone")?this.loadPage(this.getPageState("lastPage")||"vip/home"):this.loadPage("vip/verify")},routeIndex:function(){var e,t,a=this;(t=r.urlToJSON(location.search.split("?")[1]).channel)?this.loadPage("channel",null,{privacy:!0}):(e=s.get("orderId"))?this.request({data:{qt:"orderstatus",order_id:e},success:function(e){var t=e.info&&e.info.status;switch(t){case-1:a.loadPage("resubmit");break;case 2:a.loadPage("response");break;case 1:a.loadPage("waiting");break;case 3:case-2:case 3:case 4:s.remove("pageState"),a.loadPage("home");break;default:s.remove("pageState"),a.loadPage("home")}a.setPageState("status",t),a.setPageState("existTime",e.info.exist_time)},error:function(){s.remove("pageState"),a.loadPage("home")}}):this.loadPage(this.getPageState("lastPage"))},route:function(){switch(window._APP_HASH.page){case"vip":this.routeVip();break;default:this.routeIndex()}},getPageState:function(e){var t=r.urlToJSON(s.get("pageState"));return t&&t[e]},setPageState:function(e,t){var a=r.urlToJSON(s.get("pageState"));a[e]=t,s.set("pageState",r.jsonToQuery(a))},removePageState:function(e){this.setPageState(e,a)},slash2dash:function(e){return e.replace("/","-")},init:function(){return 0!==s.set("baiduTaxiLocalStorageTest",1)?(i.open({text:"检测到您的浏览器不支持缓存，您可能开启了无痕浏览模式，将无法使用本产品功能，请关闭后再试。",layer:!0,autoCloseTime:0}),!1):(i.open({text:"正在加载...",layer:!0,autoCloseTime:0}),s.remove("baiduTaxiLocalStorageTest"),this.route(),void 0)}};e.LoadManager=o}(window,TaxiBigPipe);