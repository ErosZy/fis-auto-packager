define("taxi:widget/vip/orderlist/orderlist.js",function(require,exports,module){require("taxi:static/js/template.js");var listItemTemplate=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="captain">代叫车订单：<span class="count">',"undefined"==typeof info.length?"":baidu.template._encodeHTML(info.length),'</span></div><ul class="list">    ');for(var i=0,len=info.length;len>i;i++){if(_template_fun_array.push('        <li class="list-item">            '),info[i].status>1){_template_fun_array.push('                <div class="driver-info">                    <span class="name">',"undefined"==typeof info[i].driver_name?"":baidu.template._encodeHTML(info[i].driver_name),'</span>                    <span class="carno">',"undefined"==typeof info[i].taxi_no?"":baidu.template._encodeHTML(info[i].taxi_no),'</span>                    <div class="reply-time">                        ');var date=new Date(1e3*info[i].reply_time),month=date.getMonth()+1,day=date.getDate(),hours=date.getHours(),minutes=date.getMinutes(),seconds=date.getSeconds(),doubleReg=/\d{2}/,formatTime;month=doubleReg.test(month)?month:"0"+month,day=doubleReg.test(day)?day:"0"+day,minutes=doubleReg.test(minutes)?minutes:"0"+minutes,seconds=doubleReg.test(seconds)?seconds:"0"+seconds,formatTime=date.getFullYear()+"-"+month+"-"+day+" "+hours+":"+minutes+":"+seconds,_template_fun_array.push("                        ","undefined"==typeof formatTime?"":baidu.template._encodeHTML(formatTime),'                    </div>                </div>                <div class="status">                    已接单                </div>                <div class="phone-bar">                    <a class="client-phone" href="tel:',"undefined"==typeof info[i].phone?"":baidu.template._encodeHTML(info[i].phone),'">                        '),info[i].phone===info[i].third_phone?_template_fun_array.push('                            <span class="title">本人：</span>                        '):_template_fun_array.push('                            <span class="title">客人：</span>                        '),_template_fun_array.push('                        <span class="phone">',"undefined"==typeof info[i].phone?"":baidu.template._encodeHTML(info[i].phone),'</span>                    </a>                    <a class="driver-phone" href="tel:',"undefined"==typeof info[i].phone?"":baidu.template._encodeHTML(info[i].phone),'">                        <span class="title">司机：</span>                        <span class="phone">',"undefined"==typeof info[i].driver_phone?"":baidu.template._encodeHTML(info[i].driver_phone),"</span>                    </a>                </div>            ")}else _template_fun_array.push('                <a class="client-phone" href="tel:',"undefined"==typeof info[i].phone?"":baidu.template._encodeHTML(info[i].phone),'">                    '),info[i].phone===info[i].third_phone?_template_fun_array.push('                        <span class="title">本人：</span>                    '):_template_fun_array.push('                        <span class="title">客人：</span>                    '),_template_fun_array.push('                    <span class="phone">',"undefined"==typeof info[i].phone?"":baidu.template._encodeHTML(info[i].phone),"</span>                </a>                "),1===info[i].status?(_template_fun_array.push("                    "),1===info[i].can_retry?_template_fun_array.push('                        <button class="btn-retry" data-order-id="',"undefined"==typeof info[i].order_id?"":baidu.template._encodeHTML(info[i].order_id),'">重发</button>                    '):_template_fun_array.push('                        <div class="status">                            推送中                        </div>                    '),_template_fun_array.push("                ")):_template_fun_array.push('                    <div class="status">                        已过期                    </div>                '),_template_fun_array.push("            ");_template_fun_array.push("        </li>    ")}_template_fun_array.push("</ul>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],storage=require("taxi:static/js/storage.js"),popup=require("taxi:widget/common/popup/popup.js"),exports={create:function(){var e=$(".taxi-widget-vip-orderlist"),t=e.find(".list-container");t.height(window.innerHeight-50),this.$listContainer=t,t.on("click",$.proxy(this.onListContainerClick,this))},onListContainerClick:function(e){"btn-retry"===e.target.className&&this.resubmit(e.target)},resubmit:function(e){var t;popup.open({text:"正在重新发送打车请求...",layer:!0}),LoadManager.request({data:{qt:"addpricereq",city_code:storage.get("cityCode"),add_price:"0",order_id:e.getAttribute("data-order-id")},success:function(){popup.open({text:"发送成功！",layer:!0}),t=$(e),t.parent().append('<div class="status">推送中</div>'),t.remove()},error:function(e){var t="";switch(e.errno){case-101:t="参数错误！";break;case-304:t="订单已失效，请建立新单发送！";break;default:t="系统错误！"}popup.open({text:t,layer:!0})}})},loadList:function(){var e=this.$listContainer;LoadManager.request({data:{qt:"myorder",third_phone:storage.get("thirdPhone")},success:function(t){e&&e.html("").append(listItemTemplate(t))}})},destroy:function(){clearInterval(this.interval)},init:function(){this.create(),this.loadList(),this.interval=setInterval($.proxy(this.loadList,this),3e4)}};module.exports=exports});